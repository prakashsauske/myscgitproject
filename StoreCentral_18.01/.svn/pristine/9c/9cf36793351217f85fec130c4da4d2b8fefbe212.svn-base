var articleSearchKey = 'article';
var stockTransferLink='../stockTransfer/stockTransferOnPageLoad.htm';
var cancelMsg ='Are you sure you want to cancel?';
var saveMsg ='Are you sure you want to save the changes?';
var over_under_lay_dialog = '<div id="dialog-over-under-lay" title="Underlay / Overlay Articles" class="visible-hide"><div class="popupContent"><div id="pop-up-cont" class="ContentTableWrapper"></div><div class="popupActionsWrapper"><span class="popupActions"><label class="actionBtn" onclick="$(\'#dialog-over-under-lay\').dialog(\'close\')"><a>OK</a></label></span></div></div></div>';
var over_under_supp_dialog = '<div id="dialog-over-under-supply" title="Under / Over Supply" class="visible-hide"><div class="popupContent"><div id="pop-up-cont" class="ContentTableWrapper"></div><div class="popupActionsWrapper"><span class="popupActions"><label onclick="$(\'#dialog-over-under-supply\').dialog(\'close\')" class="actionBtn"><a>OK</a></label></span></div></div></div>';
var extraAction = '<div class="tableActionsExtra"><span><input type="checkbox" id="changeOmExpDate"><label for="changeOmExpDate">Change order multiple and input expiry date</label></span></div>';
var recei_session = '<div id="receive-session" title="Receiving"><div class="popupContent"><div class="popupData popupTitle" id="message_title"></div><div class="popupActionsWrapper ">'
	+'<span class="popupActions"><label id="yes" class="actionBtn"><a>Accept</a></label><label id="no" class="actionBtn"><a>Reject</a></label></span></div></div></div>';
var updateQtyActionBtn = '<div class="pageActions updateMode" id="editDoneWrap"><label class="actionBtn" id="saveupdateQty_dwn"><a><label class="">Save</label></a></label><label class="secondaryActionBtn" id="cancelUpdateQty_dwn"><a>Cancel</a></label></div>';
var up_qty_cont_wrap = '<div class="ContentTableWrapper  updateContentTableWrap updateMode" id="updateQtyContentWrap"></div>';
var update= 'upd';
var warehouseMap= {};
var article ='article';
var detail= 'dtl';
var orderEnq= 'enq';// for Defect_14718
var isCostPriceShow=false;
var poType = 'VENDOR';
var stoType = 'WAREHOUSE';
var stType = 'STOCK TRANSFER';
var sugo = 'SUGO';
var inProgress='Receiving in Progress';
var emergency = 'EMERGENCY';
var EnterVendorClaimAuthorityNumber = 'AC_EVCA';
var recordCount;
var orderTypeAllocation = 'ALC';
var orderTypeVendorOrders = 'VENDOR';
var orderTypeWarehouseOrders = 'WAREHOUSE';
var orderTypeIBTIn = 'IBT IN';
var orderTypeIBTOut = 'IBT OUT';
var orderTypeIBTAll = 'IBT ALL';
var orderTypePlannedOrders = 'PLO';
var openStautus = 'OPEN';
var submitStatus = 'SUBMITTED';
var authStatus = 'AUTHORISED';
var receStatus = 'RECEIVED';
var cancelStatus = 'CANCELLED';
var partialStatus = 'PARTIALLY RECEIVED';
var diapatchStatus = 'DISPATCHED';
var orderTypePReq = 'ZY';
var flag = true;
var commonOrderList;
var commonOrder='';
var headerObj='';
var commonPreqList;
var inputData;
var orderPage = 1;
var preqPage = 1;
var orderPageFlag = true;
var preqPageFlag = true;
var preqData;
var oldData;
var currentPage = 1;
var totalPallets = '';
var somOrderNoExists = false;
var deliveryList;
var allItemList;
var segmentOrderList;
var Summary_Bar = 'Summary of all combined purchase orders for the selected criteria selection.';
var Plus_Symbol = 'Allows user to expand a menu of more information for the selected purchase order.';
var inv_Order = 'Purchase Order Number';
var GRN_Date = 'Date when Purchase Order is received';
var GRN_Entered_By = 'Username who received the goods';
var GRN_Doc = 'Goods Received Note Document Number in SAP';
var Total_GRN_Amount = 'Total value of Goods Received';
var Total_INV_Amount = 'Total Invoice Amount';
var inv_Discrepancy = 'Difference between goods received and invoice amount';
var inv_Comments = '4 reasons '
		+ ' 1.Invoice Not Yet Received = Invoice not yet in the system'
		+ ' 2.Matched = NO difference between Goods Received and Invoice amounts '
		+ ' 3.Overcharged = Invoice is higher than the GR'
		+ ' 4.Undercharged = Invoice is lower than the GR';
var Invoice_Not_Yet_Received = 'Invoice from vendor has not been sent to store.';
var inv_Matched = 'Transactions fully match in Store Central.';
var inv_Overcharged = 'The invoice amount is higher than the GR outside & within tolerance.';
var inv_Undercharged = 'The invoice amount is lower than the GR outside & within tolerance.';

var rec_tab = 'Shows user all receipts related to the selected purchase order';
var rec_Date = 'Date when goods receipt /adjustment was made';
var rec_GRN_Entered_By = 'Username who received / amended the goods received';
var rec_GRN_Doc = 'Goods Received Note Document number in SAP';
var rec_GRN = 'Goods Received Note number created in ISIS';
var rec_Total_GRN_Amount_Incl = 'Total value of goods received or adjustment made on the receipt';
var rec_GRN_Type = '2 Types: '
		+ '1. Receipt '
		+ '2. Adjustment - may mean subsequent receipt or amendment made on the receipt';

var in_tab = 'Shows user Invoices including amount due to Claims from Vendor (credit) or Additional payable to vendor (debit)';
var in_Date = 'Date when invoice is received by the system.';
var in_Entered_By = 'Username who entered the invoice into the system';
var in_Document = 'Invoice Document number in SAP';
var in_Reference = 'Invoiceâ€™s vendor document reference number';
var in_Total_Amount = 'Invoice Amount per document';
var in_Total_GST = 'Invoice GST Amount';

var sum_tab = 'Shows user total summary of Goods Receipts and Invoices including additional payment (debit) and claims (credit)';
var sum_Total_Amount_Including = 'Summary of all Goods Received Notes Including GST for the selected purchase order';
var sum_GRN_Amount = 'Total value of all Goods Received Notes for the selected purchase order';
var sum_Invoice_Amount = 'Total of all invoice amount for the selected purchase order';
var sum_Additional_Payable = 'Total debit amount in addition to the invoice';
var sum_Claims = 'Total credit amount against the invoice';
var sum_Net_Payable = 'Total Invoice Amount plus Additional Payable minus Claims';

var tot_gst_tab = 'Summary of all GST values for the selected purchase order';
var tot_gst_GRN_Amount = 'Total GST value of all Goods Received Notes for the selected purchase order';
var tot_gst_Invoice_Amount = 'Total GST value of all Goods Received Notes for the selected purchase order';
var tot_gst_Additional_Payable = 'Total GST value of all Additional Payments plus Claim Reversals for the selected purchase order';
var tot_gst_Claims = 'Total GST of all Claims and Additional Claims for the selected purchase order';
var tot_gst_Net_Payable = 'Total GST value we will pay/receive to/from the vendor for the selected purchase order';

var Inv_Department = 'Allows user to select all departments or select a specific department to review.';
var Inv_Order = 'Allows user to select all, or enter a specific purchase order to review.';
var Inv_Discrepancy = 'This value determines the return of discrepancies you review, this value is defaulted to $20.00';
var Inv_GRN_Date = 'Goods Received Note date allows user to select From and To date to review.';
var Inv_Receipt_with_No_Invoice = 'A filter allowing users to only review Purchase Orders received with no invoice.';
var Inv_Receipt_with_Adjustments = 'A filter allowing users to only review Purchase Orders that contain adjustments.';

var securityGrs = 'AC_GRS';
var EnterVendorClaimAuthorityNumber = 'AC_EVCA';
var salesOrgConfigMap = {};
$(document)
.ready(
		function() {
			salesOrg = $('#salesOrg').val();
			siteNo = $('#posSite').val();
			userId = $('#loginUserId').val();
			if($("#ngboPilotStore").val().trim()=='Y')
			getEncSAPPassword();
			
			$("#dialog-verify").dialog({
				autoOpen : false,
				modal : true,
				resizable : false,
				minHeight : 200,
				maxHeight : 800,
				width : 515
			});

			$("#dialog-verify").parent().addClass("popupWrapper");
			
			$( "#dialog-editSitePop" ).dialog({				
				autoOpen: false,
				modal: true,
				resizable: false,
				minHeight: 200,
				maxHeight: 600,
				width: 800
			});
			$("#dialog-editSitePop").parent().addClass("popupWrapper");
			
			$("#dialog-modal-autho").dialog({
				autoOpen : false,
				modal : true,
				resizable : false,
				minHeight : 150,
				maxHeight : 600,
				width : 430
			});
			
			$("#dialog-alertBox").dialog({
				autoOpen : false,
				modal : true,
				resizable : false,
				minHeight : 120,
				maxHeight : 600,
				width : 500
			});

			$("#dialog-modal-autho").parent().addClass("popupWrapper");

			$("#cancelVendorAuthNo").click(function(e) {
				$("#dialog-modal-autho").dialog("close");
			});
			
			$("#dialog-modal-autho-ngbo").dialog({
				autoOpen : false,
				modal : true,
				resizable : false,
				minHeight : 150,
				maxHeight : 600,
				width : 430
			});
			
			$("#dialog-modal-autho-ngbo").parent().addClass("popupWrapper");

			$("#cancelVendorAuthNoNgbo").click(function(e) {
				$("#dialog-modal-autho-ngbo").dialog("close");
			});
			
			 $("#saveVendorAuthNoNgbo")
				.click(
						function(e) {
							$('#vendorClaimVal').val(
									$('#vendorAuthNoNgbo').val());
							if ($('#vendorAuthNoNgbo').val() == "") {
								$.fn.showCustomMsg([claimMsg],error,'Order Details');
								
							} else {
								var reqObj = $(this).data('obj');
								saveAuthNoInNGBO(reqObj);
							}
						});

			$("#saveVendorAuthNo")
					.click(
							function(e) {
								$('#vendorClaimVal').val(
										$('#vendorAuthNo').val());
								if ($('#vendorAuthNo').val() == "") {
									showAlert(
											'Please enter a valid Vendor Claim Authorization number.',
											'vendorAuthNo');
									// $( "#dialog-modal" ).dialog(
									// "open" );

								} else {

									var vendorClaimOrderNo = '';
									var authNo = $('#vendorAuthNo')
											.val().trim();
									if (commonOrder != ''
											&& commonOrder != undefined)
										vendorClaimOrderNo = commonOrder.orderNo;
									saveAuthNo({
										authNo : authNo,
										vendorClaimOrderNo : vendorClaimOrderNo
									});

								}
							});
			$('#backBtn')
			.click(
					function() {
						hideError();
						if (!$('.contentWrapper.tabbedOrderDetail')
								.hasClass('hideBlock') || ($('#order_detail')
										.is(':visible'))) {
							navigate(orderEnq);// for Defect_14718
						} else if ($('#update_order')
								.is(':visible')) {
							navigate(detail);
						} 
						else {
							window.location.href = "../login/goingHome.htm";
						}
					});
		});
function newFunction() {
	$(".actionBtn, .secondaryActionBtn").bind('click', function() {
		$("#dialog-modal-delivery").dialog("close");

	});

	$('.actionBtn, .secondaryActionBtn').keyup(function(e) {
		if (e.which === 13) { // 13 is the char code for Enter
			clickedId = this.id;
			if (clickedId == 'changeDelivery' || clickedId == 'cancelDelivery')
				$("#dialog-modal-delivery").dialog("close");
		}
	});

	$("#editdDate").click(function() {

		$("#dialog-modal-delivery").dialog("open");
	});

	// checks radio buttons in Invoice Info
	$('#receiveAmount').click(function() {
		$("#invoiceEntry").removeClass('hideBlock');
		$("#docketEntry").addClass('hideBlock');
		$("#invoiceEntryConfirm").removeClass('hideBlock');
		$("#docketEntryConfirm").addClass('hideBlock');

	});

	$('#receiveDocket').click(function() {
		$("#docketEntry").removeClass('hideBlock');
		$("#invoiceEntry").addClass('hideBlock');
		$("#docketEntryConfirm").removeClass('hideBlock');
		$("#invoiceEntryConfirm").addClass('hideBlock');
	});

	$("#dropdownSelect").click(function() {
		if ($('#dropdown').hasClass('active')) {
			$("#dropdown").removeClass('active');
		} else {
			$("#dropdown").addClass('active');
		}
	});

	$('html').click(function() {
		$("#dropdown").removeClass('active');
	});

	$('#dropdownSelect').click(function(event) {
		event.stopPropagation();
	});

	$('.textbox').focus(function() {
		if ($(this).val() == $(this).attr('defaultVal')) {
			$(this).val('');
			$(this).removeClass("textboxDefaultText");
		}
	});

	$('.textbox').blur(function() {
		if ($(this).val() == '') {
			$(this).val($(this).attr('defaultVal'));
			$(this).addClass("textboxDefaultText");
		}
	});

	$("#menu").menu({
		position : {
			my : "right top",
			at : "right top+20"
		}
	});

	// code to initialise tree table
	/*
	 * $(".treetable").treetable({ expandable: true });
	 */

	// Code for Expand and Collapse all
	$('#expandAll').click(function() {
		$("#treetable").treetable('expandAll');
		$("#expandAll").addClass('hideBlock');
		$("#collapseAll").removeClass('hideBlock');
		$('#treetable tr:even').removeClass('expanded');
	});

	$('#collapseAll').click(function() {
		$("#treetable").treetable('collapseAll');
		$("#expandAll").removeClass('hideBlock');
		$("#collapseAll").addClass('hideBlock');
	});

	// Code to expand collapse Delivery status more information

	$("#moreDetails").click(function() {
		$("#deliveryStatusDetails").removeClass('hideBlock');
		$("#lessDetails").removeClass('hideBlock');
		$("#moreDetails").addClass('hideBlock');
	});

	$("#lessDetails").click(function() {
		$("#deliveryStatusDetails").addClass('hideBlock');
		$("#lessDetails").addClass('hideBlock');
		$("#moreDetails").removeClass('hideBlock');
	});

	$("#subTabs").tabs();
	$("#sections").tabs({
		active : 2
	});

	$("#tabs a.ui-tabs-anchor").click(function() {
		$("#FilterResult").css("display", "none");
	});

	// Code to show GRN filter
	$("#showFilterResult").click(
			function() {
				$('#tabs .ui-tabs-active').attr("tabindex", "-1");
				;
				$('#tabs .ui-tabs-active').removeClass(
						'ui-tabs-active ui-state-active');

				$('#tabs .ui-tabs-panel').css("display", "none");
				$("#FilterResult").removeClass('hideBlock');
				$("#FilterResult").css("display", "block");
			});

}
function getGrAtricles(data) {
	$.ajax({
		type : "get",
		url : "../allocation/getGrAtricles.htm",
		data : data,
		beforeSend : function() {
			startLoading();
			// hideOrderTbl();
		},
		success : function(response) {

			output = $.parseJSON(response);

			orderList = output.data;

			msg = output.msg;

			if (msg != undefined && msg != '' && !isNaN(msg)
					&& orderList != null) {
				formGrArticles(orderList);
				// count=orderList[0].msg.trim();
				showFilteredArticle();
				// commonOrderList=orderList;
				// bindAllocationContent();
				//bindOrdersScroll();
			} else {
				if (msg == 'null')
					showError('Service Unavailable.');
				else
					showError(msg);
				bindOrdersScroll();
			}
			stopLoading();
		},
		error : function() {
			// goToLogin();
		},
	});
}
function formGrArticles(orderList) {

	var content = '<div class="ContentTableWrapper">'
			+ '<table cellspacing="0" class="sortTable ContentTable  contentRow" id="">'
			+ ' <thead><tr>' + '<th class="">Article #</th>'
			+ '<th class="">Description</th>'
			+ '<th class="centerValue header">Vendor Ref.#</th>'
			+ '<th class="numberColumn">Received Qty.</th>'
			+ '<th class="numberColumn">Order Multiple (OM)</th>'
			+ '<!-- <th class="numberColumn">Cost $ per OM</th>-->'
			+ '<th class="numberColumn">Total Units</th>'
			+ '<!-- <th class="numberColumn">Total Cost $</th> -->' + '</tr></thead>';

	if (orderList != null) {

		var list = orderList;
		for ( var i = 0; i < list.length; i++) {
			content += '<tr data-tt-id="1" class="collapsed allItem">' + '<td>'
					+ list[i].article.replace(/^0+/, '') + '</td>' + '<td>'
					+ list[i].articleDesc + '</td>' + '<td>'
					+ list[i].vendorRefNo.replace(/^0+/, '') + '</td>'
					+ '<td class="numberColumn">' + list[i].receivedQty + ' '
					+ list[i].receivedQtyUom + '</td>'
					+ '<td class="numberColumn">' + list[i].packSize + ' '
					+ list[i].totPackSizeQtyUom + '</td>'
					+ '<!-- <td class=" numberColumn">' + list[i].packSizeCost
					+ '</td> -->' + '<td class="lastColumn numberColumn">'
					+ list[i].totPackSizeQtyRcvd + ' ' + list[i].totalUnitsUom
					+ '</td>' + '<!-- <td class="lastColumn numberColumn">'
					+ list[i].totCostRcvd + '</td>-->' + '</tr>';
		}

		content += '</table></div>';
		//}
	}
	$('#filterResult').html('');
	$('#filterResult').html(content);
	//bindOrderContent();
}
function showFilteredArticle() {
	$('#filterResult').removeClass('hideBlock');
	$('#tabs-all .treetable').addClass('hideBlock');
	$('#tabs-all .treetable').addClass('hideBlock');
	$('#tabs-unsup .ContentTable').addClass('hideBlock');
	$('#itemTabs .ui-tabs-active').attr("tabindex", "-1");
	;
	$('#itemTabs .ui-tabs-active')
			.removeClass('ui-tabs-active ui-state-active');
	//$('#itemTabs .ui-tabs-panel').css("display","none");
}
function hideFilteredArticle() {
	$('#filterResult').addClass('hideBlock');
	$('#tabs-all .treetable').removeClass('hideBlock');
	$('#tabs-all .treetable').removeClass('hideBlock');
	$('#tabs-unsup .ContentTable').removeClass('hideBlock');
	// $('#itemTabs .ui-tabs-active').attr("tabindex", "-1");;
	$('#itemTabs .ui-tabs-active').addClass('ui-tabs-active ui-state-active');

	// $('#itemTabs .ui-tabs-panel').css("display","none");
}

function getOrdersList(orderNo) {

	var orderList = '';
	var msg = '';
	var output = '';
	var count = '';
	// console.log(data);
	$.ajax({
		type : "get",
		url : "../allocation/getPOrderDtl.htm",
		data : {
			orderNo : orderNo
		},
		beforeSend : function() {
			startLoading();
			// if(orderPageFlag)
			// hideOrderTbl();
		},
		success : function(response) {

			output = $.parseJSON(response);

			orderList = output.data;

			msg = output.msg;

			if (msg != undefined && msg != '' && !isNaN(msg)
					&& orderList != null) {

				commonOrderList = orderList;
				getOrderDetails(orderNo, orderList[0]);

			} else {

				showError('Service Unavailable.');
				stopLoading();
				$.loader('close');

			}
			// stopLoading();
		},
		error : function() {
			// goToLogin();
			stopLoading();
			$.loader('close');
		},
	});

}
function getOrderDetails(orderNo, obj) {
	var data = {
		orderNo : orderNo
	};
	var msg = '';
	var output = '';
	var count = '';
	var tabHeader = '';
	var tabSection = '';
	commonOrder = obj;

	$
			.ajax({
				type : "get",
				url : "../allocation/getOrderDetails.htm",
				data : data,
				beforeSend : function() {
					// startLoading();
					// hideOrderTbl();
				},
				success : function(response) {

					output = $.parseJSON(response);
					var deliveryInfo = $.parseJSON(output.data.deliveryInfo);
					var itemInfo = $.parseJSON(output.data.itemInfo);
					//var grInfo = $.parseJSON(output.data.grInfo);
					// var invoiceInfo=$.parseJSON(output.data.invoiceInfo);
					msg = itemInfo.msg;
					deliveryList = deliveryInfo.data;
					var deliveryMsg = deliveryInfo.msg;
					tabHeader = '<div id="sections" class="sectionTabs"><ul>';
					var currentTab = 0;

					if (msg != undefined && msg != '' && !isNaN(msg)
							&& itemInfo.data != null) {
						var grSelect = '';
						var orderStatus=obj.orderStatus;
						/*if (obj.orderStatus == 'RECEIVED'
								|| obj.orderStatus == 'PARTIALLY RECEIVED')
							grSelect = grInfoList(grInfo.data);*/
						var orderHd = orderHead(obj);
						calculateTotalCartonsReceived(itemInfo.data,obj);
						var overAllHdr = formOverAllHeader(obj, deliveryList);
						var invoic = '';// formInvoiceInfo(invoiceInfo.data);
						var deliveCon = formDeliveryContent(obj, deliveryList,
								0);
						var formItem = formItemHdr(itemInfo.data);
						var itemAllList = formAllItemList(itemInfo.data);
						allItemList = itemInfo.data;
						var itemUnsuList = formUnsuppItemList(itemInfo.data);

						if (deliveryList != null && deliveryList != undefined
								&& deliveryList != '' && deliveryMsg != null
								&& deliveryMsg != ''
								&& deliveryMsg != undefined) {
							currentTab = deliveryList.length;
							for ( var j = (deliveryList.length - 1); j >= 0; j--) {
								if (j == 0) {
									tabHeader += '<li class="contentAlignment"><a href="#section-overAll"><label class="sectionTitle ">Overall Info</label>'
											+ '<label class="sectionInfo">';
									if (deliveryList.length != 0
											&& deliveryList.length > 1)
										tabHeader += 'Total Deliveries: <strong>'
												+ (deliveryList.length - 1)
												+ '</strong>';
									else
										tabHeader += '&nbsp';
									tabHeader += '</label></a></li>';
									tabSection += '<div id="section-overAll">'
											+ orderSubHdr(obj, 'overAll',
													'Overall Info')
											+ '<div class="articleContent orderDetails "> <div class="articleContentInner">'
											+ overAllHdr;
									if (obj.portalOrderType == orderTypeVendorOrders)
										tabSection += invoic;
									if (obj.portalOrderType == orderTypeIBTAll
											|| obj.portalOrderType == orderTypeIBTIn
											|| obj.portalOrderType == orderTypeIBTOut)
										tabSection += formStoreContent(obj);
									tabSection += formDeliveryContent(obj,
											deliveryList, j)
											+ '</div></div>'
											+ formItem
											+ '</div></div>';
								} else {
									tabHeader += '<li><a href="#section-'
											+ j
											+ '"><label class="sectionTitle">Delivery-'
											+ j
											+ '</label>'
											+ '<label class="sectionInfo segmentNo-'
											+ j + '">';
									if (obj.portalOrderType == orderTypeVendorOrders)
										tabHeader += 'ASN';
									else
										tabHeader += 'Segment';

									tabHeader += '#: <strong>';

									if (obj.portalOrderType == orderTypeVendorOrders)
										tabHeader += deliveryList[j].delievryNo
												.replace(/^0+/, '');
									else
										tabHeader += deliveryList[j].delievryNo
												.replace(/^0+/, '');
									// asnNo need to confirm

									tabHeader += '</strong></label></a></li>';
									tabSection += '<div id="section-'
											+ j
											+ '">'
											+ orderSubHdr(obj, 'delivery',
													'Delivery-' + j)
											+ '<div class="articleContent orderDetails "> <div class="articleContentInner">'
											+ overAllHdr;
									if (obj.portalOrderType == orderTypeVendorOrders)
										tabSection += invoic;
									if (obj.portalOrderType == orderTypeIBTAll
											|| obj.portalOrderType == orderTypeIBTIn
											|| obj.portalOrderType == orderTypeIBTOut)
										tabSection += formStoreContent(obj);
									tabSection += formDeliveryContent(obj,
											deliveryList, j)
											+ '</div></div></div></div>';
								}

							}
						} else {
							tabHeader += '<li class="contentAlignment"><a href="#section-overAll"><label class="sectionTitle">Overall Info</label>'
									+ '<label class="sectionInfo">';
							if (deliveryList != null
									&& deliveryList != undefined
									&& deliveryList != ''
									&& deliveryList.length != 0)
								tabHeader += 'Total Deliveries: <strong>'
										+ deliveryList.length + '</strong>';
							else
								tabHeader += '&nbsp';
							tabHeader += '</label></a></li>';

							tabSection += '<div id="section-overAll">'
									+ orderSubHdr(obj, 'overAll',
											'Overall Info')
									+ '<div class="articleContent orderDetails "> <div class="articleContentInner">'
									+ overAllHdr;
							if (obj.portalOrderType == orderTypeVendorOrders)
								tabSection += invoic;
							if (obj.portalOrderType == orderTypeIBTAll
									|| obj.portalOrderType == orderTypeIBTIn
									|| obj.portalOrderType == orderTypeIBTOut)
								tabSection += formStoreContent(obj);
							tabSection += deliveCon + '</div></div>' + formItem
									+ '</div>';
						}
						tabHeader += '</ul>';
						
						bindOrderDtlContent(orderHd, tabHeader, tabSection,
								itemAllList, itemUnsuList, grSelect,
								currentTab, itemInfo);
						if(orderStatus =='RECEIVED' || orderStatus =='PARTIALLY RECEIVED'){
							//$('#verifyGRN').val(orderNo);
							bindDropDownGrEvent(data,orderNo);
						}
					} else {
						if (msg == 'null')
							showError('Service Unavailable.');
						else
							showError(msg);
						// bindOrdersScroll();
					}
					$('#backBtnId').removeClass('hideBlock');
					$.loader('close');
					securityMatrix();
				},
				error : function() {
					// goToLogin();
					$.loader('close');
					stopLoading();
				},
			});

}
function calculateTotalCartonsReceived(itemList,orderHeader){
	var totalReceivedQty = 0;
	if (itemList != null) {
		for ( var j = 0; j < itemList.length; j++) {
			totalReceivedQty = Math.abs(Number(totalReceivedQty)+ Number(itemList[j].receivedQty));
		}
	}
	if(totalReceivedQty > 0){
		orderHeader.totReceivedQty = totalReceivedQty;
	}
}
function formOverAllHeader(obj, deliveryList) {
	obj.roasterDate = (obj.roasterDate.replace('.', '/').replace('.', '/') == '00/00/0000' ? ''
			: obj.roasterDate.replace('.', '/').replace('.', '/'));
	obj.receivedDate = ((obj.receivedDate != null && obj.receivedDate != '') ? obj.receivedDate
			: '');
	totalPallets = obj.totPallets;
	var content = '';

	content = '<div class="articleDetails"><table cellspacing="0" class="ContentTable" width="100%"><tr>'
			+ '<td class="keyInfo" width="20%">Total Cartons:</td><td class="valueInfo" width="15%">'
			+ obj.totCartons
			+ '</td>'
			+ '<td class="keyInfo" width="15%">Roster Date:</td><td class="valueInfo" width="15%">';
	if (obj.roasterDate.length > 7)
		content += obj.roasterDate;
	content += '</td>'
			+ '<td class="keyInfo" width="15%"><!--Trading Dept:-->Total Cartons Received:</td><td class="valueInfo lastColumn"><!--'
			+ obj.department;
	if (obj.department != '' && obj.deptName != '')
		content += ' | ';
	content += obj.deptName
			+ '-->'
			+ obj.totReceivedQty
			+ '</td>'
			+ '</tr><tr><td class="keyInfo">Total Pallets:</td><td class="valueInfo">'
			+ obj.totPallets
			+ '</td><td class="keyInfo">'
			+ 'Creation Date:</td><td class="valueInfo">'
			+ obj.creationDate.replace('.', '/').replace('.', '/')
			+ '</td><td class="keyInfo"><!--Temperature:-->Received Date:</td>'
			+ '<td class="valueInfo"><!--'
			+ obj.temperature
			+ '-->'
			+ obj.receivedDate.replace('.', '/').replace('.', '/')
			+ '</td><td class="lastColumn"></td></tr><!--<tr><td class="keyInfo">Total Cartons Received:</td>'
			+ '<td class="valueInfo">'
			+ obj.totReceivedQty
			+ '</td><td class="keyInfo">Received Date:</td><td class="valueInfo">'
			+ obj.receivedDate.replace('.', '/').replace('.', '/')
			+ '</td><td class="keyInfo">Temperature 2:</td><td class="valueInfo lastColumn">'
			+ obj.temperature2 + '</td></tr>--></table>';
	if (obj.portalOrderType == orderTypeWarehouseOrders
			&& deliveryList.length > 0) {
		content += '<table cellspacing="0" class="ContentTable" width="100%">'
				+ '<tbody><tr><td class="keyInfo" width="20%">Delivery Status:</td>'
				+ '<td class="valueInfo" width="15%">'
				+ obj.deliveryStatus
				+ '</td><td class="lastColumn" width="65%"><label class="linkBtn">'
				+ '<a href="#" class="more" id="moreDetails">+ more </a>'
				+ '<a href="#" class="more hideBlock" id="lessDetails">- less </a>'
				+ '</label></td></tr>' + '</tbody></table>';
		content += '<table cellspacing="0" class="ContentTable hideBlock" width="100%" id="deliveryStatusDetails">'
				+ '<tbody>' + '</tbody></table>';
	}

	content += '</div>';
	/*
	 * var content='<div class="articleDetails"><table cellspacing="0"
	 * class="ContentTable" width="100%"><tr>' +'<td class="keyInfo" width="20%">Total
	 * Cartons:</td><td class="valueInfo" width="15%">'+obj.totCartons+'</td>' +'<td class="keyInfo" width="15%">Roster
	 * Date:</td><td class="valueInfo" width="15%">'+obj.roasterDate.replace('.','/').replace('.','/')+'</td>' +'<td class="keyInfo" width="15%">Trading
	 * Dept:</td><td class="valueInfo lastColumn">'+obj.department;
	 * if(obj.department!='' && obj.deptName!='') content+=' | ';
	 * content+=obj.deptName+'</td>' +'</tr><tr><td class="keyInfo">Total
	 * Pallets:</td><td class="valueInfo">'+obj.totPallets+'</td><td class="keyInfo">'
	 * +'Creation Date:</td><td class="valueInfo">'+obj.creationDate.replace('.','/').replace('.','/')+'</td><td class="keyInfo">Temperature:</td>' +'<td class="valueInfo lastColumn">'+obj.temperature+'</td></tr><tr><td class="keyInfo">Total
	 * Cartons Received:</td>' +'<td class="valueInfo">'+obj.totReceivedQty+'</td><td class="keyInfo">Received
	 * Date:</td><td class="valueInfo">'
	 * +obj.receivedDate.replace('.','/').replace('.','/')+'</td><td class="keyInfo">Temperature
	 * 2:</td><td class="valueInfo lastColumn">'+obj.temperature2+'</td></tr></table></div>';
	 */
	return content;
}
function formDeliveryContent(obj, deliveryList, j) {
	var content = '';
	var selectedId = '';
	// if(j != 0){
	selectedId = j;
	// }
	if (deliveryList != null && deliveryList != "" && deliveryList.length > 0
			& somOrderNoExists
			&& obj.portalOrderType != orderTypeWarehouseOrders) {
		content += '<table cellspacing="0" class="ContentTable" width="100%">'
				+ '<tbody><tr><td class="keyInfo" width="20%">Delivery Status:</td>'
				+ '<td class="lastColumn valueInfo" width="15%">';
		if (somOrderNoExists && deliveryList.length > 1) {
			for ( var i = 1; i < deliveryList.length; i++) {
				content += deliveryList[i].delievryNo.replace(/^0+/, '');
				if (i != deliveryList.length - 1)
					content += ',';
			}
		} else if (deliveryList.length == 1 && somOrderNoExists)
			content += obj.deliveryStatus;
		content += '</td></tr>' + '</tbody></table>';
	}

	if (obj.portalOrderType == orderTypeWarehouseOrders && deliveryList != null
			&& deliveryList != "" && deliveryList.length > 0) {

		content += '<table cellspacing="0" class="ContentTable" width="100%">'
				+ '<tbody><tr><td class="keyInfo" width="20%">Delivery Status:</td>'
				+ '<td class="valueInfo" width="15%">';
		if (somOrderNoExists && deliveryList.length > 1) {
			for ( var i = 1; i < deliveryList.length; i++) {
				content += deliveryList[i].delievryNo.replace(/^0+/, '');
				if (i != deliveryList.length - 1)
					content += ',';
			}
		} else if (deliveryList.length == 1 && somOrderNoExists)
			content += obj.deliveryStatus;
		else
			content += obj.deliveryStatus;
		content += '</td><td class="lastColumn" width="65%"><label class="linkBtn">'
				+ '<a class="more" id="section-'
				+ selectedId
				+ '-moreDetails">+ more </a>'
				+ '<a class="more less hideBlock" id="section-'
				+ selectedId
				+ '-lessDetails">- less </a>'
				+ '</label></td></tr>'
				+ '</tbody></table>';

		content += '<table cellspacing="0" class="ContentTable hideBlock" width="100%" id="deliveryStatusDetails'
				+ selectedId + '">' + '<tbody>' + '</tbody></table>';
	}

	return content;
}
function formItemHdr(orderList) {

	var content = '<div class="ContentTableWrapper"><div class="tableInfo"><div class="tableTitle">'
			+ '<h4 class="sectionTitle">List of Articles</h4></div> <!-- End of table title -->'
			+ '</div> <!-- End of table info --><div id="itemTabs" class="filterTabs ui-tabs ui-widget ui-widget-content ui-corner-all">'
			+ '<ul>'
			+ '<li class="allTab"><a href="#tabs-all" >All (100)</a></li>'
			+ '<li class"unSupTab"><a href="#tabs-unsup" >Unsupplied (10)</a></li>'
			+ '<li class="filterMenu '
			+ securityGrs
			+ '"><div class="filterMenuOptions"><label class="filterTitle">Received / Amended in GR:</label>'
			+ '<select class="selectOptions grnSelect">'
			+ '</select><label class="actionBtn" id="showFilterResult">Go</label></div> <!-- End of filter menu options -->'
			+ '</li></ul><div id="tabs-all">'
			+ '<table cellspacing="0" class="ContentTable treetable drilldownTable" id="treetable"></table>'
			+ '</div> <!-- End of tabs -1 -->'
			+ '<div id="tabs-unsup" >'
			+ '<table cellspacing="0" class="ContentTable"></table></div> <!-- End of tabs - 2 -->'
			+ '<div id="filterResult" class="hideBlock ui-tabs-panel"></div> <!-- End of tabs --></div>';

	return content;
}
function formAllItemList(orderList) {/*
										 * //<th width="15px"><span
										 * class="indenter"><a href="#"
										 * title="Expand All" class="expandAll"
										 * id="expandAll">&nbsp;</a>' //+'<a
										 * href="#" title="Collapse All"
										 * class="collapseAll hideBlock"
										 * id="collapseAll">&nbsp;</a></span></th>
										 * var allTblContent='<tr ><th>Article #</th><th>Description</th>' +'<th>Vendor
										 * Ref. #</th><th class="numberColumn">Order
										 * Qty.</th><th class="numberColumn">Dispatch
										 * Qty.</th>' +'<th class="numberColumn lastColumn">Received
										 * Qty.</th></tr>'; if (orderList !=
										 * null) {
										 * 
										 * for(var j=0;j<orderList.length;j++){
										 * if((null != orderList[j].orderQty &&
										 * orderList[j].orderQty!="") && (null !=
										 * orderList[j].receivedQty &&
										 * orderList[j].receivedQty !="")) {
										 * for(var k=j;k<orderList.length;k++){
										 * if((null != orderList[k].orderQty &&
										 * orderList[k].orderQty!="") && (null !=
										 * orderList[k].receivedQty &&
										 * orderList[k].receivedQty!="")) { var
										 * inner=Math.abs(Number(orderList[k].orderQty)-Number(orderList[k].receivedQty));
										 * var
										 * outter=Math.abs(Number(orderList[j].orderQty)-Number(orderList[j].receivedQty));
										 * if(outter<inner){ var
										 * temp=orderList[j];
										 * orderList[j]=orderList[k];
										 * orderList[k]=temp; } } } } } var list =
										 * orderList; for ( var i = 0; i <
										 * list.length; i++) { //<td><span
										 * class="indenter" style="padding-left:
										 * 0px;"><a href="#"
										 * title="Expand">&nbsp;</a></span></td>
										 * allTblContent += '<tr data-tt-id="1" class="collapsed allItem">' +'<td>'+list[i].article.replace(/^0+/,
										 * '')+'</td>' +'<td>'+list[i].articleDesc+'</td>' +'<td>'+list[i].vendorRefNo.replace(/^0+/,
										 * '')+'</td>' +'<td class="numberColumn">'+list[i].orderQty+'
										 * '+list[i].orderUOM+'</td>' +'<td class="numberColumn">'+list[i].dispatchedQty+'
										 * '+list[i].dispatchedQtyUOM+'</td>' +'<td class="lastColumn numberColumn">'+list[i].receivedQty+'
										 * '+list[i].receivedQtyUOM+'</td>' +'</tr>' +'<tr data-tt-id="2" data-tt-parent-id="1" style="display: none;"><td colspan="7"><span
										 * class="indenter"></span><table
										 * cellspacing="0" class="ContentTable"
										 * width="100%">' +'<tbody><tr><td class="keyInfo" width="20%">Unsupplied
										 * Quantity:</td><td class="valueInfo">##</td><td class="keyInfo" width="20%">SOH:</td><td class="valueInfo">'
										 * +'##</td><td class="keyInfo" width="20%">SIT:</td><td class="valueInfo lastColumn">##</td></tr><tr class="lastRow"><td class="keyInfo">Allocated
										 * Quantity:</td>' +'<td class="valueInfo">##</td><td class="keyInfo">SOO:</td><td class="valueInfo">##</td><td class="keyInfo">OM:</td><td class="valueInfo">##</td></tr></tbody></table></td>';
										 *  } } return allTblContent;
										 */

	// <th width="15px"><span class="indenter"><a href="#" title="Expand All"
	// class="expandAll" id="expandAll">&nbsp;</a>'
	// +'<a href="#" title="Collapse All" class="collapseAll hideBlock"
	// id="collapseAll">&nbsp;</a></span></th>
	var allTblContent = '<tr ><th>Article #</th><th>Description</th>'
			+ '<th>Vendor Ref. #</th><th class="numberColumn">Order Qty.</th><th class="numberColumn">Order Multiple (OM)</th>'
			+ '<th class="numberColumn">Dispatch Qty.</th>'
			+ '<th class="numberColumn ">Received Qty.</th><th class="numberColumn">Total Units Received</th></tr>';
	if (orderList != null) {
		for ( var j = 0; j < orderList.length; j++) {
			if ((null != orderList[j].orderQty && orderList[j].orderQty != "")
					&& (null != orderList[j].receivedQty && orderList[j].receivedQty != "")) {
				for ( var k = j; k < orderList.length; k++) {
					if ((null != orderList[k].orderQty && orderList[k].orderQty != "")
							&& (null != orderList[k].receivedQty && orderList[k].receivedQty != "")) {
						var inner = Math.abs(Number(orderList[k].orderQty)
								- Number(orderList[k].receivedQty));
						var outter = Math.abs(Number(orderList[j].orderQty)
								- Number(orderList[j].receivedQty));
						if (outter < inner) {
							var temp = orderList[j];
							orderList[j] = orderList[k];
							orderList[k] = temp;
						}
					}
				}
			}
		}
		var list = orderList;
		for ( var i = 0; i < list.length; i++) {
			// <td><span class="indenter" style="padding-left: 0px;"><a href="#"
			// title="Expand">&nbsp;</a></span></td>
			allTblContent += '<tr data-tt-id="1" class="collapsed allItem">'
					+ '<td>'
					+ list[i].article.replace(/^0+/, '')
					+ '</td>'
					+ '<td>'
					+ list[i].articleDesc
					+ '</td>'
					+ '<td>'
					+ list[i].vendorRefNo.replace(/^0+/, '')
					+ '</td>'
					+ '<td class="numberColumn">'
					+ list[i].orderQty
					+ ' '
					+ list[i].orderUOM
					+ '</td>'
					+ '<td class="numberColumn">'
					+ list[i].packSize
					+ ' '
					+ list[i].totUnitsUom
					+ '</td>'
					+ '<td class="numberColumn">'
					+ list[i].dispatchedQty
					+ ' '
					+ list[i].dispatchedQtyUOM
					+ '</td>'
					+ '<td class=" numberColumn">'
					+ list[i].receivedQty
					+ ' '
					+ list[i].receivedQtyUOM
					+ '</td>'
					+ '<td class="lastColumn numberColumn">'
					+ list[i].totPackSizeQtyRcvd
					+ ' '
					+ list[i].totPackSizeQtyUom
					+ '</td>'
					+ '</tr>'
					+ '<tr data-tt-id="2" data-tt-parent-id="1" style="display: none;"><td colspan="7"><span class="indenter"></span><table cellspacing="0" class="ContentTable" width="100%">'
					+ '<tbody><tr><td class="keyInfo" width="20%">Unsupplied Quantity:</td><td class="valueInfo">##</td><td class="keyInfo" width="20%">SOH:</td><td class="valueInfo">'
					+ '##</td><td class="keyInfo" width="20%">SIT:</td><td class="valueInfo lastColumn">##</td></tr><tr class="lastRow"><td class="keyInfo">Allocated Quantity:</td>'
					+ '<td class="valueInfo">##</td><td class="keyInfo">SOO:</td><td class="valueInfo">##</td><td class="keyInfo">OM:</td><td class="valueInfo">##</td></tr></tbody></table></td>';

		}
	}
	return allTblContent;

}
function formUnsuppItemList(orderList) {

	var flag = false;
	var unsuppliedTblContent = '<tr ><th rowspan="2">Article #</th>	<th rowspan="2" class="columnDivider">Description</th><th colspan="2" class="columnDivider centerValue">Order</th>'
			+ '<th colspan="2" class="columnDivider centerValue">Allocation Sent</th><th colspan="2" class="columnDivider centerValue">PICK Request</th>'
			+ '<th colspan="2" class="columnDivider centerValue">Received</th><th colspan="2" class="centerValue lastColumn">Unsupplied</th></tr><tr class="subHeader">'
			+ '<th class="numberColumn">OM</th><th class="columnDivider numberColumn">Qty.</th><th class="numberColumn">OM</th><th class="columnDivider numberColumn">Qty.</th>'
			+ '<th class="numberColumn">OM</th><th class="columnDivider numberColumn">Qty.</th><th class="numberColumn">OM</th><th class="columnDivider numberColumn">Qty.</th>'
			+ '<th class="centerValue">Difference</th><!--<th class="lastColumn">Reason</th>--></tr>';
	if (orderList != null) {
		for ( var j = 0; j < orderList.length; j++) {
			if ((null != orderList[j].orderQty && orderList[j].orderQty != "")
					&& (null != orderList[j].receivedQty && orderList[j].receivedQty != "")) {
				for ( var k = j; k < orderList.length; k++) {
					if ((null != orderList[k].orderQty && orderList[k].orderQty != "")
							&& (null != orderList[k].receivedQty && orderList[k].receivedQty != "")) {
						var inner = Math.abs(Number(orderList[k].orderQty)
								- Number(orderList[k].receivedQty));
						var outter = Math.abs(Number(orderList[j].orderQty)
								- Number(orderList[j].receivedQty));
						if (outter < inner) {
							var temp = orderList[j];
							orderList[j] = orderList[k];
							orderList[k] = temp;
						}
					}
				}
			}
		}
		var list = orderList;
		for ( var i = 0; i < list.length; i++) {
			if (list[i].unSuppliedQty != null
					&& list[i].unSuppliedQty.trim() != ''
					&& parseInt(list[i].unSuppliedQty.trim()) != 0) {

				list[i].orderUOM = (list[i].orderUOM != null && list[i].orderUOM != undefined) ? (list[i].orderUOM)
						: '';
				list[i].orderQty = (list[i].orderQty != null && list[i].orderQty != undefined) ? (list[i].orderQty)
						: '';
				list[i].allocatedQtyUOM = (list[i].allocatedQtyUOM != null && list[i].allocatedQtyUOM != undefined) ? (list[i].allocatedQtyUOM)
						: '';
				list[i].allocatedQty = (list[i].allocatedQty != null && list[i].allocatedQty != undefined) ? list[i].allocatedQty
						: '';
				list[i].pickReqUOM = (list[i].pickReqUOM != null && list[i].pickReqUOM != undefined) ? (list[i].pickReqUOM)
						: '';
				list[i].packReqQty = (list[i].packReqQty != null && list[i].packReqQty != undefined) ? (list[i].packReqQty)
						: '';
				list[i].receivedQtyUOM = (list[i].receivedQtyUOM != null && list[i].receivedQtyUOM != undefined) ? (list[i].receivedQtyUOM)
						: '';
				list[i].receivedQty = (list[i].receivedQty != null && list[i].receivedQty != undefined) ? (list[i].receivedQty)
						: '';
				list[i].unsuppliedDiff = (list[i].unsuppliedDiff != null && list[i].unsuppliedDiff != undefined) ? (list[i].unsuppliedDiff)
						: '';
				list[i].unsuppliedReason = (list[i].unsuppliedReason != null && list[i].unsuppliedReason != undefined) ? (list[i].unsuppliedReason)
						: '';
				unsuppliedTblContent += '<tr class="lastRow unSuppItem">'
						+ '<td>'
						+ list[i].article.replace(/^0+/, '')
						+ '</td><td class="columnDivider">'
						+ list[i].articleDesc
						+ '</td><td class="numberColumn">'
						+ list[i].orderUOM
						+ '</td><td class="columnDivider numberColumn">'
						+ list[i].orderQty
						+ '</td>'
						+ '<td class="numberColumn">'
						+ list[i].allocatedQtyUOM
						+ '</td><td class="columnDivider numberColumn">'
						+ list[i].allocatedQty
						+ '</td>'
						+ '<td class="numberColumn">'
						+ list[i].pickReqUOM
						+ '</td><td class="columnDivider numberColumn">'
						+ list[i].packReqQty
						+ '</td><td class="numberColumn">'
						+ list[i].receivedQtyUOM
						+ '</td><td class="columnDivider numberColumn">'
						+ list[i].receivedQty
						+ '</td><td class="centerValue valueInfo">'
						+ list[i].unSuppliedQty
						+ '</td><!--<td class="lastColumn">'
						+ list[i].unsuppliedReason + '</td>--></tr>';
				flag = true;
			}
		}
	}
	if (flag)
		return unsuppliedTblContent;
	else
		return '';
}
function formStoreContent(obj) {
	content = '<div class="articleDetails"><table cellspacing="0" class="ContentTable" width="100%"><tr><td class="keyInfo" width="20%">'
			+ 'Receiving Store:</td><td class="valueInfo" width="15%">'
			+ obj.receivingStore
			+ '</td><td class="keyInfo" width="15%">Sending Store:</td>'
			+ '<td class="valueInfo" width="15%">'
			+ obj.vendorNo.replace(/^0+/, '')
			+ '</td><td class="keyInfo" width="15%"><!--Value ($):--></td><td class="valueInfo lastColumn"></td></tr></table></div>';

	return content;
}
function formDeliveryContent(obj, deliveryList, j) {
	var content = '';
	var selectedId = '';
	// if(j != 0){
	selectedId = j;
	// }
	if (deliveryList != null && deliveryList != "" && deliveryList.length > 0
			& somOrderNoExists
			&& obj.portalOrderType != orderTypeWarehouseOrders) {
		content += '<table cellspacing="0" class="ContentTable" width="100%">'
				+ '<tbody><tr><td class="keyInfo" width="20%">Delivery Status:</td>'
				+ '<td class="lastColumn valueInfo" width="15%">';
		if (somOrderNoExists && deliveryList.length > 1) {
			for ( var i = 1; i < deliveryList.length; i++) {
				content += deliveryList[i].delievryNo.replace(/^0+/, '');
				if (i != deliveryList.length - 1)
					content += ',';
			}
		} else if (deliveryList.length == 1 && somOrderNoExists)
			content += obj.deliveryStatus;
		content += '</td></tr>' + '</tbody></table>';
	}

	if (obj.portalOrderType == orderTypeWarehouseOrders && deliveryList != null
			&& deliveryList != "" && deliveryList.length > 0) {

		content += '<table cellspacing="0" class="ContentTable" width="100%">'
				+ '<tbody><tr><td class="keyInfo" width="20%">Delivery Status:</td>'
				+ '<td class="valueInfo" width="15%">';
		if (somOrderNoExists && deliveryList.length > 1) {
			for ( var i = 1; i < deliveryList.length; i++) {
				content += deliveryList[i].delievryNo.replace(/^0+/, '');
				if (i != deliveryList.length - 1)
					content += ',';
			}
		} else if (deliveryList.length == 1 && somOrderNoExists)
			content += obj.deliveryStatus;
		else
			content += obj.deliveryStatus;
		content += '</td><td class="lastColumn" width="65%"><label class="linkBtn">'
				+ '<a class="more" id="section-'
				+ selectedId
				+ '-moreDetails">+ more </a>'
				+ '<a class="more less hideBlock" id="section-'
				+ selectedId
				+ '-lessDetails">- less </a>'
				+ '</label></td></tr>'
				+ '</tbody></table>';

		content += '<table cellspacing="0" class="ContentTable hideBlock" width="100%" id="deliveryStatusDetails'
				+ selectedId + '">' + '<tbody>' + '</tbody></table>';
	}

	return content;
}
function orderSubHdr(obj, type, delivery) {
	// <label class="editRecord" id="editAutho">&nbsp;</label>
	var content = '<div class="articleHead"><div class="articleHeaderWrapper"><h2 class="articleTitle">'
			+ delivery
			+ '</h2><p>'
			+ '<label class="articlePriceLabel">Delivery Date: <strong>'
			+ obj.delvDate.replace('.', '/').replace('.', '/')
			+ '</strong><label class="editRecord hideBlock" id="editdDate">&nbsp;</label></label>';
	// +'<label class="articlePriceLabel">|</label> <label
	// class="articlePriceLabel">Total Articles: <strong
	// class="totalArticle">100</strong>';
	if (obj.orderStatus == 'RECEIVED' && obj.portalOrderType == 'VENDOR') {
		content += '<label class="articlePriceLabel vendorClaim';
		if (obj.vendorClaimNo == '')
			content += ' hideBlock';
		content += '"> |</label>'
				+ ' <label class="articlePriceLabel vendorClaim ';
		if (obj.vendorClaimNo == '')
			content += ' hideBlock';
		content += '"  style="">Vendor Authorisation # <strong id="headervendorAutho">'
				+ obj.vendorClaimNo + '</strong></label>';
	}
	content += '</p></div>'
			+ '<div class="articleActionBtns"><label class="orderStatus">Status: <strong>'
			+ obj.orderStatus + '</strong></label>'
			+ '<label class="actionBtn hideBlock">'
			+ '<label class="notepadCross">CancelOrder</label></label>';
	if (type == 'overAll'
			&& ((obj.orderStatus == 'RECEIVED' && obj.portalOrderType == 'VENDOR') || (obj.portalOrderType == 'WAREHOUSE'))) {
		content += '<span id="dropdown" class="actionBtn ">';
		if (obj.portalOrderType == 'WAREHOUSE')
			content += '<label class="dropdownLabel varianceRpt">Variance Report</label>';
		if (obj.orderStatus == 'RECEIVED' && obj.portalOrderType == 'VENDOR')
			content += '<label class="notepad vendoerClaim '
					+ EnterVendorClaimAuthorityNumber
					+ '">Vendor Authorisation # </label>';
		content += '</span>';
	}
	content += '</div></div>';
	return content;
	/*
	 * if(type=='overAll' && ( (obj.orderStatus=='RECEIVED' &&
	 * obj.orderType=='Normal PO') ))
	 * 
	 * {content+='<span id="dropdown" class="selectDropdown">' +'<label
	 * class="actionBtn" id="dropdownSelect" tabindex="3"><label
	 * class="createBtn">More</label></label>' +'<ul class="dropdown">'; if(
	 * obj.orderType=='Retail STO') content+='<li><label class="dropdownLabel
	 * varianceRpt">Variance Report</label></li>';
	 * if(obj.orderStatus=='RECEIVED' && obj.orderType=='Normal PO') content+='<li><label
	 * class="dropdownLabel vendoerClaim">Vendor Claims</label></li>';
	 * content+='</ul></span>';
	 */
}
function bindOrderDtlContent(orderHd, tabHeader, tabSection, itemAllList,
		itemUnsuList, grSelect, currentTab, itemInfo) {
	$('.tabbedOrderDetail .articleHead .articleHeaderWrapper').html('').html(
			orderHd);
	// $('.sectionTabs ul').html('').html(tabHeader);
	$('.detailsSections').html('').append(tabHeader + tabSection + '</div>');
	$('.sectionTabs').tabs();
	$('.contentWrapper.orders').addClass('hideBlock');
	$('.contentWrapper.tabbedOrderDetail').removeClass('hideBlock');
	$('.articleHead').removeClass('hideBlock');
	$('#tabs-all #treetable').html('').html(itemAllList);
	$('.deliveryTbls').html('').html(itemAllList);
	$('#tabs-unsup .ContentTable').html('').html(itemUnsuList);
	$('#itemTabs').tabs();
	// $('.allTab').text('All ('+$('.allItem').length+')');
	$('li[aria-controls="tabs-all"] a').text(
			'All (' + $('#tabs-all .allItem').length + ')');
	if ($('#tabs-unsup .unSuppItem').length == 0) {
		$('li[aria-controls="tabs-unsup"] ').addClass('hideBlock');
		$('li[aria-controls="tabs-unsup"] a').text(
				'Over / Under Supply (' + $('#tabs-unsup .unSuppItem').length
						+ ')');
	} else {
		$('li[aria-controls="tabs-unsup"] a').text(
				'Over / Under Supply (' + $('#tabs-unsup .unSuppItem').length
						+ ')');
	}
	if (!((commonOrder.orderStatus != 'RECEIVED' && commonOrder.orderStatus == 'PARTIALLY RECEIVED') || (commonOrder.orderStatus == 'RECEIVED' && commonOrder.orderStatus != 'PARTIALLY RECEIVED')))
		$('.filterMenuOptions').addClass('hideBlock');
	$('.grnSelect').html('').html(grSelect);
	$('.enq').addClass('hideBlock');
	$('.dtl').removeClass('hideBlock');
	$('#brud_order_lookup').removeClass('hideBlock').removeClass('currentPage').addClass('cursor-pointer');
	$('#brud_update_order').addClass('hideBlock').removeClass('cursor-pointer').removeClass('currentPage');
	$('#brud_order_detail').removeClass('hideBlock').removeClass('cursor-pointer').addClass('currentPage');
	$("#sections").tabs("option", "active", currentTab - 1);
	$('.totalArticle').text(itemInfo.data.length);
	// setTimeout(function(){$( "#sections" ).tabs( "option",
	// "active",currentTab);},500);
	$(".selectDropdown").click(function() {
		if ($('.selectDropdown').hasClass('active')) {
			$(".selectDropdown").removeClass('active');
			$(".selectDropdown .dropdown").css('opacity', '0');
		} else {
			$(".selectDropdown").addClass('active');
			$(".selectDropdown .dropdown").css('opacity', '1');
		}
	});
	$('.selectDropdown').css('padding-right', '10px');

	$('#showFilterResult')
			.click(
					function() {
						var grNo = $('.grnSelect').val();
						var year = ($('.' + $('.grnSelect').val()).attr('id') != undefined ? ($(
								'.' + $('.grnSelect').val()).attr('id').split(
								'-').length > 0 ? $('.' + $('.grnSelect').val())
								.attr('id').split('-')[1].trim()
								: '')
								: '');
						var data = {
							grNo : grNo,
							year : year
						};
						if ($('.grnSelect').val() == 'All') {
							$('#itemTabs').tabs("option", "active", 0);
							// $('#tabs-all').addClass('ui-tabs-active').addClass('ui-state-active');
							hideFilteredArticle();
						} else {
							getGrAtricles(data);
						}
					});
	$('li[aria-controls="tabs-all"],li[aria-controls="tabs-unsup"]').click(
			function(e) {
				$(this).addClass('ui-tabs-active');
				hideFilteredArticle(e);
			});
	$('.vendoerClaim').click(function() {
		$("#vendorAuthNo").val("");
		$("#dialog-modal-autho").dialog("open");
	});
	$('.varianceRpt').click(function() {
		getWarehouseVariance(commonOrder.orderNo);
	});
	$(".ui-tabs-anchor")
			.click(
					function() {
						var selectedId = $(this).attr("href").split('-')[1];
						if ($('#section-' + selectedId + ' .filterTabs ').length == 0) {
							if (!isNaN(selectedId)) {
								var segDeliveryNo = $(
										'.segmentNo-' + selectedId).text()
										.split(':')[1].trim();
								if ($(
										'#section-' + selectedId
												+ ' .segArtList' + selectedId)
										.html() == undefined) {
									$
											.ajax({
												type : "GET",
												url : "getOrderItemDetails.htm",
												beforeSend : function() {
													startLoading();
												},
												data : {
													orderNo : segDeliveryNo
												},
												success : function(response) {
													var output = $
															.parseJSON(response);
													var segOrderList = output.data;
													segmentOrderList = segOrderList;
													var listOfArticleHTML = formItemHdrForSeg(
															segOrderList,
															selectedId);
													$(
															'#section-'
																	+ selectedId
																	+ ' .filterTabs ')
															.remove();
													$(listOfArticleHTML)
															.insertAfter(
																	'#section-'
																			+ selectedId
																			+ ' .articleContentInner');

													$('#itemTabs').tabs();
													stopLoading();
												},
											});
								}

							}
						}
					});
}
function bindDropDownGrEvent(data, orderNo){
	if($('.grnSelect option').length == 0){
	var output = '';
	//var dt={ orderNo : $('#verifyGRN').val()};
	var dt={ orderNo : orderNo};
		$.ajax({
			type : "get",
			url : "../allocation/getGrInfoDetails.htm",
			data : dt,
			beforeSend : function() {
				fullScreenLoader();
			},
			success : function(response) {
					output = $.parseJSON(response);
					var grInfo=$.parseJSON(output.data.grInfo);
					var grSelect='';
					grSelect=grInfoList(grInfo.data);
					$('.grnSelect').html('').empty().html(grSelect);
					$('.grnSelect').val('');
					$.loader('close');
					securityMatrix();
			},
			error : function() {
				// goToLogin();
			},
		});
	}
}
function showError(msg) {
	$('.ContentTableWrapperError').removeClass('hideBlock');
	$('#errorMsgDiv, #errorMsg').removeClass('hideBlock');
	$('#errorMsgDiv').addClass('errorDiv').find('#errorMsg').text(msg);
	$("#errorMsgDiv").removeClass('nodataMessage');
	
	//$('.ContentTableWrapper').addClass('hideBlock');
	hideContent();
}
/*function hideContent() {
	$(
			'#reportContent,#reportContent .tableInfo .tableTitle,#reportContent .tableInfo .tableActionBtns,.ContentTable.actionRows')
			.addClass('hideBlock');
	$('.paginationWrapper').hide();
}*/
/*commenting this unwanted function call as part of application settings CR function securityMatrix() {
	var userAcc = $('#userAccess').val();
	if (userAcc != undefined && userAcc != null && userAcc.trim() != '') {
		var userAccess = $.parseJSON($('#userAccess').val());
		if (userAccess.data != null && userAccess.data != undefined) {

			// var option = $("<h4>").html(response).find("#option").val();
			var storeMap = userAccess.data;
			$('.navWrapper li .reportBtmBrdr ').addClass('hideBlock');
			$('.navWrapper li.subMenu').removeClass('hideBlock');
			for ( var m in storeMap) {
				var list = [];
				list = storeMap[m];
				$('.' + m).removeClass('hideBlock').removeClass('R').show();
				for ( var i = 0; i < list.length; i++) {

					if (list[i].accessFlag == 'R' && m != 'AC_UM') {
						$('.' + m).addClass('R').unbind('click').removeAttr(
								'onclick');
						if (m == 'AC_VUD' || m == 'AC_UUD') {
							$('a.'+m).unbind('click').removeAttr('onclick');
							if (m == 'AC_UUD') {
								$('.' + m).find('td').find('label').unbind(
										'click').removeAttr('onclick');
							}
						}
						/*if( m == 'VID')
							{
							$('tr.'+m).unbind('click').removeAttr('onclick');
							} commenting this part of code for application settings CR*/
						/*if (m == 'RTVF') {
							$('tr.' + m).unbind('click').removeAttr('onclick');
						}applicationSettings CR
						if (m == 'AC_EPP') {
							blockPromotionDetailScreen();
						}
						if (m == 'AC_VOD') {
							canViewOrderDetail=false;
						}// Fix as per discussion with Sahithya for defect 14615
					}
					if (list[i].includeExcludeFlag != null
							&& list[i].includeExcludeFlag != ''
							&& list[i].includeExcludeFlag != undefined
							&& list[i].includeExcludeFlag == 'E') {
						$('.' + m).addClass('hideBlock');
					}
					if (list[i].includeExcludeFlag != null
							&& list[i].includeExcludeFlag != ''
							&& list[i].includeExcludeFlag != undefined
							&& list[i].includeExcludeFlag == 'R') {
						disableFunction(m);
					}
				}
			}
			hideSubmenu();
		}
	}

	if ($('#roleId').val() == 'ADM') {
		$('.applic-settings').removeClass('hideBlock');
	}

	$('.headWrapper .navWrapper a,[href="../login/goingHome.htm"]').unbind("click");
	$('.headWrapper .navWrapper a,[href="../login/goingHome.htm"]').bind("click", function(e) {

		e.preventDefault();
		var href = $(this).attr('href');
		
		//if (!$(this).parent().hasClass('R')) {
		
		//}
		//added for defect 2898+3489
		if(($('#navBarHighlight').val() == 'stockManage' || $('#navBarHighlight').val() == 'lookUp') && !$('#sohLookupContainer').is(':visible') && $('.sohArticleDetails').is(':visible'))
			{
			if($('#endSOHValue').text() != $('#endSOHValue').attr('initialValue')){//some changes are there..so warning mesg
				//var returnMsg ='You have made changes on this page that you have not yet confirmed. If you navigate away from this page you will lose your unsaved changes';
				$.fn.warnPopup('warn',leaveScreenMsg,'Stock Adjustment',triggerLeaveStkAdjYes,triggerLeaveStkAdjNo,'',$(this),'Discard/Back');
			}else{//no changes.no warning.just redirect
				handleLeaveStkAdjYes(e);
			}
			}// defect 5891
		else if(($('#navBarHighlight').val() == 'reports') && $('#uldSweepForm').is(':visible'))
			{							//Defect 5891
			if( $('#addULDTable tbody tr').length > 0 || $('#uldSweepForm').data('changed')){//some changes are there..so warning mesg
				//var returnMsg ='You have made changes on this page that you have not yet confirmed. If you navigate away from this page you will lose your unsaved changes';
				$.fn.warnPopup('warn',leaveScreenMsg,'Process ULDs',triggerLeaveProcessUldsYes,triggerLeaveStkAdjNo,'',$(this),'');
			}else{//no changes.no warning.just redirect
				generalRedirection(e);
			}
			}
		else
			{
			if(href!= '#')
			window.location.href = href;
			else
				{
				
					if ($(this).parent().hasClass('AC_RPDG')) {
						downloadDGReportPDF();
					} else if ($(this).parent().hasClass('AC_RPSF')) {
						downloadStockFillReportPDF();
					} /*else if ($(this).parent().hasClass('TKCT')) {
						redirectToCT();
					} commenting code for application settings CR else if ($(this).parent().hasClass('AC_UM')) {
						roleIdCall($(this));
					}					
				}
			}
		
		
	});
	
	// TODO to be removed temporarily hard coded to make reports menu visible
/*	$('.RPDL').removeClass('hideBlock');
	$('.RPDL').show();
	$('.RPPLU').removeClass('hideBlock');
	$('.RPPLU').show();
	$('.RPSA').removeClass('hideBlock');
	$('.RPSA').show();
	$('.RPIN').removeClass('hideBlock');
	$('.RPIN').show();
	$('.RPDG').removeClass('hideBlock');
	$('.RPDG').show();
	$('.RPRTC').removeClass('hideBlock');
	$('.RPRTC').show();
	$('.RPGS').removeClass('hideBlock');
	$('.RPGS').show();
	$('.RPOOC').removeClass('hideBlock');
	$('.RPOOC').show();
	$('.RPOS').removeClass('hideBlock');
	$('.RPOS').show();
	$('.RPSF').removeClass('hideBlock');
	$('.RPSF').show();
	$('.RPLTO').removeClass('hideBlock');
	$('.RPLTO').show();
	$('.STAKE').removeClass('hideBlock');
	$('.STAKE').show();

}*/
function orderHead(obj) {
	var content = '';

	content += '<h2 class="articleTitle orderNumber">Order #';
	if (obj.somOrderNo == "") {
		content += obj.orderNo.replace(/^0+/, '');
		console.log(obj.orderNo);
	} else if (obj.somOrderNo != "") {
		content += obj.somOrderNo + ' (' + obj.orderNo.replace(/^0+/, '') + ')';
		somOrderNoExists = true;
		console.log(obj.somOrderNo);
	}
	content += '</h2><p><label class="articlePriceLabel">' + obj.vendorName;
	if (obj.vendorNo != null && obj.vendorNo != '') {// for Defect_14719
		content += ' (' + obj.vendorNo.replace(/^0+/, '') + ')'; // for Defect_14719
	}
	content += '</label></p>';
	return content;
}
function grInfoList(grInfo) {
	var content = '<option>Select GR</option>';

	if (grInfo != null && grInfo != undefined && grInfo != '') {
		var list = grInfo;

		for ( var i = 0; i < list.length; i++) {
			if (list[i].grNo != null && list[i].grNo != undefined
					&& list[i].grNo != ""
					&& parseInt(list[i].totCarReceived) != 0)
				content += '<option id="' + list[i].grNo + '-'
						+ list[i].grDocYear + '" value="' + list[i].grNo
						+ '" class="' + list[i].grNo + '">' + list[i].grNo
						+ '  (' + parseInt(list[i].totCarReceived)
						+ ')</option>';

		}

	}
	return content;
}
function saveAuthNo(data) {

	//var data = $('#orderEnq').serialize();

	$.ajax({
		type : "post",
		url : "../allocation/saveVendorClaimAuth.htm",
		data : data,
		beforeSend : function() {
			startLoading();
		},
		success : function(response) {

			if (response == 'true') {
				showAlert(
						'Vendor claim authority number updated successfully.',
						'vendorAuthNo');
				$('#headervendorAutho').text($('#vendorAuthNo').val().trim());
				$('.vendorClaim ').removeClass('hideBlock');
				$("#dialog-modal-autho").dialog("close");
			} else {
				showAlert(response, 'vendorAuthNo');
			}
			stopLoading();
		},
		error : function() {
			// goToLogin();
		},
	});
};
function showAlert(msg, id) {
	$('#alertBox').text(msg);
	$('#dialog-alertBox').parent().find('.ui-dialog-title').text(
			'Order Enquiry');
	$("#dialog-alertBox").removeClass('hideBlock');
	$("#dialog-alertBox").parent().addClass("popupWrapper");
	$("#dialog-alertBox").dialog("open");
	$('#okBtn').click(function(e) {
		$("#dialog-alertBox").dialog("close");
		$("#" + id).focus();
		var temp = $("#" + id).val();
		$("#" + id).val(temp);
	});

}

function hideError() {
	$('.ContentTableWrapperError').addClass('hideBlock');
}

function navigateToNGBOOrderDetail(orderNo)
{
	var param =  new orderParam('',orderNo,'','','','','','','','');
	getOrderBasicDetails(param);	
}

function getOrderBasicDetails(param)
{

	var url = getOrderHdrBasicInfoUrl;
	console.log('url '+url+' param '+JSON.stringify(param));
	$.ajax({
      data: JSON.stringify(param),
      url: url,
      type: 'post',
      beforeSend: function() {
    	  startLoading();
      }
	}).done(function(response) {
		if(checkResult(response,'order_no')){
			var hdrObj=response[0];
			if(param.followUp!=null && param.followUp!=undefined){
				param.followUp(param,hdrObj);
			}else{
				if(canViewOrderDetail){
					getOrderDetailForNgboStore(hdrObj);
				}else{
					//donoting
				}
			}		
		}else{
			$.fn.showCustomMsg([nodata],error,'Order Details');
			stopLoading();	
		}
	}).fail(function() {
		$.fn.showCustomMsg([mobiSerErrCode],error,'Order Details');
		stopLoading();
	}).always(function() {
		
	});

}

function getOrderDetailForNgboStore(hdrObj){
	startLoading();
		getOrderDeliveryInfo(hdrObj);
};

function getOrderDeliveryInfo(hdrObj){
	var param = new deleiveryInfoParam(hdrObj);
	orderType=hdrObj.order_type;
	consignmentFlag=hdrObj.source_flag;
	console.log('URL ='+getOrderDeliveryInfoURL+ ' param '+JSON.stringify(param));
	$.ajax({
	    type: "POST",
	    url: getOrderDeliveryInfoURL,
	    data: JSON.stringify(param),
	    beforeSend: function(){
	    	//startLoading();
	    }
	  }).done(function(data) {
		  if((data!=undefined && data.length==0) || checkResult(data,'delivery_no')){
			  var dataObj = {};
			  if(data.length !=0){
				  dataObj = {hdrObj:hdrObj,deliveryObj : data,deliveryFlag : true};
			  }else{
				  dataObj = {hdrObj:hdrObj,deliveryObj : data,deliveryFlag : false};
			  }
			  
			  getOrderHdrDetailInfo(param,dataObj);
		  }else{
			  stopLoading();
		  };
	  }).fail(function() {
		  $.fn.showCustomMsg([mobiSerErrCode],error,'Order Details');
		  stopLoading();
	  }).always(function() {
		  //getOrderItemInfo(param,hdrObj);
	  });
}

function getOrderHdrDetailInfo(param,dataObj,$elem){
	console.log('URL ='+getOrderHdrDetailoUrl+ ' param '+JSON.stringify(param));
	$.ajax({
	    type: "POST",
	    url: getOrderHdrDetailoUrl,
	    data: JSON.stringify(param),
	    beforeSend: function(){
	    	//startLoading();
	    }
	  }).done(function(data) {
		  if((data!=undefined && data.length==0) || checkResult(data,'creation_date')){
			 // era_prof=data[0].era_profile==undefined?'N':data[0].era_profile;
			  if(data.length !=0){
			  era_prof=data[0].era_profile==undefined?'N':data[0].era_profile;
				  dataObj['hdrDtlFlag']= true;
				  dataObj['hdrDtlObj']= data;
                                  preqTypeSer = ((data[0].preq_type == '' || data[0].preq_type == undefined)? '' :data[0].preq_type);
                                  roasterNameSer = ((data[0].roster_name == '' || data[0].roster_name == undefined)? '' :data[0].roster_name);
                                  roasterDateSer = ((data[0].roster_date == '' || data[0].roster_date == undefined)? '' :formatDateToMDY(data[0].roster_date));
                                  deliveryDateSer = ((data[0].delivery_date == '' || data[0].delivery_date == undefined)? '' :formatDateToMDY(data[0].delivery_date));
				  orderNoDtl=data;				 
			   }else{
			  era_prof='';
				  dataObj['hdrDtlFlag'] = false;
				  dataObj['hdrDtlObj']= data;
				   orderNoDtl=data;
			  }
			  if(isPartiallyReceived(dataObj.hdrObj.order_status) || isReceived(dataObj.hdrObj.order_status)){
				  getOrderGRInfo(param,dataObj);
			  }
			  else if(isOpen(dataObj.hdrObj.order_status))
				  {
				  formOpenOrderInfo(dataObj.hdrObj,$elem,dataObj);
				  }
				  else{
				var rec_flag = (isReceived(dataObj.hdrObj.order_status)  || isPartiallyReceived(dataObj.hdrObj.order_status) ) ? 'Y' : 'N';
				dataObj.headerElem =  $elem;
				getOrderItemInfo(new OrderItemParam(dataObj.hdrObj.order_no,dataObj.hdrObj.source_flag,'',rec_flag),dataObj,deliveryItemInfoFollowUp);
			  }
			  headerObj=dataObj;
		  }else{
			  stopLoading();
		  };
	  }).fail(function() {
		  $.fn.showCustomMsg([mobiSerErrCode],error,'Order Details');
		  stopLoading();
	  }).always(function() {
		  
	  });
}


function getOrderGRInfo(paramGRInfo,dataObj){
	//defect 8552
	if((dataObj.hdrObj.order_type=="VENDOR") && (dataObj.hdrObj.order_no!=null || dataObj.hdrObj.order_no!=undefined || dataObj.hdrObj.order_no!="")){
		paramGRInfo.iv_order_no=dataObj.hdrObj.order_no;
	}
	paramGRInfo.iv_order_no = (((dataObj.hdrObj.order_type=="VENDOR")?dataObj.hdrDtlObj[0].asn_no:paramGRInfo.iv_order_no) || paramGRInfo.iv_order_no); // 17.08 Meat Co Vendor Changes
	console.log('URL ='+getOrderGrInfoURL+ ' param '+JSON.stringify(paramGRInfo));
	$.ajax({
	    type: "POST",
	    url: getOrderGrInfoURL,
	    data: JSON.stringify(paramGRInfo),
	    beforeSend: function(){
	    	//startLoading();
	    }
	  }).done(function(data) {
		  if((data!=undefined && data.length==0) || checkResult(data,'gr_no')){
			  if(data.length !=0){
				  dataObj['grFlag']= true;
				  dataObj['grObj']= data;
			  }else{
				  dataObj['grFlag'] = false;
				  dataObj['grObj']= data;
			  }
			  var rec_flag = (isReceived(dataObj.hdrObj.order_status) || isPartiallyReceived(dataObj.hdrObj.order_status)) ? 'Y' : 'N';
			  getOrderItemInfo(new OrderItemParam(dataObj.hdrObj.order_no,dataObj.hdrObj.source_flag,'',rec_flag),dataObj,deliveryItemInfoFollowUp);
		  }else{
			  stopLoading();
		  };
	  }).fail(function() {
		  $.fn.showCustomMsg([mobiSerErrCode],error,'Order Details');
		  stopLoading();
	  }).always(function() {

	  });
}

function getOrderItemInfo(param,dataObj,followUp){
	console.log('URL ='+orderItemInfoURL+ ' param '+JSON.stringify(param));
	var stockTakeFlg = false;
	$.ajax({
	    type: "POST",
	    url: orderItemInfoURL,
	    data: JSON.stringify(param),
	    beforeSend: function(){
	    	//startLoading();
	    }
	  }).done(function(response) {
		  if(response['LV_QTY']== undefined || response['LV_QTY'].length == 0 || !checkResult(response['LV_QTY'],'article')){
	  			$.fn.showCustomMsg([mobiSerErrCode],error);
	  			stopLoading();
		  }else{
			  var data = response['LV_QTY'];
			  if(data.length !=0){
				 for(var i=0; i < data.length;i++){
					 if(data[i].stock_take_flg != null && data[i].stock_take_flg != undefined){
						  if(data[i].stock_take_flg == "Y"){//indicates stocktake for liquor item in progress
							  stockTakeFlg = true; 
						  }
					  } 
				 }
				 dataObj['itemFlag']= true;
				 dataObj['itemObj']= data;
				 dataObj['itemObj_zero']= response['LV_QTY_ZERO'];
				 itemInfo = data;
			  }else{
				  dataObj['itemFlag'] = false;
				  dataObj['itemObj']= data;
				  dataObj['itemObj_zero']= response['LV_QTY_ZERO'];
			  }
			  followUp(dataObj);
			  var tempHdrObj = (dataObj.hdrObj !=undefined && dataObj.hdrObj!=null) ? dataObj.hdrObj : ((dataObj.contObj!=undefined && dataObj.contObj!=null) ? (dataObj.contObj.hdrObj) : null);
			  
			  if(stockTakeFlg){
				  	$.fn.showCustomMsg(['Stocktake for LIQUOR department in progress. Please try to receive this order after the stocktake is finished.'],information);
				  	$(".AC_ROD,.AC_UPRXQTY").addClass("hideBlock");//so hide receive order button 
			  }else if(tempHdrObj!=null && tempHdrObj!=undefined && isReceived(tempHdrObj.order_status) && tempHdrObj.received_date != '' 
	                            && tempHdrObj.received_date != undefined  && salesOrgConfigMap != undefined &&
	                            salesOrgConfigMap['update_recvd_qty'] != undefined) {
	                $(".AC_UPRXQTY").addClass("hideBlock");                                
	                if(compareDate(increaseNumberOfDays(formatDateToMDY(tempHdrObj.received_date), 
	                        salesOrgConfigMap['update_recvd_qty']), currDate()) == 'gt'){   
                          $(".AC_UPRXQTY").removeAttr("style");                                
	                        $(".AC_UPRXQTY").removeClass("hideBlock");//so hide update received qty button for smkt
	                }                         
	         }stopLoading();
		  } 
	  }).fail(function() {
		  $.fn.showCustomMsg([mobiSerErrCode],error);
		  stopLoading();
	  }).always(function() {

	  });
}

var OrderItemParam = function(orderNo,source,grNo,receive_flag){
	this.iv_order_no= orderNo;
	this.iv_site = siteNo;
	this.iv_session_id = '';
	this.iv_user_id = userId;
	this.iv_source_flag = source;
	this.iv_retain_session_flag = 'N';
	this.iv_sales_org = salesOrg;
	this.iv_gr_no = (grNo||'');
	this.iv_receive_flag = (receive_flag||'N');
	this.iv_display_flag='N';
};

function orderParam(article, orderNo, fromDate,toDate,orderType,orderStatus,nodeId,nodeLvl,srcInd,supplier,tab_code,article_filter,ranged){
	this.iv_article =article;
	this.iv_order_no = orderNo;
	this.iv_delivery_from =fromDate;
	this.iv_delivery_to = toDate;
	this.iv_order_type = orderType;
	this.iv_order_status = orderStatus;
	this.iv_node_id = nodeId;
	this.iv_node_lvl =nodeLvl;
	this.iv_node_level =nodeLvl;
	this.iv_srs_ind =srcInd;
	this.iv_src_supply = srcInd;
	this.iv_supplier_no = supplier;
	this.iv_supplier = supplier;
	this.iv_session_id = '';
	this.iv_site = siteNo;
	this.iv_sales_org = salesOrg;
	this.iv_check_alloc ='';
	this.iv_alloc_flag ='Y';
	this.iv_ranged= (ranged == undefined ? 'Y' : 'N');
	this.iv_barcode = '';
	this.iv_desc='';
	this.iv_article_no ='Y';
	this.iv_gtin ='';
	this.iv_barcode_flag ='';
	this.iv_auto_stockr_flag ='N';
	this.iv_prime_vendor = '';
	this.iv_auto_stockr_flag ='N';
	this.iv_delisted_flag ='N';
	this.iv_uom_flag = 'N';
	this.iv_tab_code =(tab_code||'');
	this.iv_article_filter =(article_filter||'N');	
	this.iv_deleted_flag= 'N';
	
};

function deleiveryInfoParam(hdrObj,article_filter){
	this.iv_order_no =hdrObj.order_no;
	this.iv_site =siteNo;
	this.iv_session_id = '';
	this.iv_user_id =userId;
	this.iv_article ='';
	this.iv_order_type='';
	this.iv_order_status='';
	this.iv_article_filter =(article_filter||'N');
    this.iv_source_flag=hdrObj.source_flag;	
    this.iv_tab_code = hdrObj.tab_code;
}

var isOpen = function(status){
	return (status == openStautus);
};
var isIbtOut = function(obj){
	return (isST(obj.order_type) && ((obj.supplier_no||'') == siteNo));
};

var isSubmit = function(status){
	return (status == submitStatus );
};

var isPartiallyReceived = function(status){
	return (status == partialStatus );
};

var isReadyToReceive = function(status){
	return (status == diapatchStatus || status == authStatus || status==partialStatus);
};

var isDispatch = function(status){
	return (status == diapatchStatus);
};

var isAuth = function(status){
	return (status == authStatus);
};

var isReceived = function(status){
	return (status == receStatus);
};
var isSugo = function(source){
	source = (source||'');
	return source.toUpperCase() == sugo;
};
var isPO = function(type){
	return ((type||'').toUpperCase() == poType.toUpperCase());
};

var isSTO = function(type){
	return ((type||'').toUpperCase() == stoType.toUpperCase());
};

var isST = function(type){
	return ((type||'').toUpperCase() == stType.toUpperCase());
};
var isPost = function(flag){
	return ((flag||'') == 'Y');
};
var isEmergency = function(source){
	source = (source||'');
	return source.toUpperCase() == emergency;
};

var isCancelled = function(status){
	return (status == cancelStatus);
};
var deliveryItemInfoFollowUp = function (dataObj){
	var rec_flag = (isReceived(dataObj.hdrObj.order_status) || isPartiallyReceived(dataObj.hdrObj.order_status)) ? 'Y' : 'N';
	var hdrObj = dataObj.hdrObj;
	var deliveryFlag = dataObj.deliveryFlag;
	var $contHold = getOrderDetailMainWrapper();
	var	cont = '';
	var title = 'all';
	setSegHdrInfoDtls(dataObj,dataObj.itemObj);
	setTotalPallets(dataObj,dataObj.deliveryObj);
	cont += formOtherOrderHead(hdrObj,deliveryFlag,dataObj);
	if(dataObj.deliveryFlag){
		cont+= formSegmentDetailSection(dataObj);
	}else if(isIbtOut(dataObj.hdrObj)){
		title = '';
		cont+= stockTransOrderHeaderInfo(dataObj)+itemInfoSegOrder('',dataObj);
	}else{
		cont+= frameSegCont('',dataObj,'')+itemInfoSegOrder(title,dataObj);
	}
	$contHold.append(cont);
	frameItemCont(dataObj,title);
	
	bindOrderDetailCont($contHold,dataObj);
	navigate(detail);
	getOrderComponentesItemInfo(new OrderItemParam(dataObj.hdrObj.order_no,dataObj.hdrObj.source_flag,'',rec_flag),dataObj);
	securityMatrix();//added as the vendor authorisation to be hidden or shown based on app settings
};

function getOrderDetailMainWrapper(){
	var $orderDtl = $('#order_detail');
	if($orderDtl == undefined || $orderDtl.length==0){
		var orderDtlWrapp = '<div class="contentWrapper orderWrappers hideBlock" id="order_detail" ></div><div id="receive_order" class="contentWrapper hideBlock" ></div>';
		$('#orderLookUpWrapper').append(orderDtlWrapp);
		$orderDtl = $('#orderLookUpWrapper').find('#order_detail');$orderDtl.addClass('dataContHolder');
	}
	return $orderDtl.html('');
}

var setSegHdrInfoDtls = function(dataObj,data){
	
	var tempMap ={};
	var tempArray =[];
	var cont ='';
	var dept ='';
	var temp ='';
	var totOrderQty = '';
	var totDispQty = '';
	var totReceQty = '';
	var receQty = '';
	var yetToReceive = [];
	var received = [];
	var sobj = [];
	var lobj = [];
	var over_lay = [];
	var under_lay = [];
	var over_supply = [];
	var under_supply = [];
	var suggested_qty = 0;
	var demand_qty = 0;
	var over_under_layQty = 0;
	var diff_receive = 0;
	var totWeightReceived = '';
	var totWeightDispatched = '';
	var tot_art_cnt = data.length;
	var totalOrderedUnits = '';
	var totalReceivedUnits = '';
	var totalDispUnits = '';
	var receiveFlag = false;
	var dispFlag = false;
	dataObj.tot_art_cnt = tot_art_cnt;
	var checkCount= 0;
	
	for(var i =0;i<tot_art_cnt;i++){
		temp ='';
		dept = (data[i]['department_no']||'');
		if(data[i].order_qty!=null && data[i].order_qty!=undefined && data[i].order_qty.toString()!=''){
			order_qty = Number(data[i].order_qty);
			totOrderQty = Number(totOrderQty) + Number(order_qty);
		}
		
		if(data[i].received_qty!=null && data[i].received_qty!=undefined && data[i].received_qty.toString()!=''){
			receQty = Number(data[i].received_qty);
			totReceQty = Number(totReceQty) + Number(receQty);
			receiveFlag = true;
		}else{
			receiveFlag = false;
		}
		
		if(data[i].dispatched_qty!=null && data[i].dispatched_qty!=undefined && data[i].dispatched_qty.toString()!=''){
			totDispQty = Number(totDispQty) + Number(data[i].dispatched_qty);
			dispFlag = true;
		}else{
			dispFlag = false;
		}
		
		if(data[i].rnd_wgt!=null && data[i].rnd_wgt!=undefined && data[i].rnd_wgt.toString()!=''){
			totWeightReceived = Number(totWeightReceived) + Number(data[i].rnd_wgt);
		}
		if(data[i].dispathced_wgt!=null && data[i].dispathced_wgt!=undefined && data[i].dispathced_wgt.toString()!=''){
			totWeightDispatched = Number(totWeightDispatched) + Number(data[i].dispathced_wgt);
		}
		
		suggested_qty += Number(data[i].overlay_qty);
		demand_qty += Number(data[i].demand_qty);
		var obj = data[i];
		var qty = '';
		var baseUom = ((obj.base_uom||'')!='' ? obj.base_uom : '');
		var order_uom = ((obj.order_uom||'')!='' ? obj.order_uom : '');
		var om = /*((obj.random_wt_flag||'').trim()=='Y' ? ((obj.pi_om||'')!='' ? obj.pi_om:1) :*/ ((obj.om||'')!='' ? obj.om:1)/*)*/;//for defect 2281
		var totalOrdermultiple = (obj.pack_size || 0);
        var totalReceivedmultiple = (obj.recv_om || 0);
        multiple = (order_uom == baseUom) ? 1 : Number(om);
		qty = ((obj.order_qty||'')!='' ? obj.order_qty : 0);
		totalOrderedUnits = qty*totalOrdermultiple;
		if(obj.recv_om != null && obj.recv_om.toString() != ""/* && obj.recv_om != 0  */)
		om =(obj.recv_om || '');
		multiple = (order_uom == baseUom) ? 1 : Number(om);
		qty = ((obj.received_qty||'')!='' ? obj.received_qty : 0);
		totalReceivedUnits = qty*totalReceivedmultiple;
		if(obj.dispatched_om != null && obj.dispatched_om.toString() != "" /*&& obj.dispatched_om != 0  */)
			om =(obj.dispatched_om || '');
		
		qty = ((obj.dispatched_qty||'')!='' ? obj.dispatched_qty : 0);
		totalDispUnits = qty*om;
		
		(data[i].temperature_range_code||'' =='CH' || data[i].temperature_range_code||''=='HF') ? checkCount++ :'';
		if(receiveFlag || dispFlag){
		
			//diff_receive = (totalOrderedUnits - totalReceivedUnits);
			if(dispFlag){
				//diff_receive = (totalDispUnits - totalReceivedUnits);
				diff_receive = (totalOrderedUnits - totalDispUnits);
				dataObj.over_under_supply_reas = 'D';
			}else {
				diff_receive = (totalOrderedUnits - totalReceivedUnits);
				dataObj.over_under_supply_reas = 'R';
			}
			diff_receive = diff_receive.toFixed(0);
			if(diff_receive < 0){
				over_supply.push(data[i]);
				dataObj.over_under_supply_flag = true;
				data[i].over_or_under_class_sup = 'valueUp';//Defect 2584
				data[i].over_or_under_supply_qty = -(diff_receive);
				sobj.push(data[i]);
			}else if(diff_receive>0){
				under_supply.push(data[i]);
				dataObj.over_under_supply_flag = true;
				data[i].over_or_under_class_sup = 'valueDown';//Defect 2584
				data[i].over_or_under_supply_qty = (diff_receive);
				sobj.push(data[i]);
			}
			if(receiveFlag)
			received.push(data[i]);
			else
				yetToReceive.push(data[i]);
		}else{
			yetToReceive.push(data[i]);
		};
		data[i].newOrderTot = totalOrderedUnits;
		data[i].newDispTot = totalDispUnits;
		data[i].newReceTot = totalReceivedUnits;
		if((data[i].overlay_qty||'') != 0){
			 if(dataObj.hdrObj.source_flag =='P')    			//for Defect 7414
				{
				
				 over_under_layQty = Number(data[i].overlay_qty)* Number (obj.om);
				}
			else
				{
				
				over_under_layQty = Number(data[i].overlay_qty);
				}
			
			
			if(over_under_layQty < 0){
				over_lay.push(data[i]);
				dataObj.over_under_lay_flag = true;
				data[i].over_or_under_class_lay = 'valueDown';
				data[i].over_under_layQty = -(over_under_layQty %1 > 0 ? (over_under_layQty).toFixed(3) : over_under_layQty);
				lobj.push(data[i]);
			}else if(over_under_layQty>0){
				under_lay.push(data[i]);
				dataObj.over_under_lay_flag = true;
				data[i].over_or_under_class_lay = 'valueUp';
				data[i].over_under_layQty = (over_under_layQty%1 > 0 ? (over_under_layQty).toFixed(3) : over_under_layQty);
				lobj.push(data[i]);
			}
		}
		if(dept!='' && dept !=undefined && !tempMap.hasOwnProperty(dept)){
			tempMap[dept] = dept;
			if(tempArray.length < 3){
				temp =' <strong>'+(tempArray.length > 0 ? ', ':'')+''+data[i]['department_name']+'</strong> ';
			}else if(tempArray.length == 3){
				temp ='<a  class="moreNumber" id="deptMore">CONTENTMORE more</a><label class="hideBlock remain-dept"><strong>, '+data[i]['department_name']+' </strong>';
			}else{
				temp ='<strong>, '+data[i]['department_name']+' </strong>';
			}
			tempArray.push(temp);
		}
	}
	if(checkCount > 0)
	dataObj.tempFlag = 'Y';
	else
	dataObj.tempFlag = 'N';
	if(tempArray.length>0){
		cont ='<label class="articlePriceLabel">Department:'+ tempArray.join(' ').replace('CONTENTMORE',(tempArray.length-3)) +'</label>';
	}
	dataObj.sobj = sobj;
	dataObj.lobj = lobj;
	
	dataObj.deptCont = cont;
	dataObj.received_cnt = received.length;  
	dataObj.yet_to_receive_cnt = yetToReceive.length;
	dataObj.received_art = received;  
	dataObj.yet_to_receive_art = yetToReceive;
	
	dataObj.over_lay_cnt = over_lay.length;  
	dataObj.under_lay_cnt = under_lay.length;
	dataObj.over_under_lay_cnt = (dataObj.over_lay_cnt + dataObj.under_lay_cnt);
	dataObj.under_lay_art = under_lay;
	dataObj.over_lay_art = over_lay;
	
	dataObj.over_supply_cnt = over_supply.length;  
	dataObj.under_supply_cnt = under_supply.length;
	dataObj.over_under_supply_cnt = (dataObj.over_supply_cnt + dataObj.under_supply_cnt);
	dataObj.over_supply_art = over_supply;
	dataObj.under_supply_art = under_supply;
	
	dataObj.totOrderQty = totOrderQty;
	dataObj.totDispQty = totDispQty;
	dataObj.totReceQty = totReceQty;
	dataObj.totWeightReceived = (totWeightReceived!= 0 ? Number(totWeightReceived).toFixed(3) : totWeightReceived);
	dataObj.totWeightDispatched = (totWeightDispatched != 0 ? Number(totWeightDispatched).toFixed(3) : totWeightDispatched);;
	//dataObj.tot_art = totWeightDispatched;
};

var setTotalPallets= function(dataObj,data){
	var total_pallets_recvd = '';
	var total_pallets_returned = '';
	for(var i =0;i<data.length;i++){
		if((data[i].total_pallets_recvd!=null && data[i].total_pallets_recvd!=undefined && data[i].total_pallets_recvd.toString()!=''))
			total_pallets_recvd = Number(total_pallets_recvd) + Number(data[i].total_pallets_recvd);
			
		if((data[i].total_pallets_recvd!=null && data[i].total_pallets_recvd!=undefined && data[i].total_pallets_recvd.toString()!=''))
			total_pallets_returned = Number(total_pallets_returned) +  Number(data[i].total_pallets_returned);
	}
	dataObj.total_pallets_recvd = total_pallets_recvd;
	dataObj.total_pallets_returned = total_pallets_returned;
};

var formOtherOrderHead = function(obj,segment,dataObj){
	salesOrg = $('#salesOrg').val();
	var contentHeader = '';
	if(consignmentFlag=="C"){
	contentHeader+= '<div class="articleHead" id="orderContentHeader"> <div class="articleHeaderWrapper">'
		+'<h2 class="articleTitle" order_type="'+(obj.order_type || '')+'" >'+'Consignment'+' #'+$.tablebuild.dataparse.trim(obj.order_no ||'')+'</h2>'
		+'</div><div class="articleActionBtns">';
	} else{
	contentHeader+= '<div class="articleHead" id="orderContentHeader"> <div class="articleHeaderWrapper">'
		+'<h2 class="articleTitle" order_type="'+(obj.order_type || '')+'" >'+sentenceCase(obj.order_type ||'')+' Order'+' #'+$.tablebuild.dataparse.trim(obj.order_no ||'')+'</h2>'
		+'</div><div class="articleActionBtns">';
	}
	
		contentHeader+= (dataObj.hdrDtlObj[0] != undefined && dataObj .hdrDtlObj[0].era_audit_flag=="Y") ? '<label class="positiveStatus hideBlock" id="auditCheck">Audit Check Required</label>' :'';
	contentHeader+= (dataObj.tempFlag||'' =='Y') ? '<label class="positiveStatus hideBlock" id="tempCheckFlag">Temperature Check</label>' :'';
	
	if(!segment){
		contentHeader+='<label class="orderStatus">Status: <strong id="orderStatus">'+sentenceCase(obj.order_status ||'')+'</strong></label>';
		if((isPartiallyReceived(obj.order_status) || isDispatch(obj.order_status) || 
				(isAuth(obj.order_status) && isSTO(obj.order_type) && dataObj.hdrDtlObj[0].non_disp_flag == 'Y' && dataObj.hdrObj.source_flag == 'D') ||
				(isAuth(obj.order_status) && isPO(obj.order_type))  || (dataObj.hdrDtlObj[0].ibtin_receive_flag == 'Y')) && !isIbtOut(obj)){
			contentHeader+='<label class="orderStatus receiveOrderStatus hideBlock" id="" >Status: <strong >'+(inProgress ||'')+'</strong></label>';
		}
		if(isIbtOut(obj)){
			if(!isCancelled(obj.order_status) && (dataObj.hdrDtlObj[0].alh_recv_site_flag != 'Y') /* && compareDate($.tablebuild.dataparse.mobi_date((dataObj.hdrDtlObj[0].creation_date ||'')),currDate()) == 'eq' */)
			contentHeader+='<label id="commonCancelOrder" class="actionBtn"><a ><label class="notepadCross">Cancel Order</label></a></label>';
			
			contentHeader+='<label id="commonPrintOrder" class="actionBtn" title="Print IBT Order"><a><label class="print">Print</label></a></label>';
		}
		//cancel button for vendor orders defect 2614
		// removed cancel button for dispatched vendor orders, since we will not be able to update them. Checked with vamshi and commented by guru
		if((dataObj.hdrObj.tab_code == "OVERDUE") && (isAuth(obj.order_status) /*|| (isDispatch(obj.order_status))*/) && isPO(obj.order_type))
			{
			contentHeader+='<label id="cancelOrder" class="actionBtn commonReceiveOrder"><a ><label class="notepadCross">Cancel Order</label></a></label>';
			}
		
		if((obj.order_status=="DISPATCHED" && dataObj.hdrDtlObj[0].asn_no!='' && dataObj.hdrDtlObj[0].asn_no !=null && dataObj.hdrDtlObj[0].era_profile=="Y" && salesOrg=="1060") 
				|| ((dataObj.hdrDtlObj[0].era_profile!="Y") && ((isPartiallyReceived(obj.order_status) || isDispatch(obj.order_status) || 
						(isAuth(obj.order_status) && isSTO(obj.order_type) && dataObj.hdrDtlObj[0].non_disp_flag == 'Y' && dataObj.hdrObj.source_flag == 'D') ||
						(isAuth(obj.order_status) && isPO(obj.order_type)) || (dataObj.hdrDtlObj[0].ibtin_receive_flag == 'Y')) && !isIbtOut(obj)))){
				contentHeader+='<label id="commonReceiveOrder" class="actionBtn commonReceiveOrder AC_ROD"><a ><label class="notepad">Receive Order</label></a></label>';
			}
						
		if(isReceived(obj.order_status) && (isPO(dataObj.hdrObj.order_type) && (dataObj.hdrDtlObj[0].asn_no||'') =='') && salesOrg!="1060"){
			contentHeader+='<label class="actionBtn normalMode AC_UPRXQTY" id="commonUpdateQty"><a ><label class="editBtn">Update Received Qty.</label></a></label>';
		}
		if(isPost(dataObj.hdrDtlObj[0].post_flag)){ // changed as the flag was never in obj.post_flag
			contentHeader+='<label class="actionBtn normalMode" id="commonPostSohQty"><a ><label class="notepad">Post &amp; Update SOH</label></a></label>';
		}
		if(isReceived(obj.order_status)){
			contentHeader+='<label class="actionBtn normalMode transferIbt" id="transFerOrder-'+obj.order_no+'-O"><a ><label class="">Transfer</label></a></label>';
		}
		//NEED TO CONFIRM IF THIS IS THE RIGHT PLACE TO PUT THE FOLLOWING CODE
		if(isPO(obj.order_type) && isReceived(obj.order_status)){
			contentHeader+='<span class="parent"><label id="commonVendorClaim" class=" '+EnterVendorClaimAuthorityNumber+' actionBtn"><a ><label class="notepad">Vendor Authorisation #</label></a></label></span>';
			//added span as when security matrix runs then the parent div gor hidden 
		}
		
		if(!isPO(obj.order_type) && isReceived(obj.order_status) && (recvConfigMap['ULD'] != null && recvConfigMap['ULD'] == 'Y')){
			contentHeader+='<label id="'+obj.order_no+'-O" class="actionBtn printULD" title="Print ULD"><a><label class="print">Print ULD</label></a></label>';
		}	
	}
	contentHeader+='</div><div class="articleInfoWrapper">'
		+'<p class="secondaryInfo">';
	if(!isST(obj.order_type)){
		contentHeader+= '<label class="articlePriceLabel">Supplier: <strong>'+getSupplierNo(obj.supplier_name,obj.supplier_no)+'</strong></label>';
	}else{
		contentHeader+= '<label class="articlePriceLabel">Receiving Store: <strong>'+getSupplierNo(dataObj.hdrDtlObj[0].receiving_site_name,dataObj.hdrDtlObj[0].receiving_site)+'</strong></label><label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Sending Store: <strong>'+getSupplierNo(obj.supplier_name,obj.supplier_no)+'</strong></label>';
	}


	contentHeader+= (!segment) ? '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Delivery Date: <strong>'+(obj.delivery_date ||'')+'</strong></label>' : '';
	//contentHeader+= (!segment) ? ((dataObj.deptCont||'' !='') ? ('<label class="articlePriceLabel"> | </label>'+(dataObj.deptCont||'')) :'') :'';
	contentHeader += (isPO(dataObj.hdrObj.order_type) && isReceived(dataObj.hdrObj.order_status)) ? '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Vendor Claim Authority Number: <strong><label id="vendorClaimAuthNoNgbo">'+(dataObj.hdrDtlObj[0].ven_claim_auth_no||'')+'</label></strong><label class="editRecord hideBlock" id="editdDate">&nbsp;</label> </label>' :'';
	contentHeader+= (!segment) ? '<!--<p class="secondaryInfo">--><label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Source: <strong>'+(dataObj.hdrObj.source||'')+'</strong></label>'+((dataObj.hdrDtlObj[0].created_by_user||'').trim()!='' ? '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Created By: <strong> '+(dataObj.hdrDtlObj[0].created_by_user||'')
	+' </strong></label>': '')+'<!--<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Roster Date: <strong> '+$.tablebuild.dataparse.mobi_date((dataObj.hdrDtlObj[0].roster_date ||''))
	+'</strong></label>-->' : '';
	contentHeader += (!isST(obj.order_type)) ? '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">On Show Date: <strong>'+$.tablebuild.dataparse.mobi_date(dataObj.hdrDtlObj[0].on_show_date||'')+'</strong></label>' : '';
	contentHeader+='</p></div></div>';
		return contentHeader;
}; 

var formSegmentDetailSection = function(dataObj){
	var tabCont ='<ul><li><a href="#section-overall"><label class="sectionTitle">Overall Info</label><label class="sectionInfo">Total Deliveries: <strong>'+dataObj.deliveryObj.length+'</strong></label></a></li>';
	var tabContDtl = '<div id="section-overall">'+frameSegSubHdr('all',dataObj,dataObj.hdrObj)+frameSegCont('all',dataObj,0)+itemInfoSegOrder('all',dataObj,'')+'</div>';
	var deliveryNo = '';
	for(var i=0;i<dataObj.deliveryObj.length;i++){
		deliveryNo = (dataObj.deliveryObj[i].delivery_no||'');
		if(consignmentFlag=="C"){
		tabCont+='<li data-seg-index="'+i+'" onclick ="frameIndividualDeliveryCont(\''+deliveryNo+'\',$(\'#section-'+deliveryNo+'\'),'+i+')"><a href="#section-'+deliveryNo+'"><label class="sectionTitle">Delivery '+deliveryNo+'</label><label class="sectionInfo">ASN #<strong>'+(dataObj.deliveryObj[i].asn_no||'')+'</strong></label></a></li>';
		}
		else{	
		tabCont+='<li data-seg-index="'+i+'" onclick ="frameIndividualDeliveryCont(\''+deliveryNo+'\',$(\'#section-'+deliveryNo+'\'),'+i+')"><a href="#section-'+deliveryNo+'"><label class="sectionTitle">Delivery '+deliveryNo+'</label><label class="sectionInfo">Segment #<strong>'+(dataObj.deliveryObj[i].segment_no||'')+'</strong></label></a></li>';
		}
		tabContDtl+= '<div id="section-'+deliveryNo+'" class="dataContHolder">'+frameSegSubHdr('',dataObj,dataObj.deliveryObj[i])+'</div>';
	}
	tabCont+= '</ul>'+tabContDtl;
	var cont ='<div class="detailsSections"><div id="sections-tab" class="sectionTabs">'+tabCont+'</div></div>';
	
	return cont;
};

var frameSegSubHdr =function(title,dataObj,data){
	var segHeadInfo = '<div class="articleHead"><div class="articleHeaderWrapper"><h2 class="articleTitle" order_type="'+(dataObj.hdrObj.order_type || '')+'" >'+(title =='all' ? 'Overall Info' : ('Delivery '+(data.delivery_no||'')))+' </h2></div>'
		+'<div class="articleActionBtns">';
	if(title !='all'){
		segHeadInfo+= (isReadyToReceive(data.status) && ((dataObj.tempFlag||'') =='Y')) ?'<label class="positiveStatus">Temperature Check</label>' :'';
	}
		segHeadInfo+='<label class="orderStatus">Status: <strong>'+(title == 'all' ? sentenceCase(data.order_status||'') : sentenceCase(data.status||''))+'</strong></label>';
		if(title !='all'){
			segHeadInfo+= (isPartiallyReceived(data.order_status) || isDispatch(data.order_status) || isPartiallyReceived(data.status) || isDispatch(data.status) || (isAuth(data.order_status)  || (isAuth(data.status )) && dataObj.hdrDtlObj[0].non_disp_flag == 'Y' && isSTO(dataObj.hdrObj.order_type) && dataObj.hdrObj.source_flag == 'D')
					|| (isAuth(data.order_status)  || (isAuth(data.status )) && isPO(dataObj.hdrObj.order_type))) ? '<label class="actionBtn AC_ROD receiveSegment" id="'+data.delivery_no+'-'+data.asn_no+'"><label class="notepad">Receive Segment</label></label>' :'';
			if(isReceived(data.order_status) || isReceived(data.status)){
				segHeadInfo+= '<!-- <label class="actionBtn" id="update-rec-qty-btn"><a ><label class="editBtn">Update Received Qty.</label></a></label>-->'
				+'<label class="actionBtn hideBlock" id="saveupdateQty_up"><a><label class="">Save</label></a></label><label class="secondaryActionBtn hideBlock" id="cancelUpdateQty_up"><a>Cancel</a></label>';
				segHeadInfo+= ((data.post_flag||'') == 'Y') ? '<label class="actionBtn" id="post-soh-btn"><a ><label class="notepad AC_POSTSOH">Post &amp; Update SOH</label></a></label>' :'';
				segHeadInfo+= '<label class="actionBtn transferIbt" id="'+(data.delivery_no || '')+'-D"><a ><label class="">Transfer</label></a></label>';
				segHeadInfo+= '<label id="'+(data.delivery_no || '')+'-D" class="actionBtn printULD" title="Print ULD"><a><label class="print">Print ULD</label></a></label>';
				
			}
			
			
		}
		segHeadInfo+='</div>';
		segHeadInfo+='<div class="articleInfoWrapper"><p class="secondaryInfo">'
		+'<label class="articlePriceLabel">Delivery Date: <strong>'+(dataObj.hdrObj.delivery_date||'')+'</strong></label>';
		segHeadInfo +=(title !='all' && !isST(dataObj.hdrObj.order_type) ) ? '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">On Show Date: <strong>'+$.tablebuild.dataparse.mobi_date(dataObj.hdrDtlObj[0].on_show_date||'')+'</strong></label>' :'';
		segHeadInfo +=(title !='all') ? '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Total Articles: <strong id="article_cnt_'+(data.delivery_no||'')+'">'+(dataObj.tot_art_cnt||'')+'</strong> </label>' : '';
		segHeadInfo += (isPO(dataObj.hdrObj.order_type) && isReceived(dataObj.hdrObj.order_status)) ? '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Vendor Claim Authority Number: <strong>'+(dataObj.hdrDtlObj[0].ven_claim_auth_no||'')+'</strong> <label class="editRecord hideBlock" id="editdDate">&nbsp;</label> </label>' :'';
		//segHeadInfo += (dataObj.deptCont||'')!='' ? ('<label class="articlePriceLabel"> | </label>'+dataObj.deptCont) :'';
		segHeadInfo += (title == 'all') ? ('<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Source: <strong>'+dataObj.hdrObj.source+'</strong></label>'+((dataObj.hdrDtlObj[0].created_by_user||'').trim()!='' ? '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Created By: <strong> '+(dataObj.hdrDtlObj[0].created_by_user||'')+' </strong></label>': '')+'<!--<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Roster Date: <strong> '+$.tablebuild.dataparse.mobi_date(dataObj.hdrObj.roster_date||'')+'</strong></label>-->') : '';
		segHeadInfo += '</p></div></div>';
		return segHeadInfo;
};

var frameSegCont = function(title,dataObj,segIndex){
	var segmented = (title =='seg') ? true :false ;
	var tot_pall_receive = '';
	var tot_car_receive = '';
	var tot_weig_receive = '';
	var tot_pall_return = '';
	var over_supply = '';
	var receive_cont ='';
	var temperature_cont =''; 
	var invoice_cont ='';
	var status = '';
	var delObj ={};
	
	status = (segmented) ? dataObj.deliveryObj[0].status : dataObj.hdrObj.order_status;
	delObj = (segmented) ? dataObj.deliveryObj[0] : dataObj.hdrDtlObj[0];
	chilled_temp = (segmented || title =='all') ? (dataObj.deliveryObj[0].chilled_temperature): (dataObj.hdrObj.chilled_temp);
	frozen_temp = (segmented || title =='all') ? (dataObj.deliveryObj[0].frozen_temperature) : (dataObj.hdrObj.frozen_temp);
	chilled_temp = (chilled_temp!=null && chilled_temp!=undefined && chilled_temp.toString()!= '') ? chilled_temp:'NA';
	frozen_temp = (frozen_temp!=null && frozen_temp!=undefined && frozen_temp.toString()!= '') ? frozen_temp:'NA';
	var received = (isReceived(status) || isReceived(status));
	var dispatched = (isDispatch(status) || isPartiallyReceived(status));
	var empty_td = '<td class="keyInfo noDivider"></td><td class=" lastColumn"></td>';
	var cont = '<div class="articleContent orderDetails mainOrderDetails normalMode"><div class="articleContentInner"><div class="articleDetails">'
		+'<table cellspacing="0" class="ContentTable" width="100%"><tbody>';
	tot_pall_receive+='<td class="keyInfo" width="20%">Total Pallets:</td><td class="valueInfo" width="15%">'+Number((segmented) ? (dataObj.deliveryObj[0].total_pallets!=null && dataObj.deliveryObj[0].total_pallets!=undefined  && dataObj.deliveryObj[0].total_pallets.toString()!='' ? dataObj.deliveryObj[0].total_pallets : 'NA') : (dataObj.hdrObj.total_pallets!=null && dataObj.hdrObj.total_pallets!=undefined && dataObj.hdrObj.total_pallets.toString()!='' ? dataObj.hdrObj.total_pallets : 'NA'))+'</td>'
			+'<td class="keyInfo " width="15%">Total Articles:</td><td class="valueInfo '+(received ? 'valueInfo lastColumn ':'')+'" width="15%">'+(dataObj.tot_art_cnt!=null && dataObj.tot_art_cnt!=undefined && dataObj.tot_art_cnt.toString() !='' ? dataObj.tot_art_cnt : 'NA')+'</td>';
	tot_car_receive+='<td class="keyInfo ">	Total Dispatched Qty.:</td><td class="valueInfo">'+(dataObj.totDispQty!=null && dataObj.totDispQty!=undefined && dataObj.totDispQty.toString()!='' ? dataObj.totDispQty : 'NA')+'</td>'
		+'<td class="keyInfo">Total Cartons Ordered:</td><td class="valueInfo '+(received ? ' lastColumn ':'')+'" width="15%">'+((segmented) ? (dataObj.totOrderQty) : (dataObj.hdrObj.total_cartons!=null && dataObj.hdrObj.total_cartons!=undefined && dataObj.hdrObj.total_cartons.toString()!=''  ? dataObj.hdrObj.total_cartons : 'NA'))+'</td>';	
	tot_weig_receive+='<td class="keyInfo ">Total Dispatched Weight:</td><td class="valueInfo">'+(dataObj.totWeightDispatched!=null && dataObj.totWeightDispatched!=undefined && dataObj.totWeightDispatched.toString()!='' ? dataObj.totWeightDispatched:'NA')+'</td>'
		+'<td class="keyInfo sealClass" width="20%">Seal Numbers</td><td class="valueInfo sealId" width="80%">'+(delObj.seal_numbers||'NA')+'</td>'+'<td class="keyInfo noDivider"></td><td class="'+(received ? ' valueInfo lastColumn ':' noDivider ')+'"></td>';
	tot_pall_return+=(isSugo(dataObj.hdrObj.source)) ? ('<td class="keyInfo">Underlay / Overlay:</td><td class="valueInfo">'
		+((dataObj.over_under_lay_cnt||'' > 0) ? '<label class="linkBtn" id="overlay"><a class="newWindowAfter">'+dataObj.over_under_lay_cnt+' article'+(dataObj.over_under_lay_cnt >1 ?'s' :'')+'</a></label>' :'NA')
		+'</td>') : '<td class="keyInfo noDivider"></td><td class=" noDivider "></td>';
	if(received || dispatched){
	over_supply+='<tr class="lastRow"><td class="keyInfo">Under / Over Supply:</td><td class="valueInfo">'
		+ ((dataObj.over_under_supply_cnt||'' > 0) ? '<label class="linkBtn" id="overSupply"><a class="newWindowAfter">'+dataObj.over_under_supply_cnt+' article'+(dataObj.over_under_supply_cnt >1 ?'s' :'')+'</a></label>' :'NA')
		+'</td>'+empty_td+empty_td+'</tr>';
		if(received){
	receive_cont+='<div class="articleDetails"><table cellspacing="0" class="ContentTable" width="100%"><tbody><tr class="lastRow">'
		+'<td class="keyInfo" width="20%">Received Date:</td><td class="valueInfo" width="15%">'+$.tablebuild.dataparse.mobi_date((delObj.received_date||'NA'))+' '+formatTime(delObj.recv_time||'NA')+'</td>'
		+'<td class="keyInfo " width="15%">Received By:</td><td class="valueInfo " width="20%">'+(delObj.recv_user||'NA')+'</td>'
		+'<td class="keyInfo " width="15%">Receiving Method:</td><td class="valueInfo lastColumn" width="15%">'+(delObj.recv_method || '')+'</td>'
		+'</tr></tbody></table></div>';

	temperature_cont+='<div class="articleDetails"><table cellspacing="0" class="ContentTable" width="100%"><tbody><tr class="lastRow">'
		+'<td class="keyInfo" width="20%">Chilled Temperature:</td><td class="valueInfo" width="15%">'+(chilled_temp)+'</td>'
		+'<td class="keyInfo " width="15%">Frozen Temperature:</td><td class="valueInfo " width="20%">'+(frozen_temp)+'</td><td class="keyInfo noDivider" width="20%"></td><td class="valueInfo lastColumn" width="15%"></td>'
		+'</tr></tbody></table></div>';
	
	invoice_cont+='<div class="articleDetails"><table cellspacing="0" class="ContentTable" width="100%"><tbody><tr class="lastRow">'
		+'<td class="keyInfo" width="20%">Invoice / Docket Number:</td><td class="valueInfo" width="15%">'+(delObj.invoice_no||'NA')+'</td>'		
		+'<td class="keyInfo" width="15%">Seal Numbers</td><td class="valueInfo" width="55%">'+(delObj.seal_numbers||'NA')+'</td>'
		+'</tr></tbody></table></div>';
	}
	}
	
	if(received){
		tot_pall_receive =('<td class="keyInfo" width="20%">Total Pallets Received:</td><td class="valueInfo" width="15%">'+(dataObj.total_pallets_recvd.toString()== '' ? 'NA' : Number(dataObj.total_pallets_recvd).toFixed(0))+'</td>'+tot_pall_receive);	
		tot_car_receive =('<td class="keyInfo">Total Cartons Received:</td><td class="valueInfo">'+(dataObj.totReceQty.toString()== '' ? 'NA' : (dataObj.totReceQty))+'</td>'+ tot_car_receive);
		
                tot_weig_receive= ('<td class="keyInfo">Total Weight Received:</td><td class="valueInfo">'+(dataObj.totWeightReceived.toString() == '' ? 'NA' : (dataObj.totWeightReceived))+'</td>'+tot_weig_receive);
		tot_pall_return =('<td class="keyInfo">Total Pallets Returned:</td><td class="valueInfo">'+(dataObj.total_pallets_returned.toString()== '' ? 'NA' : Number(dataObj.total_pallets_returned).toFixed(0))+'</td>'+tot_pall_return+empty_td);
	}else{
		tot_pall_receive+=empty_td;
		tot_car_receive+=empty_td;
		tot_weig_receive+=empty_td;
		tot_pall_return+=empty_td;
	}
	
	tot_pall_receive ='<tr>'+tot_pall_receive+'</tr>';
	tot_car_receive ='<tr>'+tot_car_receive+'</tr>';
	tot_weig_receive='<tr>'+tot_weig_receive+'</tr>';
	//tot_pall_return= (received) ? '<tr>'+tot_pall_return+'</tr>' : '';
	//changed for defect 7491
	tot_pall_return= '<tr>'+tot_pall_return+'</tr>';
	
	cont += tot_pall_receive+tot_car_receive+tot_weig_receive+tot_pall_return;
	
	if(received || dispatched){
		cont+=over_supply;
	}
	cont+='</tbody></table>';
	cont+='</div>';
	seal_flag='';
	if(isReceived(status)){
		
		cont += receive_cont+temperature_cont+invoice_cont;
                seal_flag="Y";
	}
	//cont+=invoice_cont_seal;
	cont+='</div></div>';
	return cont;
};
function frameItemCont(dataObj,title){
	var $section_tabs = $('#sections-tab');
	var $itemHold ='';
	var $contWrap  = $('#order_detail');
	var confObj = {};
	$contWrap.data('contObj',dataObj);
	$section_tabs!=undefined ? $section_tabs.tabs() :'';
        //var received = (isReceived(status) || isReceived(status));
        if(seal_flag=="Y"){
	$('.articleDetails').find('.sealClass').addClass('hideBlock');
        $('.articleDetails').find('.sealId').addClass('hideBlock'); }
	for(var i=0; i<dataObj.received_art.length; i++){
		if(dataObj.received_art[i].greenlife_flag == 'Y'){
			 isCostPriceShow = true;
			break;
		}
	}
	if(dataObj.deliveryFlag || title == 'all'){
		$itemHold = $contWrap.find('#tabs-yet-to-receive');
		if($itemHold!=undefined && $itemHold.length > 0 && dataObj.yet_to_receive_cnt > 0){
			confObj = new tblConfObjNonSegItemInfo('yet_to_received_'+'item_table',dataObj.yet_to_receive_art,dataObj.hdrObj.order_status);
			confObj['hdrObj'] = dataObj.hdrObj;
			$itemHold.loadtbl(confObj);
			$itemHold.find('#yet_to_received_item_table_head').addClass('hideBlock');
			$itemHold.find('#action_btn_wrap_yet_to_received_item_table').removeClass('hideBlock');
		}
		$itemHold = $contWrap.find('#tabs-received');
		if($itemHold!=undefined && $itemHold.length > 0 && dataObj.received_cnt > 0){
		
			confObj = new tblConfObjNonSegItemInfo('received_'+'item_table',dataObj.received_art,dataObj.hdrObj.order_status);
			confObj['hdrObj'] = dataObj.hdrObj;
			$itemHold.loadtbl(confObj);
			$itemHold.find('#received_item_table_head').addClass('hideBlock');
			$itemHold.find('#action_btn_wrap_received_item_table').removeClass('hideBlock');
		}
		($contWrap.find('#over-all-tabs')||'')!= '' ? $contWrap.find('#over-all-tabs').tabs({activate:function(event,ui){$(ui.newPanel.context).find('#filltered-tabs').addClass('hideBlock');}}) :'';
	}else{
		$itemHold = $contWrap.find('#non-seg-iteminfo');
		if($itemHold!=undefined && dataObj.itemObj!=undefined && dataObj.itemObj.length>0){
			confObj = new tblConfObjNonSegItemInfo(dataObj.hdrObj.order_status+'_'+'item_table',dataObj.itemObj,dataObj.hdrObj.order_status);
			confObj['hdrObj'] = dataObj.hdrObj;
			$itemHold.loadtbl(confObj);
			$itemHold.find('.tableFooter').addClass('hideBlock');
			$itemHold.find('#action_btn_wrap_'+dataObj.hdrObj.order_status+'_'+'item_table').removeClass('hideBlock');
		}
	}
	
}
var bindOrderDetailCont = function($hold,dataObj){
	var $lcont = $hold.find('#overlay');
	var $scont = $hold.find('#overSupply');
	var $dcont = $hold.find('#deptMore');
 	var $STCancel = $hold.find('#commonCancelOrder'); 
	var $grpCont = $hold.find('.group_cont_table');
	var $grGoBtn = $hold.find('#showFilterResult');
	var $updateQtyCom = $hold.find('#commonUpdateQty');
	var $updateQtySeg = $hold.find('#update-rec-qty-btn');
	var $STPrint = $hold.find('#commonPrintOrder'); 
	var $POCancel = $hold.find('#cancelOrder');
	var $ULDPrint = $hold.find('.printULD');
       
if(isCostPriceShow ){
		$hold.find('.costClass').removeClass('hideBlock');
}else{
    $hold.find('.costClass').addClass('hideBlock');
}
        
        
	if(dataObj .hdrDtlObj[0].era_audit_flag =='Y')
	{
		$hold.find('#auditCheck').removeClass('hideBlock');
	}
	else
		{
		$hold.find('#auditCheck').addClass('hideBlock');
		}
	
	if(dataObj.tempFlag =='Y')
	{
		$hold.find('#tempCheckFlag').removeClass('hideBlock');
	}
	else
		{
		$hold.find('#tempCheckFlag').addClass('hideBlock');
		}
	
	if($updateQtyCom != undefined && $updateQtyCom.length>0){
		$updateQtyCom.unbind('click').bind('click',{hold:$hold,dataObj:dataObj},updateReceiveQty);
	}
	if($updateQtySeg != undefined && $updateQtySeg .length>0){
		$updateQtySeg.unbind('click').bind('click',{hold:$hold,dataObj:dataObj},updateReceiveQty);
	}
	
	//MUTHU CODE
	var $POVendorClaim = $hold.find('#commonVendorClaim');
	var $postSOH = $hold.find('#commonPostSohQty');
	var $commonReceive= $hold.find('#commonReceiveOrder');
	if($lcont!=undefined)
		$hold.find('#overlay').unbind('click').bind('click',showOver_under_lay_cont).data('lobj',dataObj.lobj).data('dataObj',dataObj);
	
	if($scont!=undefined)
		$hold.find('#overSupply').unbind('click').bind('click',showOver_under_supply_cont).data('sobj',dataObj.sobj).data('dataObj',dataObj);
	
	if($STCancel!= undefined && isIbtOut(dataObj.hdrObj))
		$STCancel.unbind('click').bind('click',{orderNo: dataObj.hdrObj.order_no,supplier: dataObj.hdrDtlObj[0].receiving_site},triggerCancelSTOut);
	
	//deefct 2614 added tab code logic
	if($POCancel!= undefined && (dataObj.hdrObj.tab_code == "OVERDUE") && (isAuth(dataObj.hdrObj.order_status) || (isDispatch(dataObj.hdrObj.order_status))) && isPO(dataObj.hdrObj.order_type))
		{
		$hold.find('#cancelOrder').unbind('click').bind('click',{dataObj:dataObj},triggerPOCancel);
		}
	
	if($dcont!= undefined)
		$dcont.unbind('click').bind('click',function(){ $(this).addClass('hideBlock'); $(this).parent().find('.remain-dept').removeClass('hideBlock');});
	
	if($grpCont!=undefined)
		$grpCont.hide();
		
	if($grGoBtn!=undefined)
		$grGoBtn.unbind('click').bind('click',{hdrObj: dataObj.hdrObj,elem:$hold.find('#over-all-tabs')},getGRItemInfo);
	
	//MUTHU CODE
	if($POVendorClaim!= undefined && isPO(dataObj.hdrObj.order_type) && isReceived(dataObj.hdrObj.order_status))
		$POVendorClaim.unbind('click').bind('click',{dataObj:dataObj},triggerVendorClaimAuth);
	
	if($postSOH!= undefined && (isPost(dataObj.hdrObj.post_flag) || isPost(dataObj.hdrDtlObj[0].post_flag)))
		$postSOH.unbind('click').bind('click',{dataObj:dataObj},triggerSOHPost);
	
	if($commonReceive != undefined && isReadyToReceive(dataObj.hdrObj.order_status) && !isIbtOut(dataObj.hdrObj))
		$commonReceive.unbind('click').bind('click',{dataObj:dataObj},triggerReceiveOrder);
	
	if($STPrint!= undefined && isIbtOut(dataObj.hdrObj))
		$STPrint.unbind('click').bind('click',{dataObj:dataObj},triggerPrintSTOut);
	
	if($ULDPrint.exists())
		$ULDPrint.unbind('click').bind('click',{dataObj:dataObj, orderNo: $ULDPrint.attr('id').split('-')[0]},triggerULDPrint);
	
	$('.transferIbt').unbind('click');
	$('.transferIbt').click({dataObj:dataObj},function(e){
	var area = $('#dialog-editSitePop');
		$('#transferPopUpForm')[0].reset();
		area.find('#siteResults').addClass('hideBlock');		
		var dataObj = e.data.dataObj;
		$('#dialog-verify #popupSearch .filterWrapper').addClass('hideBlock');
		
		area.dialog('open');
		area.find('#pos1').focus();
		createWareHouseList({
			siteNo : $('#posSite').val()
		});
		var elem = $(this);
		bindSitePopupEvents(area, $(this).attr('id').split('-')[1],$(elem),dataObj);
	});
	
	bindReceiveSegmentEvents(dataObj);
};
function bindReceiveSegmentEvents(dataObj){
	$('.receiveSegment').unbind('click');
	$('.receiveSegment').click({dataObj:dataObj},function(e){
		var dataObj= e.data.dataObj;
		var segmentNo = $(this).attr('id').split('-')[0];
		var asnNo = $(this).attr('id').split('-')[1];
		callServiceForWizard(segmentNo, "D", asnNo,dataObj);
	});
}

var triggerPrintSTOut = function(e){
	var dataObj = e.data.dataObj;
	printIBT(dataObj);
	//$.fn.warnPopup('warn',printMsg,'Order Details',triggerPrintYes,triggerDeleteNo,'',dataObj,'shiftKeys'); // defect 2505
};
var triggerPrintYes = function(e)
{
	var dataObj = e.data.cache;
	printIBT(dataObj);
	$('#no').trigger('click');
};

var triggerULDPrint = function(e){
	var dataObj = e.data.dataObj;
	var orderNo = e.data.orderNo;
	printULDInfo(dataObj, orderNo);
};

var doc = '';
function printIBT(dataObj)
{
	var articleList = dataObj.itemObj;
	//sub_category_no
	
	 var articleListBySubCategory = $groupBy(articleList, function(obj) {
	        return obj.sub_category_no;
	    });
	
	var content = '<h1> Stock Transfer Order '
		+ dataObj.hdrObj.order_no
		+' </h1>'
		+'<h4> Created on: '
		+ dataObj.hdrDtlObj[0].creation_date
		+' | Status: '
		+ sentenceCase(dataObj.hdrObj.order_status)
		+'</h4>'
		+'<table class="firstTable" width="100%">'
		+'<tr><td class="rightBorderCell">'
		+'<strong>From:</strong>'
		+'</td><td>'
		+'<strong>To:</strong>'
		+'</td></tr>'
		+'<tr><td class="rightBorderCell">'
		+getSupplierNo(dataObj.hdrObj.supplier_name,dataObj.hdrObj.supplier_no)
		+'</td><td>'
		+getSupplierNo(dataObj.hdrDtlObj[0].receiving_site_name,dataObj.hdrDtlObj[0].receiving_site)
		+'</td></tr>'
		+'<tr><td class="rightBorderCell">'
//		+
		+'</td><td>'
//		+
		+'</td></tr>'
		+'<tr><td class="rightBorderCell">'
		+'<strong>Temperature</strong>'
		+'</td><td>'
		+'<strong>Temperature</strong>'
		+'</td></tr>'
		+'<tr><td class="rightBorderCell">'
		+'Chilled '+(dataObj.hdrDtlObj[0].ibt_chilled_temperature||'')+', '+'Frozen '+(dataObj.hdrDtlObj[0].ibt_frozen_temperature||'')
		+'</td><td>'
		+''
		+'</td></tr>'
		+'<tr><td class="rightBorderCell">'
		+($.tablebuild.dataparse.mobi_date(dataObj.hdrDtlObj[0].ibt_pickup_date||''))+' '+(dataObj.hdrDtlObj[0].ibt_pickup_time||'')
		+'</td><td>'
//		+
		+'</td></tr></table>';
	
	
	for (key in articleListBySubCategory) {
		
		 if (key != '' && key != null && key != undefined) {
		        var list = articleListBySubCategory[key];
		content+='<h4> Sub-Category: '+list[0].sub_category_name+' </h4>'
			+'<table border="1" class="secondTable" width="100%"><thead><tr><th class="leftValue"> Article </th><th class="leftValue"> Description </th>'
			+'<th class="centerValue"> Qty </th><th class="centerValue"> Unit </th><th class="centerValue"> OM </th><th class="centerValue"> Total Weight </th></tr></thead><tbody>';
		for(var i=0;i<list.length;i++)
			{
			content+='<tr><td class="leftValue">'
			+list[i].article
			+' </td><td class="leftValue">'
			+list[i].article_desc
			+' </td><td class="centerValue">'
			+list[i].order_qty
			+' </td><td class="centerValue">'
			+list[i].order_uom
			+' </td><td class="centerValue">'
			+list[i].om+' '+list[i].base_uom
			+' </td><td class="centerValue">'
			+list[i].newOrderTot+' '+list[i].base_uom
			+'  </td></tr>';
		 }
			content+='</tbody></table>';
		 }
	}
		
	dataObj.hdrDtlObj[0].ibt_comments = dataObj.hdrDtlObj[0].ibt_comments != undefined ? dataObj.hdrDtlObj[0].ibt_comments : "";
	dataObj.hdrDtlObj[0].ibt_rego_number = dataObj.hdrDtlObj[0].ibt_rego_number != undefined ? dataObj.hdrDtlObj[0].ibt_rego_number : "";
	dataObj.hdrDtlObj[0].ibt_courier = dataObj.hdrDtlObj[0].ibt_courier != undefined ? dataObj.hdrDtlObj[0].ibt_courier : "";
	dataObj.hdrDtlObj[0].ibt_auth_number = dataObj.hdrDtlObj[0].ibt_auth_number != undefined ? dataObj.hdrDtlObj[0].ibt_auth_number : "";
		content+='<br><br>'
		+'<table border=1; class="thirdTable" width=100%><tr>'
		+'<td> CONSIGNMENT NOTE <br><br>'+dataObj.hdrDtlObj[0].ibt_comments+'<br><br></td>'
		+'<td> COURIERS NAME OR VEHICLE NO <br><br>'+dataObj.hdrDtlObj[0].ibt_courier+(dataObj.hdrDtlObj[0].ibt_courier!='' && dataObj.hdrDtlObj[0].ibt_rego_number!='' ? ' | ':'')+dataObj.hdrDtlObj[0].ibt_rego_number+'<br><br></td>'
		+'<td> WAREHOUSE AUTHORITY NUMBER <br><br>'+dataObj.hdrDtlObj[0].ibt_auth_number+'<br><br></td>'
		+'</tr><tr>'
		+'<td> NUMBER OF PACKAGES <br><br><br><br></td>'
		+'<td> SIGNATURE OF PERSON TAKING GOODS <br><br><br><br></td>'
		+'<td> STORE MANAGER SIGNATURE <br><br><br><br></td></tr><tr><td colspan=3> '
		+'<label><strong>Note</strong></label><ol><li>Sending site forwards this copy with the goods.</li>'
		+'<li>Receiving site must receive this stock transfer using ï¿½ORDER NOï¿½ as above</li></ol> </td></tr></table>';
	$("#printbodyForIBTOrder").html('');
	$("#printbodyForIBTOrder").append(content).append(
	'<link rel="stylesheet" href="../../styles/printStyleForIBTOrderPrint.css" />');
	var a = window.open();
	$("#printDataForIBTOrder").show();
	a.document
			.write('<script src="../../scripts/jquery-1.9.1.js"></script>');
	a.document
			.write(document
					.getElementById('printDataForIBTOrder').innerHTML);

	$("#printDataForIBTOrder").hide();
	a.focus();
	// call print
	$(a)
			.ready(
					function() {
						// a.close();
						setTimeout(
								function() {
									$(
											document)
											.unbind(
													'click');
									doc = a;
									$(
											document)
											.click(
													function() {
														doc
																.close();
														doc = '';
														$(
																document)
																.unbind(
																		'click');
													});
									a
											.print();
								}, 1000);
						return true;
					});
	
}
function printULDInfo(dataObj, orderNo){
	var param = {
		 "iv_user_id": $('#loginUserId').val(),
		   "iv_pwd": "",
		   "iv_session_id": "111",
		   "iv_site_no": $('#posSite').val(),
		   "iv_sales_org": $('#salesOrg').val(),
		   //"iv_order_no" : "80456768",
		   "iv_order_no":orderNo,
		   "iv_rec_type":isST(dataObj.order_type) ? "I" : "O"
	};
	
	console.log(getULDReceiveInfoUrl + ' ' + JSON.stringify(param));
	$.ajax({
	    type: "POST",
	    url: getULDReceiveInfoUrl,
	    data: JSON.stringify(param),
	    beforeSend: function() {
	    	  startLoading();
	      }
	  }).done(function(response) {
		  console.log(JSON.stringify(response));	
		  if(response != undefined  && response.length > 0 && response[0].typ != undefined){
		  		if(response[0].typ == 'S'){
			  		callMasterULDService(dataObj, response);
		  		}else if(response[0].typ == 'E' && response[0].msg != undefined && response[0].msg !=''){
		  			$.fn.showCustomMsg([response[0].msg],error,'ULD Sweep');
		  		}else{
		  			$.fn.showCustomMsg(['Sorry, Some technical issue occured.'],error,'ULD Sweep'); 
		  		}
		  }	else {
			  $.fn.showCustomMsg(['Sorry, Some technical issue occured.'],error,'ULD Sweep'); 
		  }
	  }).fail(function() {	
		  $.fn.showCustomMsg(['Sorry, Some technical issue occured.'],error,'ULD Sweep');
	  }).always(function() {
		  stopLoading();
	  });
}
var triggerVendorClaimAuth = function(e){
	var dataObj = e.data.dataObj;
	$("#vendorAuthNoNgbo").val((dataObj.hdrDtlObj[0].ven_claim_auth_no||''));
	$("#dialog-modal-autho-ngbo").dialog("open");
	$('#saveVendorAuthNoNgbo').data('obj',dataObj);
};

var getGRItemInfo = function(e){
	 var $elem = e.data.elem;
	 var hdrObj = e.data.hdrObj;
	 var $select = $elem.find('#grDrpDwn');
	 var $itemHold = '';
	 var grNo = $select.val();
	 var param = {};
	 if(grNo!='0'){
		$itemHold = $elem.find('#filltered-tabs');
		param = new OrderItemParam(hdrObj.order_no,'',grNo,'Y');
		grItemInfoService(param,$elem,$itemHold);
	 }else{
		$.fn.showCustomMsg([grSelectMsg],error,'Order Details');
	 }
};
function grItemInfoService(param,$elem,$itemHold){
	console.log('URL ='+getOrderGrItemInfoURL+ ' param '+JSON.stringify(param));
	$.ajax({
	    type: "POST",
	    url: getOrderGrItemInfoURL,
	    data: JSON.stringify(param),
	    beforeSend: function(){
	    	startLoading();
	    }
	  }).done(function(data) {
		  if(checkResult(data,'article')){
			  frameGrItemInfo(data,$elem,$itemHold);
		  }
		 stopLoading();
	  }).fail(function() {
		  $.fn.showCustomMsg([mobiSerErrCode],error,'Order Details');
		  stopLoading();
	  }).always(function() {

	  });
}

var frameGrItemInfo = function(data,$elem,$itemHold){
	var confObj = new tblConfObjGrInfo('gr_item_',data);
	$itemHold.loadtbl(confObj);$itemHold.removeClass('hideBlock');
	$elem.tabs({collapsible: true, active: false, activate:function(event,ui){$(ui.newPanel.context).find('#filltered-tabs').addClass('hideBlock');}});
};

var getSupplierNo = function(name, no){
	return (name ||'')+' '+(((no ||'')!='') ? ('('+no+')'):'');
};
var itemInfoSegOrder = function(title,dataObj,deliveryNo){
	
	if(title == 'all'){
		return overAllInfoItemTab(dataObj);
	}else if(title == 'seg'){
		return '<div class="ContentTableWrapper itemContentTableWrap normalMode" id="seg-iteminfo-'+deliveryNo+'"></div>';
	}else{
		return '<div class="ContentTableWrapper itemContentTableWrap normalMode" id="non-seg-iteminfo"></div>';
	}
};

var overAllInfoItemTab= function(dataObj){

	var itemTab = '<div class="ContentTableWrapper listOfArticles itemContentTableWrap normalMode">';
	itemTab += (dataObj.tot_art_cnt||'')!='' ? '<div class="tableInfo"><div class="tableTitle"><h4 class="sectionTitle">List of Articles ('+dataObj.tot_art_cnt+')</h4></div></div>' :'';
	itemTab+='<div id="over-all-tabs" class="filterTabs"><ul class="ui-tabs-nav">';
	var itemCont = '';
	if(dataObj.yet_to_receive_cnt >0) {
		itemTab+='<li><a href="#tabs-yet-to-receive">Yet to Receive ('+(dataObj.yet_to_receive_cnt)+')</a></li>';
		itemCont +='<div id="tabs-yet-to-receive">'
		//+segOrderItemInfo(dataObj.hdrObj.order_status,dataObj.yet_to_receive_art)
		+'</div>';
	}
	if(dataObj.received_cnt >0){
		itemTab+='<li><a href="#tabs-received">Received ('+(dataObj.received_cnt)+')</a></li>';
		itemCont +='<div id="tabs-received">'
		//+segOrderItemInfo(dataObj.hdrObj.order_status,dataObj.received_art)
		+'</div>';
	}
	
	if(dataObj.grFlag == true){
		itemTab+=(frameGRDrop(dataObj.grObj));
		itemCont+= '<div id="filltered-tabs" class="hideBlock"></div>';
	}
	itemTab+='</ul>'+itemCont+'</div></div>';
	// RECEIVE ORDER DIV MUTHU
//	itemTab+='<div id="receive_order" class="contentWrapper hideBlock" ></div>';
	return itemTab;
};

var frameGRDrop =function(grData){

	var cont= '<li class="filterMenu"><div class="filterMenuOptions"><label class="filterTitle">Received / Amended in GR:</label>'
		+'<select class="selectOptions" id="grDrpDwn"><option value="0">Select GR #</option>';
		for(var i=0;i<grData.length;i++){
			cont+='<option value="'+(grData[i].gr_no||'')+'">'+(grData[i].gr_no||'')+' ('+(grData[i].tot_car_recvd||'')+')</option>';
		}
		cont+='</select><label class="actionBtn" id="showFilterResult">Go</label></div></li>';
	return cont;
};
var showOver_under_lay_cont = function(e){
	var data = $(this).data('lobj');
	var dataObj = $(this).data('dataObj');
	var dialog= createOverUnderLayDialog();
	var obj = new tblOverUnderLay('over_under_lay',data,dataObj);
	dialog.find('#pop-up-cont').loadtbl(obj);
	dialog.find('#pop-up-cont').find('.tableFooter').addClass('hideBlock');
	dialog.dialog('open');
};

var showOver_under_supply_cont = function(e){
	var data = $(this).data('sobj');
	var dataObj = $(this).data('dataObj');
	var dialog= createOverUnderSupplyDialog();
	var obj = new tblOverUnderSupply('over_under_supply',data,dataObj);
	dialog.find('#pop-up-cont').loadtbl(obj);
	dialog.find('#pop-up-cont').find('.tableFooter').addClass('hideBlock');
	dialog.dialog('open');
};

var createOverUnderSupplyDialog = function(){
	var dialog = $('#dialog-over-under-supply');
	if((dialog||'') == '' || dialog.length == 0){
		$('body').append(over_under_supp_dialog);
		dialog = $('#dialog-over-under-supply');
		dialog.dialog({ autoOpen : false, modal : true, resizable : false, minHeight : 200, width : 900 }).removeClass('visible-hide').parent().addClass("popupWrapper");
	}
	return dialog;
};

function tblOverUnderSupply(title,data,dataObj){
	this.option = 'build';this.key = ['article','article_desc','showDiffTotal','over_or_under_qty','reason'];
	this.table_name = title;this.table_title = 'Total '+((dataObj.over_supply_cnt > 0) ? '<strong>'+dataObj.over_supply_cnt+' over supply</strong>' : '')+(((dataObj.over_supply_cnt > 0) && (dataObj.under_supply_cnt > 0)) ? ' and ' :'')+( (dataObj.under_supply_cnt > 0)  ? '<strong>'+dataObj.under_supply_cnt+' under supply</strong>' : '')+' article'+(((dataObj.over_supply_cnt > 1) || (dataObj.under_supply_cnt > 1)) ? 's': '')+'';
	this.table_class = ' ContentTable '; this.header_tr_class = '';
	this.header_name = {article:'Article',article_desc:'Description', reason :'Reason'};
	this.header_data_type = {article:'',article_desc:'',over_or_under_qty:'',reason:''};
	this.header_row_type = {article:'main',article_desc:'main',showDiffTotal:'sub',over_or_under_qty:'main',reason : 'main'};
	if(dataObj.over_under_supply_reas  == 'D')
		this.header_sub_rows = {showDiffTotal:{subKeys: ['order_tot','disp_tot']}};
	else
	this.header_sub_rows = {showDiffTotal:{subKeys: ['order_tot','disp_tot','rece_tot']}};
	this.header_class = {article:'',article_desc:'',showDiffTotal:' centerValue  ',order_tot:' centerValue  ',disp_tot:' centerValue  ',rece_tot:' centerValue  ',over_or_under_qty:' centerValue  ',reason : ''};
	this.header_width = {article:'',article_desc:'',showDiffTotal:'',order_tot:'',disp_tot:'',rece_tot:'',over_or_under_qty:'40px',reason : ''};
	this.content_class = {article:'',article_desc:'',showDiffTotal:' centerValue  ',order_tot:' centerValue  ',disp_tot:' centerValue  ',rece_tot:' centerValue  ',over_or_under_qty:' centerValue  ',reason : ''};
	this.content_format = {article:'removeNull',article_desc:'removeNull'};
	this.content_width =  {article:'',article_desc:'',showDiffTotal:'',order_tot:'',disp_tot:'',rece_tot:'',over_or_under_qty:'40px',reason : ''};
	this.tr_id= ['article','base_uom','article_line'];
	this.header_td_label = {showDiffTotal:'Total Units',order_tot:'Ordered',disp_tot:'Dispatched',rece_tot:'Received',over_or_under_qty:'Difference',reason :'Reason'};
	this.content_label = {};
	this.cont_data_function = {order_tot:order_tot,disp_tot: disp_tot,rece_tot:rece_tot,over_or_under_qty:over_or_under_qty,reason :reason};
	this.cont_sort_function = {order_tot:get_order_tot,disp_tot: get_disp_tot,rece_tot:get_rece_tot,over_or_under_qty:get_over_or_under_qty,reason :get_reason};
	this.sort_done = {sort_done: ''};this.page_done = {page_done: ''};
	this.content_bind_event = {click: ''};this.content_tr_addon = {click: ''};this.content_title = {},this.header_title = {};
	this.content_td_addon = {}; this.header_td_addon = {};
	this.comp_key_parser = {}; this.content =  data;this.pagination = false;this.groupby= false;this.recordPerPage= 10;this.groupbyColumn =[];this.filter= false;
	this.filterbyColumn ={};this.curr_page= 1;this.sort=false;
}
var order_tot = function(obj){
	var base_uom = (obj.base_uom||'');
	var qty = (obj.newOrderTot!=null && obj.newOrderTot!=undefined) ? obj.newOrderTot : '';// order_qty
	return qty.toString()!='' ? (qty+' '+base_uom) :'';
};
var disp_tot = function(obj){
    var base_uom = (obj.base_uom||''); //dispatched_qty_uom
	var qty = (obj.newDispTot!=null && obj.newDispTot!=undefined) ? obj.newDispTot : '';// dispatched_qty
	return qty.toString()!='' ? (qty+' '+base_uom) :'';
};
var rece_tot = function(obj){
	var base_uom = (obj.base_uom||''); //received_qty_uom order_uom
	var qty = (obj.newReceTot!=null && obj.newReceTot!=undefined) ? obj.newReceTot : ''; //received_qty
	return qty.toString()!='' ? (qty+' '+base_uom) :'';
};
var over_or_under_qty = function(obj){
	return '<label class="'+(obj.over_or_under_class_lay||'')+'">'+(obj.over_or_under_supply_qty||'')+'</label>';
};
var reason = function(obj){
	return ((obj.dispatch_exception_reason!=null && obj.dispatch_exception_reason!=undefined)?obj.dispatch_exception_reason:'');
};

var get_order_tot = function(){
	return 'newOrderTot';
};
var get_disp_tot = function(){
	return 'newDispTot';
};
var get_rece_tot = function(){
	return 'newReceTot';
};
var get_over_or_under_qty = function(){
	return 'over_or_under_supply_qty';
};
var get_reason = function(){
	return 'sup_reason';
};
$.fn.exists = function () {
    return this.length !== 0;
};

function navigate(screen){
	var $content = $('.orders');
	var $brudCrum= $('#brudCrumCont .navigate');
	$content.addClass('hideBlock');$brudCrum.removeClass('hideBlock').addClass('hideBlock');
	 if(screen == detail){
		$('#order_detail').removeClass('hideBlock');
		$('#receive_order').addClass('hideBlock');
		$('#update_order').addClass('hideBlock');
		$('#order_detail .listOfArticles').removeClass('hideBlock');
		$('#order_detail .mainOrderDetails').removeClass('hideBlock');
		$('.commonReceiveOrder').removeClass('hideBlock');
		$('.orderStatus').removeClass('hideBlock');
		$('.receiveOrderStatus:visible').addClass('hideBlock');
		$('#brud_order_lookup').removeClass('hideBlock').removeClass('currentPage').addClass('cursor-pointer');
		$('#brud_update_order').addClass('hideBlock').removeClass('cursor-pointer').removeClass('currentPage');
		$('#brud_order_detail').removeClass('hideBlock').removeClass('cursor-pointer').addClass('currentPage');
	}else if(screen == update){
			$('#update_order').removeClass('hideBlock');
			$('#order_detail').addClass('hideBlock');
			$('#brud_order_lookup,#brud_order_detail').removeClass('hideBlock').removeClass('currentPage').addClass('cursor-pointer');
			$('#brud_update_order').removeClass('hideBlock').removeClass('cursor-pointer').addClass('currentPage');
		}else if(screen == orderEnq)// for Defect_14718
			{
			$('.dtl').addClass('hideBlock');
			$('.enq').removeClass('hideBlock');
			$('.vari').addClass('hideBlock');
			$('.contentWrapper.orders')
					.removeClass('hideBlock');
			$(
					'.contentWrapper.tabbedOrderDetail')
					.addClass('hideBlock');
			$('.contentWrapper.varianceRpt')
					.addClass('hideBlock');
			$('#update_order').addClass('hideBlock');
			$('#order_detail').addClass('hideBlock');
			$('#brud_order_lookup').removeClass('hideBlock').addClass('currentPage').removeClass('cursor-pointer');
			$('#brud_order_detail').addClass('hideBlock').removeClass('currentPage');
			$('#brud_update_order').addClass('hideBlock').removeClass('cursor-pointer').removeClass('currentPage');
			}
}

function tblConfObjNonSegItemInfo(title,data,status){

	if(isCostPriceShow){
		this.option = 'build';this.key = ['article','vendor_ref_no','cost_price','article_desc','showOmItem','showOrdQty'];
	}else{
		this.option = 'build';this.key = ['article','vendor_ref_no','article_desc','showOmItem','showOrdQty'];
	}
	
	this.table_name = title;this.table_title = 'List of Articles ('+data.length+')';
	this.table_class = ' ContentTable ';this.header_tr_class = 'collapsed';this.content_tr_class = ' mainTr ';
	this.header_name = {article:'Article',vendor_ref_no:'Vendor<br>Ref #',cost_price:'Cost<br>Price',article_desc:'Description'};
	this.header_data_type = {article:'number',vendor_ref_no:'char',cost_price:'number',article_desc:'char',showOmItem:'char',showOrderQty:'number',showOrderTotQty : 'number',showDispQty:'number',showDispTotQty:'number',showReceiveQty:'number',showReceTotQty:'number',newReceiveOm: 'number', newExpDate:'date'};
	this.header_row_type = {article:'main',vendor_ref_no:'main',cost_price:'main',article_desc:'main',showOmItem:'main',showOrdQty:'sub',showDisQty:'sub',showReceQty:'sub',newReceiveOm: 'main', newExpDate:'main'};
	this.header_sub_rows = {showOrdQty:{subKeys: ['showOrderQty','showOrderTotQty']},showDisQty:{colspan : 2, subKeys: ['showDispQty','showDispTotQty']},showReceQty:{colspan : 2, subKeys: ['showReceiveQty','showReceTotQty']}};
	this.header_class = {article:'',vendor_ref_no:'',cost_price:'costClass',article_desc:'',showOmItem:' centerValue columnDivider  ',showOrdQty:' centerValue columnDivider noSort  ',showDisQty:' centerValue columnDivider noSort  ',showReceQty:'  centerValue columnDivider noSort  ',showOrderQty:' centerValue  ',showOrderTotQty : '  centerValue   ',showDispQty:' centerValue  ',showDispTotQty:' centerValue  ',showReceiveQty:' centerValue  ',showReceTotQty:' centerValue  ',newReceiveOm: ' editMode centerValue hideBlock ', newExpDate:' editMode centerValue hideBlock '};
	this.header_width = {article:'',vendor_ref_no:'',cost_price:'',article_desc:'',showOmItem:'',showOrdQty:'',showDisQty:'',showReceQty:'',showOmItem:'',showOrderQty:'',showOrderTotQty : '',showDispQty:'',showDispTotQty:'',showReceiveQty:'',showReceTotQty:'',newReceiveOm: '70px', newExpDate:'70px'};
	this.content_class = {article:'',vendor_ref_no:'',cost_price:'costClass',article_desc:'',showOmItem:' centerValue columnDivider  ',showOrdQty:' centerValue columnDivider noSort  ',showDisQty:' centerValue columnDivider noSort  ',showReceQty:'  centerValue columnDivider noSort  ',showOrderQty:' centerValue  ',showOrderTotQty : '  centerValue   ',showDispQty:' centerValue  ',showDispTotQty:' centerValue  ',showReceiveQty:' centerValue  ',showReceTotQty:' centerValue  ',newReceiveOm: ' editMode centerValue hideBlock ', newExpDate:' editMode centerValue hideBlock '};
	this.content_format = {article:'removeNull',vendor_ref_no:'removeNull',cost_price:'removeNull',article_desc:'removeNull'};
	this.content_width =  {article:'',vendor_ref_no:'',cost_price:'',article_desc:'',showOmItem:'',showOrdQty:'',showDisQty:'',showReceQty:'',showOmItem:'',showOrderQty:'',showOrderTotQty : '',showDispQty:'',showDispTotQty:'',showReceiveQty:'',showReceTotQty:'',newReceiveOm: '', newExpDate:''};
	this.tr_id= ['article','base_uom'];
	this.header_td_label = {showOmItem:'OM',showOrdQty:'Total Units Ordered',showOrdQty:'Ordered',showDisQty:'Dispatched',showReceQty:'Received',showOrderQty:'Qty.',showOrderTotQty:'Total Units',showDispQty:'Qty.',showDispTotQty:'Total Units',showReceiveQty:'Qty.',showReceTotQty:'Total Units',newReceiveOm: 'New OM', newExpDate:'Expiry Date'};
	this.content_label = {};
	this.cont_data_function = {newOm:showOmItem,newOrderQty:showOrderQty,newOrderTot:showOrderTotQty,newDispQty:showDispQty,newDispTot:showDispTotQty,newReceQty:showReceiveQty,newReceTot:showReceTotQty,showOmItem:showOmItem,showOrderQty:showOrderQty,showOrderTotQty:showOrderTotQty,showDispQty:showDispQty,showDispTotQty:showDispTotQty,showReceiveQty:showReceiveQty,showReceTotQty:showReceTotQty,newReceiveOm: newReceiveOm, newExpDate:newExpDate};
	this.cont_sort_function = {showOmItem:getOmItem,showOrderQty:getOrderQtyData,showOrderTotQty:getOrderQtyTotData,showDispQty:getDispQtyData,showDispTotQty:getDispQtyTotData,showReceiveQty:getReceQtyData,showReceTotQty:getReceQtyTotData,newReceiveOm: getNewReceiveOm, newExpDate: getNewExpDate};
       
	if(isDispatch(status)){
		this.key.push('showDisQty');
	}
	if(isReceived(status) || isPartiallyReceived(status) ){
		this.key.push('showDisQty');
		this.key.push('showReceQty');
		this.key.push('newReceiveOm');
		this.key.push('newExpDate');
		this.add_option = true; 
 /*if(isPartiallyReceived(status)){
	$('.articleDetails').find('.sealClass').addClass('hideBlock');
        $('.articleDetails').find('.sealId').addClass('hideBlock'); }*/
	}
	if(salesOrg==1060 && era_prof=="Y" && (status=="DISPATCHED" || status=="RECEIVED") )
	{
	this.default_groupbyColumn =['sscc_carton_num'];
	}else
	{
	this.default_groupbyColumn =['department_no'];
	}	
	this.groupbyColumn ={'department_no': 'Department','article':'Article','sscc_carton_num':'SSCC No'};
	this.cont_group_data_function = {showQty:showQty};
	this.group_cont_function = {department_no:getOpenItemGrpCont,article:'',sscc_carton_num:getSSCCItemGrpCont};
	this.sort_done = {sort_done: orderDetailData};this.page_done = {page_done: orderDetailData};
	this.content_bind_event = {click: ''};this.content_tr_addon = {click: ''};this.content_title = {},this.header_title = {};
	this.content_td_addon = {showReceiveQty:{'.receive_qty':{event:{keypress : onlyNumber,change : changeReceiveQty,click : function(){}},display: function(){}},'.receive_weight':{event:{keypress : onlyNumber,change : changeReceiveWgt,click : function(){}},display: function(){}}},newReceiveOm:{'.textbox':{event:{keypress : onlyNumber,change : changeReceOm,click : function(){}},display:function(){}}},newExpDate:{'.inputDate':{event:{keypress : function(){},change : changeExpDate,click : function(){}},display: function(){}},'.moreExp':{event:{keypress : function(){},change : function(){},click : showRemainExp},display: function(){}}}}; this.header_td_addon = {};
	this.comp_key_parser = {}; this.content =  data;this.pagination = true;this.groupby= true;this.recordPerPage= 10;this.groupbyColumn =[];this.filter= true;
	this.filterbyColumn ={article:'article',vendor_ref_no:'vendor_ref_no',cost_price:'cost_price',article_desc:'article_desc',showOmItem:'showOmItem',showOrderQty:'showOrderQty',showOrderTotQty : 'showOrderTotQty',showDispQty:'showDispQty',showDispTotQty:'showDispTotQty',showReceiveQty:'showReceiveQty',showReceTotQty:'showReceTotQty',newReceiveOm: 'newReceiveOm', newExpDate:'newExpDate'};this.curr_page= 1;this.sort=true;
	this.data_tr_class = {func_class:getArticleTrclass};
	this.data_td_class = {article:getArticleTdclass/*,cost_price:getCostPrice*/};
}
/*var getCostPrice = function(obj,$td){
	if(isCostPriceShow){
	   
		}else
		{	
	    $td.addClass('hideBlock');	
			}
	};*/
	var getSSCCItemGrpCont = function(obj,confObj){
		//var obj = value[0];
		var cont = '<tr id="none"></tr>';
		if(obj!=null && obj!=undefined){
			cont = '<tr><td class="rowSection rowHighlight" colspan="12">SSCC No: '+(obj.sscc_carton_num||'')+'</td></tr>';
		}
		return cont;
	};

	var getArticleTrclass = function(obj,$td,$tr){
		if(/*obj.article_life_cycle_info  != 'NA' && obj.article_life_cycle_info  != 'RA' && */obj.article_status_desc != undefined && obj.article_status_desc != ''){
			$tr.addClass('warningIndicator');
		}
	};
	var getArticleTdclass = function(obj,$td){
		if(/*obj.article_life_cycle_info  != 'NA' && obj.article_life_cycle_info  != 'RA' && */obj.article_status_desc != undefined && obj.article_status_desc != ''){
			$td.attr('title',obj.article_status_desc);
		}
	};


	var changeReceiveWgt = function(obj){
		var $elem = $(this);
		var $tr = $elem.closest('tr');
		var obj = $tr.data('obj');
		var value = $elem.val().trim();
		if((value||''!='') && ((obj['tot_weight']||'') != value)){
			obj.tot_weight = value;
		}
	};

	var showUpdateReceiveQty = function(obj){
		var veiw_label = showOrderQty(obj,'rece');
		var qty = '<input type="#" value="'+(obj.newReceQty)+'" class="editNumCell textbox textboxDefaultText receive_qty">';
		var weight = 0;
		var weightCont = '';
		if((obj.random_wt_flag||'').trim()=='Y'){
			weight = obj.rnd_wgt!=null && obj.rnd_wgt!=undefined ? obj.rnd_wgt : (Number((obj.newReceQty||'')) * Number((obj.om||'')));
			obj.tot_weight = (obj.tot_weight||'')=='' ? weight.toFixed(3) : obj.tot_weight;
			weightCont = '<label class="moreInput rece_edit"><strong>Total Weight ('+(obj.base_uom||'')+')</strong></label><input type="#" value="'+(obj.tot_weight)+'" class="receive_weight wtTextBoxFix editNumCell textbox textboxDefaultText">';
		}

		return '<label class="rece_edit">'+qty+weightCont+'</label>';
	};

	var changeExpDate = function(e){
		e.stopPropagation();
		var $elem = $(this);
		var $tr = $elem.closest('tr');
		var obj = $tr.data('obj');
		var value = $elem.val().trim();
		var data_key = $elem.attr('data_key');
		if((value||''!='') && ((obj[data_key]||'') != value)){
			obj[data_key] = value;
			obj.changed = true;
		}else{
			obj.changed = false;
		}
		if(value== '' && obj.expiry_flag=='Y'){
			$elem.addClass(errorFieldClass).attr('title','Expiry date is mandatory.').tooltip({ position : { my : "left center", at : "right+10 center" } });
			obj.error = true;
		}else if(!(isValidDate(formateDate(value)))){
			$elem.addClass(errorFieldClass).attr('title',datInvalid).tooltip({ position : { my : "left center", at : "right+10 center" } });
			obj.error = true;
		}else{
			removetooltip($elem);
			obj.error = false;
		}
	};
	var showRemainExp = function(){
		var $elem = $(this);
		var $td = $elem.closest('td');
		var $more = $td.find('.moreExp');
		var $remain = $td.find('.moreExpInput');
		$remain.toggleClass('hideBlock');
		if($remain.hasClass('hideBlock')){
			$more.text('+ more');
		}else{
			$more.text('- less');
		}
	};
	var changeReceOm = function(){
		var $elem = $(this);
		var $tr = $elem.closest('tr');
		var obj = $tr.data('obj');
		var om = obj.newReceOm;
		var value = $elem.val().trim();
		var baseuom = obj.base_uom||'';
		var orderuom = obj.order_uom||'';//Added for defect 2583
		var multiple = 1;
		if((baseuom != orderuom))
			{
			if(Number(obj.om) == Number(value))
				{
			multiple =  Number(obj.om);
				}
			else
				multiple =  Number(value);
			}
		
		var tot =(Number(multiple) * obj.newReceQty);
		if((value||''!='') && (om != value)){
			obj.newReceOm = value;
			if(obj.action_code != 'I'){
				var $tbl = $tr.closest('table');
				($tbl.data('confObj').updateObj||'' == '') ? $tbl.data('confObj').updateObj ={} : '';
				$tbl.data('confObj').updateObj[obj.article+'_'+obj.order_uom+'_'+obj.article_line]= obj;
			}
			obj.newReceTot = (tot);
			obj.changed = true;
		}else{
			obj.changed = false;
		}
		$tr.find('[data_key="showReceTotQty"]').text(tot+' '+baseuom);
	};

	var changeReceiveQty = function(){
		var $elem = $(this);
		var $tr = $elem.closest('tr');
		var obj = $tr.data('obj');
		var qty = obj.newReceQty;
		var value = $elem.val().trim();
		var baseuom = obj.base_uom||'';
		var orderuom = obj.order_uom||'';//Added for defect 2583
		var multiple = 1;
		if((baseuom != orderuom))
			{
			if(Number(obj.om) == Number(obj.newReceOm))
				{
			multiple =  Number(obj.om);
				}
			else
				multiple =  Number(obj.newReceOm);
			}
			
		var tot =(Number(value) * multiple);
		if((value||''!='') && (qty != value)){
			obj.newReceQty = value;
			if(obj.action_code != 'I'){
				var $tbl = $tr.closest('table');
				($tbl.data('confObj').updateObj||'' == '') ? $tbl.data('confObj').updateObj ={} : '';
				$tbl.data('confObj').updateObj[obj.article+'_'+obj.order_uom+'_'+obj.article_line]= obj;
			}
			obj.newReceTot = (tot);
			obj.changed = true;
		}else{
			obj.changed = false;
		}
		/*if(obj.random_wt_flag == 'Y') //for defect 2281
			baseuom = 'EA';*/
		$tr.find('[data_key="showReceTotQty"]').text(tot+' '+baseuom);
	};

	var getNewExpDate = function(obj){
		return 'newExpDate';
	};

	var getNewReceiveOm = function(obj){
		return 'newReceOm';
	};

	var newReceiveOm = function(obj){
		obj.newReceOm = (obj.newReceOm||obj.newOm);
		return '<input type="#" '+((obj.random_wt_flag == 'Y' || obj.order_uom == 'EA' || obj.order_uom == 'KG') ? 'readonly' : '')+' value="'+obj.newReceOm+'" class="editNumCell textbox textboxDefaultText newQty">';
	};

	var newExpDate = function(obj){
		var newExpDateList = obj.newExpDate;
		var expColumn = '';
		var expLen= 0;
		var expireDateDisable = '';
		if(newExpDateList!=undefined && newExpDateList.length>0){
			expLen = (newExpDateList.length)-1;
			obj.newExpDate = (newExpDateList[0]||'');
			for(var i=0;i<5;i++){
				if(i <= expLen){
					expColumn+='<input type="#" ' + expireDateDisable + ' maxlength="4" placeholder="dd/mm/yyyy" value="'+newExpDateList[i]+'" class="textbox textboxDefaultText inputDate editDateCell exp'+(i+1)+'" data_key="exp'+(i+1)+'">';
				}else{
					expColumn+='<input type="#" ' + expireDateDisable + ' maxlength="4"  placeholder="dd/mm/yyyy" value="" class="textbox textboxDefaultText inputDate editDateCell exp'+(i+1)+'" data_key="exp'+(i+1)+'">';
				}
				if(i==1){
					expColumn+='<label class="linkBtn moreExp"><a class="more">+ more </a></label><span class="more moreExpInput hideBlock">';
				}
				if(i==4){
					expColumn+='</span>';
				}
			}
		}else{
			expColumn+='<input type="#" ' + expireDateDisable + ' maxlength="4"  placeholder="dd/mm/yyyy" class="textbox textboxDefaultText inputDate editDateCell exp1" data_key="exp1"><label class="linkBtn moreExp"><a class="more">+ more </a></label><span class="more moreExpInput hideBlock"><input maxlength="4"  type="#" ' + expireDateDisable + ' placeholder="dd/mm/yyyy" class="textbox textboxDefaultText inputDate editDateCell exp2" data_key="exp2">'
			+'<input type="#" ' + expireDateDisable + '  maxlength="4"  placeholder="dd/mm/yyyy" class="textbox textboxDefaultText inputDate editDateCell exp3" data_key="exp3"><input maxlength="4"  type="#" ' + expireDateDisable + '  placeholder="dd/mm/yyyy" class="textbox textboxDefaultText inputDate editDateCell exp4" data_key="exp4"><input  maxlength="4"  type="#" ' + expireDateDisable + ' placeholder="dd/mm/yyyy" class="textbox textboxDefaultText inputDate editDateCell exp5" data_key="exp5"></span>';
		}
		return expColumn;
	};
	
	var showOrderQty = function(obj,key){
		var qty = '';
		var order_uom = ((obj.order_uom||'')!='' ? obj.order_uom : '');
		if(key== undefined || key =='' || key =='order'){
			qty = ((obj.order_qty!=null && obj.order_qty!=undefined) ? obj.order_qty : '');
			obj.newOrderQty= qty;
		}else if(key == 'disp'){
			qty = ((obj.dispatched_qty!=null && obj.dispatched_qty!=undefined) ? obj.dispatched_qty : '');
			obj.newDispQty = qty;
			order_uom = (obj.dispatched_qty_uom||'');
		}else{ 
			qty = ((obj.received_qty!=null && obj.received_qty!=undefined) ? obj.received_qty : '');
			obj.newReceQty = qty;
			order_uom = (obj.received_qty_uom||'');
		}
		//obj.newTot = (tot);
		/*if(obj.random_wt_flag == 'Y') //for defect 2281
			order_uom = 'EA';*/
		return qty.toString()=='' ? 'NA' : ((qty)+' '+order_uom);
	};

	var showOrderTotQty = function(obj,key){
		var qty = '';
		var baseUom = ((obj.base_uom||'')!='' ? obj.base_uom : '');
		var order_uom = ((obj.order_uom||'')!='' ? obj.order_uom : '');
		var om = '0';//for defect 2281
		var tot = '';
		var multiple = 1;
		if(obj.recv_om != null && obj.recv_om.toString() != "" && key == 'rece')
			om =(obj.recv_om || '');
		else if(obj.dispatched_om != null && obj.dispatched_om.toString() != "" && key == 'disp')
			om =(obj.dispatched_om || '');
		else if(obj.om != null && obj.om.toString() != "" && (key== undefined || key =='' || key =='order'))
			om =((obj.om!=undefined && obj.om!=null) ? obj.om: '');
		multiple = Number(om);
		if(key== undefined || key =='' || key =='order'){
			qty = ((obj.order_qty!=null && obj.order_qty!=undefined) ? obj.order_qty : '');
			obj.newOrderTot = qty.toString() == '' ? '' : qty*multiple;
		}else if(key == 'disp'){
			qty = ((obj.dispatched_qty!=null && obj.dispatched_qty!=undefined) ? obj.dispatched_qty : '');
			obj.newDispTot = qty.toString() == '' ? '' : qty*multiple;
		}else{ 
			qty = ((obj.received_qty!=null && obj.received_qty!=undefined) ? obj.received_qty : '');
			obj.newReceTot = qty.toString() == '' ? '' : qty*multiple;
			
		}
		tot = qty.toString() == '' ? '' : qty * multiple;
		/*if(obj.random_wt_flag == 'Y') //for defect 2281
			baseUom = 'EA';*/
		return tot.toString() == '' ? 'NA' : ((tot)+' '+baseUom);
	};

	var showDispQty = function(obj){
		return showOrderQty(obj,'disp');
	};

	var showOmItem = function(obj){
		var baseUom = ((obj.base_uom||'')!='' ? obj.base_uom : '');
		var om = /*((obj.random_wt_flag||'').trim()=='Y' ? ((obj.pi_om||'')!='' ? obj.pi_om:1) : */((obj.om||'')!='' ? obj.om:1)/*)*/;//for defect 2281
		var changedOm = (((obj.recv_om||'')!='' && obj.recv_om != 0) ? obj.recv_om:'');//for defect 2266
		obj.newOm = ((changedOm != '' && changedOm != om) ? changedOm : om); 
		return (obj.newOm+' ' +baseUom);
	};

	var getOmItem =function(){
		return 'newOm';
	};
	var showDispTotQty = function(obj){
		return showOrderTotQty(obj,'disp');
	};

	var showReceTotQty = function(obj){
		return showOrderTotQty(obj,'rece');
	};

	var showReceiveQty = function(obj){
		var veiw_label = showOrderQty(obj,'rece');
		var qty = '<input type="#" value="'+(obj.newReceQty)+'" class="editNumCell textbox textboxDefaultText">';
		var weight = 0;
		var weightCont = '';
		if((obj.random_wt_flag||'').trim()=='Y'){
			weight = obj.rnd_wgt!=null && obj.rnd_wgt!=undefined ? obj.rnd_wgt : (Number((obj.newReceQty||'')) * Number((obj.om||'')));
			obj.tot_weight = weight.toFixed(3);
			weightCont = '<label class="moreInput rece_edit hideBlock"><strong>Total Weight ('+(obj.base_uom||'')+')</strong></label><input type="#" value="'+(obj.tot_weight)+'" class="editNumCell textbox textboxDefaultText">';
		}

		return '<label class="rece_view">'+veiw_label+'</label><label class="rece_edit hideBlock">'+qty+weightCont+'</label>';
	};

	var getDispQtyData =function(){
		return 'newDispQty';
	};
	var getDispQtyTotData =function(){
		return 'newDispTot';
	};
	var getReceQtyData =function(){
		return 'newReceQty';
	};
	var getReceQtyTotData =function(){
		return 'newReceTot';
	};

	var getOrderQtyData =function(){
		return 'newOrderQty';
	};
	var getOrderQtyTotData =function(){
		return 'newOrderTot';
	};
	
	var getQty = function(){
		return ('newQty');
	};

	var getOm = function(){
		return ('newOm');
	};

	var getTot = function(obj){
		return ('newTot');
	};

	var showQty = function(obj){
		var qty = (obj.changed||'' =='true') ? (obj.newQty||'') : ((obj.order_qty||'')!='' ? obj.order_qty : 0);
		var inpu= '<span class="order_qty viewMode">'+qty+'</span>'+'<input type="#" maxlength="16" value="'+qty+'" class="editNumCell textbox textboxDefaultText hideBlock editMode">';
		obj.oldQty = qty;
		obj.newQty = qty;
		return (inpu);
	};

	var sohQty = function(obj){
		return ((obj.soh != null && obj.soh != undefined && obj.soh !='') ? deciValues(obj.random_wt_flag,obj.weighted_flag,'',obj.pbd_flag,obj.soh,obj.pi_soh,'',obj.base_uom,false,undefined,'') :'0');
	};
	var showOm = function(obj){
		var baseUom = ((obj.base_uom||'')!='' ? obj.base_uom : '');
		var om =/* ((obj.random_wt_flag||'').trim()=='Y' ? ((obj.pi_om||'')!='' ? obj.pi_om:1) :*/ ((obj.om||'')!='' ? obj.om:1)/*)*/;//for defect 2281
		var changedOm = ((obj.recv_om||'')!='' ? obj.recv_om:'');//for defect 2266
		obj.newOm = ((changedOm != '' && changedOm != om) ? Number(changedOm) : Number(om)); 
		return ((Number(obj.newOm))+' '+baseUom);
	};

	var showTot = function(obj){
		var qty = ((obj.newQty||'')!='' ? obj.newQty : ((obj.newQty||obj.order_qty)!='' ? obj.order_qty : 0));
		var baseUom = ((obj.base_uom||'')!='' ? obj.base_uom : '');
		var om = /*((obj.random_wt_flag||'').trim()=='Y' ? ((obj.pi_om||'')!='' ? obj.pi_om:1) :*/ ((obj.om||'')!='' ? obj.om:1)/*)*/;
		var tot = (Number(qty)*Number(om));
		obj.newTot = (tot);
		/*if((obj.random_wt_flag||'').trim()=='Y') //for defect 2281
			baseUom='EA';*/
		return '<strong>'+((tot)+' '+baseUom)+'</strong>';
	};
	
	var getOpenItemGrpCont = function(obj,confObj){
		//var obj = value[0];
		var cont = '<tr id="none"></tr>';
		if(obj!=null && obj!=undefined){
			cont = '<tr><td class="rowSection rowHighlight" colspan="12">Department: '+(obj.department_name||'')+'</td></tr>';
		}
		return cont;
	};
	
	var orderDetailData =function($elem){
		//console.log('sort or page');
		/*if($elem!=undefined && $elem.length>0)
			$elem.find('.inputDate').datepicker({ zIndex : 50 });*/
	};
	
	var onlyNumber = function(e){
		if (e.which != 8
				&& e.which != 0
				&& (e.which < 48 || e.which > 57)
				&& (e.which != 46 || $(this).val().indexOf(
						'.') != -1) && e.which != 37) {
			return false;
		}
	};

	var genArticleSearch =function(e){
		var tableId = e.data.tableId;
		var elem = $(e.data.elem);
		if(validateTheSearchform(elem ,tableId)){
			var article = elem.find('#add_article_input_'+tableId).val();
			var obj = e.data.hdrObj;
			var qty = Number(elem.find('#add_qty_'+tableId).val().trim());
			var srcInd = '';
			var supplier = '';
			srcInd = (isPO(obj.order_type)) ? 1 : ((isSTO(obj.order_type)) ? 2 : '');
			supplier = obj.supplier_no;
			var param = new orderParam(article.split('-')[0],'','','','','','','',srcInd,supplier);
			param.qty = qty;
			param.tableId = tableId;
			articleSearch(packBreakArticleSearch,param,processArticleResultOpenOrder);
		}
	};

	function processArticleResultOpenOrder(data,param){
		var obj ={param:param,data:data,cache : $('#'+param.tableId+'_table')};
		if(data.length == 1){
			console.log('data ='+data);
			addOpenObj(obj);
		}else{
			$.fn.loadArticlePopUp(data,onSelectOption,'',onArticleTdCheck,checkboxOption,param.iv_article,'','',param);
		}
		stopLoading();
	}
	
	var updateReceiveQty = function(e){
		var dataObj = jQuery.extend(true, {}, e.data.dataObj);
		var hdrObj = dataObj.hdrObj;
		var deliveryObj = dataObj.deliveryObj;
		var deliveryFlag = dataObj.deliveryFlag;
		var orderNo = (deliveryFlag) ? deliveryObj[0].delivery_no : hdrObj.order_no;
		var param = new tparam(orderNo, 'V','U');
		getReceiveTransId(param,dataObj,frameUpdateQty);
	};

	function getReceiveTransId(param,dataObj,followup) {
		console.log('URL ='+getReceivingTransactionUrl +' '+JSON.stringify(param));
		$.ajax({
		    type: "post",
		    url: getReceivingTransactionUrl,
		    data: JSON.stringify(param),
		  }).done(function(data) {
			 if(checkResult(data,'TRANSID')){
				validateTransId(param,data,dataObj,followup);
			 }else{
				stopLoading();
			 }
		  }).fail(function() {
			  $.fn.showCustomMsg([ngboSessErrCode],error,'Order Details');
		  }).always(function() {
			  stopLoading();
		  });
	}
	
	function tblConfObjGrInfo(title,data){
		this.option = 'build';this.key = ['article','vendor_ref_no','article_desc','showOmItem','showReceiveQty','showReceTotQty'];
		this.table_name = title;this.table_title = '';
		this.table_class = ' ContentTable actionRows';this.header_tr_class = 'collapsed';
		this.header_name = {article:'Article',vendor_ref_no:'Vendor<br>Ref #',article_desc:'Description'};
		this.header_data_type = {article:'number',vendor_ref_no:'char',article_desc:'char',showOmItem:'char',showReceiveQty:'number',showReceTotQty : 'number'};
		this.header_row_type = {article:'main',vendor_ref_no:'main',article_desc:'main',showOmItem:'main',showReceiveQty:'main',showReceTotQty:'main'};
		this.header_sub_rows = {};
		this.header_class = {article:'',vendor_ref_no:'',article_desc:'',showOmItem:' numberColumn  ',showReceiveQty:' numberColumn ',showReceTotQty:' numberColumn  lastColumn '};
		this.header_width = {article:'',vendor_ref_no:'',article_desc:'',showOmItem:'',showReceiveQty:'',showReceTotQty:''};
		this.content_class = {article:'',vendor_ref_no:'',article_desc:'',showOmItem:' numberColumn  ',showReceiveQty:' numberColumn ',showReceTotQty:' numberColumn  lastColumn '};
		this.content_format = {article:'removeNull',vendor_ref_no:'removeNull',article_desc:'removeNull'};
		this.content_width =  {article:'',vendor_ref_no:'',article_desc:'',showOmItem:'',showReceiveQty:'',showReceTotQty:''};
		this.tr_id= ['article'];
		this.header_td_label = {showOmItem:'OM',showReceiveQty:'Received Qty.',showReceTotQty:'Total Units Received'};
		this.content_label = {};
		this.cont_data_function = {showOmItem:showOmItem,showReceiveQty:showReceiveQty,showReceTotQty:showReceTotQty};
		this.cont_sort_function = {showOmItem:getOmItem,showReceiveQty:getReceQtyData,showReceTotQty:getReceQtyTotData};
		this.default_groupbyColumn =['department_no'];
		this.groupbyColumn ={'department_no': 'Department'};
		this.cont_group_data_function = {showQty:showQty};
		this.group_cont_function = {department_no:getOpenItemGrpCont,article:''};
		this.sort_done = {sort_done: orderDetailData};this.page_done = {page_done: orderDetailData};
		this.content_bind_event = {click: ''};this.content_tr_addon = {click: ''};this.content_title = {},this.header_title = {};
		this.content_td_addon = {}; this.header_td_addon = {};
		this.comp_key_parser = {}; this.content =  data;this.pagination = true;this.groupby= false;this.recordPerPage= 10;this.groupbyColumn =[];this.filter= false;
		this.filterbyColumn ={article:'article',vendor_ref_no:'vendor_ref_no',article_desc:'article_desc',showOmItem:'showOmItem',showReceiveQty:'showReceiveQty',showReceTotQty:'showReceTotQty'};this.curr_page= 1;this.sort=true;
	}

	function createWareHouseList(data) {
		var content = '<option value="0">Select</option>';
		if (!$('#pmywhlist select').hasClass('loaded')) {
			$
					.ajax({
						// data : JSON.stringify(data),
						data : data,
						url : warehouseLookupServiceURL,
						type : 'post',

						beforeSend : function() {
							// console.log("---4");
							startLoading();
						},
						success : function(response) {
							// var res = $.parseJSON(response);
							var res = response;
							if (res != null && res != undefined && res.length > 0
									&& res[0].site_no != undefined) {

								for ( var i = 0; i < res.length; i++) {
									warehouseMap[res[i].site_no] = res[i].site_no;
									content += '<option value="' + res[i].site_no
											+ '">' + res[i].site_no + '-'
											+ res[i].site_desc + '</option>';
								}
							} else {
								showAllErrors(['No warehouse availalbe for the logged in store']);
								//showError('No warehouse availalbe for the logged in store');
							}
							$('#pmywhlist select').html(content);
							stopLoading();
						},
						error : function() {
							// goToLogin();
							$('#pmywhlist select').html(content); 
							stopLoading();
						}
					});
			$('#pmywhlist select').addClass('loaded');
		}
	}
	
	function getNearbyStores(area, data) {
		console.log(nearbyStoreSearchURL+' '+JSON.stringify(data));
		var tblHdr = '<thead><tr><th>Site No</th><th>Site Name</th><th width="100px" class="lastColumn centerValue">Select</th></tr></thead>';
		$
				.ajax({
					// data : JSON.stringify(data),
					data : JSON.stringify(data),
					url : nearbyStoreSearchURL,
					type : 'post',

					beforeSend : function() {
						// console.log("---4");
						startLoading();
					},
					success : function(response) {
					//	var res = $.parseJSON(response);
						var res = response;
						
						area.find('#siteResults').removeClass('hideBlock');
						area.find('#popupSearch').removeClass('hideBlock');
						if (res != null && res != undefined && res.data !=null && res.data.length>0 &&  res.data[0].site_no !=null) {
							var list = res.data;
							var j = 0;
							var k = 1;

							for ( var i = 0; i < list.length; i++) {
								j++;

								tblHdr += '<tr class="nearbyVerifyContent ';
								if (k > 1) {
									tblHdr += ' hideBlock ';
								}
								tblHdr += ' pagNo-' + k + '"><td>'
										+ list[i].site_no + '</td><td>'
										+ list[i].site_name + '</td>';
								tblHdr += '<td class="sorted lastColumn centerValue"><input type="radio" id="siteSelect" name="siteSelect" value="'+list[i].site_no+'-'+list[i].site_name+'"></td></tr>';

								if (j % 9 == 0) {
									k++;
								}

							}
							if (j >= 1) {
								currPageNear = 1;
								area.find('#siteResults').removeClass('hideBlock');
								area.find('#siteResults #searchWarning').addClass(
										'hideBlock');
								area.find('#siteResults .tableTitle').removeClass(
										'hideBlock');
								area.find('#siteResults .ContentTable')
										.removeClass('hideBlock');
								area.find('#siteResults .tableTitle strong').text(
										list.length);
								area.find('#siteResults .ContentTable').html('');
								area.find('#siteResults .ContentTable').html(
										tblHdr);
								area.find('#siteResults .noteLbl').remove();
								//$("#dialog-siteSearchPop").dialog("open");
								if (j > 9) {
									area.find('.nearby-pagination ').removeClass(
											'hideBlock');
									area.find('.nearby-pagination ').pagination({
										items : j,
										itemsOnPage : 9,
										cssStyle : 'compact-theme',
										currentPage : currPageNear,
										onPageClick : function(pageNumber) {
											showNearbyStoreNoPage(area, pageNumber);

										}

									});
								} else {
									area.find('.nearby-pagination ').addClass('hideBlock');
								}
								//bindNearByStoreContent();

							}

						} else {
							area.find('#siteResults').removeClass('hideBlock');
							area.find('#siteResults .ContentTable').addClass(
									'hideBlock');
							showErrorInpopUp(
									area.find('#siteResults #searchWarning'),
									'Sorry , no results found for the search criteria. Please try again.');
							area.find('.nearby-pagination ').addClass('hideBlock');
							area.find('#siteResults .tableTitle').addClass(
									'hideBlock');
						}
						stopLoading();
					},
					error : function() {
						// goToLogin();
						// $('#mywhlist select').html(content);
						area.find('#siteResults').removeClass('hideBlock');
						area.find('#siteResults .ContentTable').addClass(
								'hideBlock');
						showErrorInpopUp(area.find('#siteResults #searchWarning'),
								'Sorry , no results found for the search criteria. Please try again.');
						area.find('.nearby-pagination ').addClass('hideBlock');
						area.find('#siteResults .tableTitle')
								.addClass('hideBlock');
						stopLoading();
					}
				});
	}

	function showNearbyStoreNoPage(area,pageNo) {
		currPage = pageNo;
		var pageClass = 'pagNo-' + pageNo;
		area.find('.nearbyVerifyContent').filter(function() {
			if ($(this).hasClass(pageClass))
				$(this).removeClass('hideBlock');
			else
				$(this).addClass('hideBlock');
		});
	}

	function showErrorInpopUp(elem, msg) {
		$(elem).html('<h4>' + msg + '</h4>').removeClass('hideBlock');
	}
	
	function bindSitePopupEvents($popArea, segmentFlag,elem,dataObj){
		$popArea.find("#pos1").unbind('keypress');
		$popArea.find('#pos1').keypress(function(){
			$popArea.find('input[id="siteSelect"][type="radio"]:checked').prop('checked', false);
			$popArea.find("#pmywhlist #warehouseInPopup").val('0');
		});
		$popArea.find("#verifysite").unbind('click');
		$popArea.find('#verifysite').click(
				function() {
					//hideError();
					//hideErrorContent();
					if ($popArea.find('#pos1').val().trim() == '') {
						$.fn.showCustomMsg(['Please enter a store number or name'],error,'Stock Transfer');
						//$popArea.find('#pos1').error('');
					} else {
						var siteVal = $.trim($('#pos1').val()).split('-')[0].trim();
						verifyStore({
							iv_site: siteVal
						}, true, $popArea);
					}

				});
		$popArea.find("#pwh").unbind('click');
		$popArea.find("#pwh").click(function() {
			$popArea.find("#popupSearch, .errorDiv").addClass('hideBlock');
			$popArea.find("#siteResults").addClass('hideBlock');
			$popArea.find("#pmywhlist").removeClass('hideBlock');
			$popArea.find("#pmywhlist").val('0');
			/*
			 * createWareHouseList({ siteNo : loggedInSiteNo });
			 */
			//$('.removeStore').trigger('click');
			$popArea.find('#pos1').val('');
		});
		$popArea.find("#pnearby").unbind('click');
		$popArea.find("#pnearby").click(function() {
			//restNearbyVal();
			var distance = 10;
			var maxStores = 10;
			var salesOrgList = [];
			salesOrgList.push($('#salesOrg').val());
			$popArea.find('#pos1').val('');
			$popArea.find("#pmywhlist, .errorDiv").addClass('hideBlock');
			$popArea.find("#pmywhlist").val('0');
			var data = {
				"articleNo"	: "",
				"siteNo" : siteNo,//removed hardcoded 0150 value
				"salesOrg" : salesOrgList,
				"distance" : distance,
				"maxStores" : maxStores,
				"userId"	: $('#loginUserId').val(),
				"sap"	: encSapPwd
			};
			getNearbyStores($popArea, data);


		});
		$popArea.find(".nearbyStoreSearchBtn").unbind('click');
		$popArea.find(".nearbyStoreSearchBtn").click(function() {
			salesOrg = $('.salesOrgMap').val();
			var distance = $('#near-by-distance').val();
			var maxStores = $('#near-by-max').val();
			var salesOrgList = [];
			salesOrgList.push(salesOrg);
			$popArea.find('#pos1').val('');
			$popArea.find("#pmywhlist, .errorDiv").addClass('hideBlock');
			$popArea.find("#pmywhlist").val('0');
			var data = {
					"articleNo"	: "",
					"siteNo" : siteNo,// removed hardcoded 0150 value
					"salesOrg" : salesOrgList,
					"distance" : distance,
					"maxStores" : maxStores,
					"userId"	: $('#loginUserId').val(),
					"sap"	: encSapPwd
				};
			getNearbyStores($popArea, data);

		});
		$popArea.find("#ibtProceed").unbind('click');
		$popArea.find('#ibtProceed').click(function(){
			
			var itemParam = new stockItemParam();

			if (validateStockTransfer($popArea, itemParam,dataObj)) {
				var tempList = [];
				tempList.push(itemParam);
				param = new stockParam(tempList, itemParam.iv_supplier);
				createIBTHdrDraftList(param, segmentFlag,elem,dataObj);
			}
			
		});
		$popArea.find("#ibtCancel").unbind('click');
		$popArea.find('#ibtCancel').click(function(){
			
			$popArea.dialog('close');
			
		});
		$popArea.find("#pmywhlist").unbind('change');
		$popArea.find("#pmywhlist").change(function()
				{
			$popArea.find('#pos1').val('');
				});
	}
	
	function verifyStore(data, flag, $popArea) {
		
		console.log(getSiteDescriptionUrl+' '+JSON.stringify(data));
		$
				.ajax({
					data : JSON.stringify(data),
					url : getSiteDescriptionUrl,
					type : 'post',

					beforeSend : function() {
						// console.log("---4");
						startLoading();
					},
					success : function(response) {
						var res = response;
//						hideErrorContent();
						$('#dialog-verify .popupActionsWrapper').addClass(
								'hideBlock');
						$popArea.find('.errorDiv').addClass('hideBlock');
						var tblHdr = '<thead><tr><th data-sort="string">Store ID</th><th data-sort="string" class="sorted ascending" >Store Name</th><th width="25px" class="lastColumn">&nbsp;</th></tr></thead>';
						if (res != null && res != undefined && res.length > 0) {
							var list = res;
							var j = 0;
							var k = 1;
							var siteNo = '';
							var siteName = '';
							siteNo = list[0].site_no;
							siteName = list[0].site_desc;
							for ( var i = 0; i < list.length; i++) {
								j++;

								tblHdr += '<tr class="verifyContent ';
								if (k > 1) {
									tblHdr += ' hideBlock ';
								}
								tblHdr += ' pagNo-' + k + '"><td>'
										+ list[i].site_no + '</td><td>'
										+ list[i].site_desc + '</td>';
								tblHdr += '<td class="sorted lastColumn"><label class="linkBtn"><label class="selectItem selectStore">Select</label></label></td></tr>';

								if (j % 9 == 0) {
									k++;
								}

							}
							if (j > 1) {
								currPage = 1;
								$('#dialog-verify h4')
										.html(
												'Too many search results for <strong>'
														+ $.trim($('#pos1')
																.val())
														+ '</strong>. Please select a store from the list below.');
								$('#dialog-verify').parent().find(
										'.ui-dialog-titlebar .ui-dialog-title')
										.text('Verify Store');
								$('#dialog-verify .ContentTable').html('');
								$('#dialog-verify .ContentTable').html(tblHdr);
								$('#dialog-verify .noteLbl').remove();
								$("#dialog-verify").dialog("open");
								$('#dialog-verify .textbox ').attr('placeholder',
										'Enter store no. or name');
								$('#dialog-verify .popupActionsWrapper ').addClass(
										'hideBlock');
								if (j > 9) {
									$('.verifyPagination').removeClass('hideBlock');
									$('.verifyPagination').pagination({
										items : j,
										itemsOnPage : 9,
										cssStyle : 'compact-theme',
										currentPage : currPage,
										onPageClick : function(pageNumber) {
											showStoreNoPage(pageNumber);

										}

									});
								} else {
									$('.verifyPagination').addClass('hideBlock');
								}
								bindVerifyStoreContent($('#dialog-verify'));
								//bindStoreContent(flag);
							} else {
								if (siteNo != '' && siteName != '') {
									var site = siteNo + '-' + siteName;
									$popArea.find('#pos1').val(site);
									$popArea.find("#isVerified").val(true);
									$('.removeStore').trigger('click');
									$popArea.find('#warehouseInPopup').val('Select');
								} else {
									showAllErrors(['Invalid store Id/Name']);
									//showError('Invalid store Id/Name');
								}
							}

						} else {
							showAllErrors(['Invalid store Id/Name']);
							//showError('Invalid store Id/Name');
						}
						stopLoading();
					},
					error : function() {
						// goToLogin();
						stopLoading();
					}
				});
	}
	
	function bindVerifyStoreContent(storePoparea) {
		var area = $('#dialog-editSitePop');
		storePoparea.find('.selectStore').click(
				function() {
					//hideErrorContent();
					var site = $(this).parent().parent().parent().find('td:first')
							.text().trim()
							+ '-'
							+ $(this).parent().parent().parent().find(
									'td:nth-child(2)').text().trim();
					area.find('#pos1').val(site);
					area.find("#isVerified").val(true);
					storePoparea.dialog("close");
					area.find('.removeStore').trigger('click');
					area.find('#warehouse').val('Select');
				});
	}
	
	function stockItemParam() {
		this.iv_delivery_date = formatDateMobi(getDesiredPastDate(0));
		this.iv_roster_date = formatDateMobi(getDesiredPastDate(0));
		this.iv_site = $('#posSite').val();
		this.iv_session_id = '123';
		this.iv_article = '';
		this.iv_article_uom = '';
		this.iv_created_user = '';
		this.iv_created_time = '';
		this.iv_action = '';
		this.iv_submitted_user = '';
		this.iv_submitted_time = '';
		this.iv_updated_user = '';
		this.iv_updated_time = '';
		this.iv_qty = '';
		this.iv_om = '';
		this.iv_delivery_date = '';
		this.iv_supplier = '';
		this.iv_roster_date = '';
		this.iv_order_type = '';
		this.iv_preq_no = '';
		this.iv_weight = '';
		this.iv_contact_name = '';
		this.iv_contact_no = '';
		this.iv_pickup_date = '';
		this.iv_pickup_time = '';
		this.iv_comments = '';
	}
	
	var tparam = function(orderNo,action,receiveFlag){
		this.iv_user_id = userId;
		this.iv_delivery_no = orderNo;
		this.iv_platform = 'B';
		this.iv_action = action;
		this.iv_session_id = '';
		this.iv_receive_flag =receiveFlag;
	};
		
	var validateTransId = function(param,data,dataObj,followUp){
		var obj=data[0];
		var usrId = (obj.USER_ID||'');
		var userName = (obj.USER_NAME||'');
		var msg = obj.MSG;
		var transId = (obj.TRANSID||'');
		var info = '';
		if(msg=='N' && transId!=''){
			//Directly redirect to the next page without popup
			dataObj['transId'] = transId;
			followUp(dataObj,true);
		}else if(msg=='S'){
			//Show popup for confirmation
			dataObj['transId'] = transId;
			/*if(usrId != userId){
				info = 'There are few articles in this order are <strong>received by <span>'+getSupplierNo(userName,usrId)+'</strong> in previous session.';
				$.fn.showReceivePop({msg:info,title:'Receiving',text1:'Resume Session',text2:'New Session',text1e:resumeReceSesstion,text2e:newReceSesstion, text1c:'hideBlock actionBtn',text2c: 'actionBtn',dataObj:dataObj});
			}else{
				info = 'There are few articles in this order are <strong>captured as received</strong> in the system.';
				$.fn.showReceivePop({msg:info,title:'Receiving',text1:'Resume Session',text2:'New Session',text1e:resumeReceSesstion,text2e:newReceSesstion,text1c:' actionBtn',text2c: 'actionBtn',dataObj:dataObj});
			}*/
			followUp(dataObj,true);
		}else if(msg=='L'){
			//Alret user
			info = getSupplierNo(userName,usrId)+' is currently updating/receiving this order. Please try again later.';
			$.fn.warnPopup('alert',info,'Order Details','','',triggerOk,'');
		}
	};

	var triggerOk = function(e){
		e.data.dialog.dialog('close');	
	};
	var frameUpdateQty = function(contObj,retain_flag){
		var itemObj = contObj.itemObj;
		var $hold= framUpdateCont(contObj);
		frameUpdateQtyItemCont($hold,itemObj,(isPO(contObj.hdrObj.order_type) && (contObj.hdrDtlObj[0].asn_no||'') !=''));
		navigate(update);
	};

	var frameUpdateQtyItemCont = function($hold,itemObj,poFlag){
		var confObj = new tblConfObjNonSegItemInfo('updateQtyTbl',itemObj,receStatus);
		var $itemHold = $hold.find('#updateQtyContentWrap');
		
		confObj.groupby = false;confObj.filter= false;confObj.default_groupbyColumn =[];confObj.sort =false;
		confObj.table_title = 'List of Articles already Received ('+itemObj.length+')';
		confObj.updateFlag = true;
		confObj.cont_data_function.showReceiveQty = showUpdateReceiveQty;
		$itemHold.loadtbl(confObj);
		$itemHold.find('#updateQtyTbl_foot').addClass('hideBlock');
		if(poFlag){
			$itemHold.find('.addActionBtn').removeClass('hideBlock').find('a').addClass('hideBlock').text('');
		}else{
			$itemHold.find('.addActionBtn').removeClass('hideBlock').find('a').removeClass('hideBlock').find('.addRow').text('Add Missing Articles');
		}
		$itemHold.find('.lookupActionWrapper').append(extraAction).find('#changeOmExpDate').unbind('change').bind('change',changeOmExDate);
		$itemHold.find('#updateQtyTbl_head').addClass('padtop25');
		//$itemHold.find('.rece_view').toggleClass('hideBlock');
		//$itemHold.find('.rece_edit').toggleClass('hideBlock');
		$itemHold.find('.inputDate').datepicker({ zIndex : 50 });
		$("#updateQtyTbl_table").find(".receive_weight").isWithinOnly3Decimal();	
	};

	var framUpdateCont = function(dataObj){
		var $hold = getUpdateQtyWrap();
		var update_cont = '<div class="ContentTableWrapper"><div><div class="tableInfo"><div class="tableTitle"><h4 class="sectionTitle">Update Received Qty.</h4></div></div></div></div>';
		var updat_action = '<div class="articleActionBtns"><label class="orderStatus">Status: <strong>Received</strong></label><label class="actionBtn" id="saveupdateQty_up"><a><label class="">Save</label></a></label><label class="secondaryActionBtn" id="cancelUpdateQty_up"><a>Cancel</a></label></div>';
		update_cont +='<div class="articleHead">';
		if(dataObj.deliveryFlag){
			update_cont += '<div class="articleHeaderWrapper"><h2 class="articleTitle">Delivery '+(dataObj.deliveryObj[0].delivery_no||'')+' (Segment #'+(dataObj.deliveryObj[0].segment_no||'')+')</h2></div>';
			update_cont+= updat_action+'<div class="articleInfoWrapper"><p class="secondaryInfo">';
			update_cont+= '<label class="articlePriceLabel">'+sentenceCase(dataObj.hdrObj.order_type||'')+' Order #'+$.tablebuild.dataparse.trim((dataObj.hdrObj.order_no||''))+'</strong></label>';
			update_cont+= '<label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Supplier: <strong>'+getSupplierNo(dataObj.hdrObj.supplier_name,dataObj.hdrObj.supplier_no)+'</strong></label>';
		}else{
			update_cont += '<div class="articleHeaderWrapper"><h2 class="articleTitle">'+sentenceCase(dataObj.hdrObj.order_type||'')+' Order #'+$.tablebuild.dataparse.trim((dataObj.hdrObj.order_no||''))+'</h2></div>';
			update_cont+= updat_action+'<div class="articleInfoWrapper"><p class="secondaryInfo">';
			if(!isST(dataObj.hdrObj.order_type)){
				update_cont+= '<label class="articlePriceLabel">Supplier: <strong>'+getSupplierNo(dataObj.hdrObj.supplier_name,dataObj.hdrObj.supplier_no)+'</strong></label>';
			}else{
				update_cont+= '<label class="articlePriceLabel">Receiving Store: <strong>'+getSupplierNo(dataObj.hdrDtlObj[0].receiving_site_name,dataObj.hdrDtlObj[0].receiving_site)+'</strong></label><label class="articlePriceLabel"> | </label><label class="articlePriceLabel">Sending Store: <strong>'+getSupplierNo(dataObj.hdrObj.supplier_name,dataObj.hdrObj.supplier_no)+'</strong></label>';
			}
		}
		update_cont+= '</p></div></div>'+up_qty_cont_wrap+updateQtyActionBtn;
		$hold.html('').append(update_cont);
		bindframUpdateCont($hold,dataObj);
		return $hold;
	};

	var bindframUpdateCont = function($hold,dataObj){

		var $updateCancelBtn = $hold.find('#cancelUpdateQty_dwn,#cancelUpdateQty_up');
		var $updateSaveBtn = $hold.find('#saveupdateQty_dwn,#saveupdateQty_up');
		
		if($updateCancelBtn!= undefined && $updateCancelBtn.length>0){
			var $itemHold = $hold.find('#updateQtyContentWrap');
			$hold.find('#cancelUpdateQty_dwn,#cancelUpdateQty_up').unbind('click').bind('click',{itemHold:$itemHold,dataObj:dataObj,contHold:$hold},cancelUpdateQty);
		}
		
		if($updateSaveBtn!= undefined && $updateSaveBtn.length>0){
			var $itemHold = $hold.find('#updateQtyContentWrap');
			$hold.find('#saveupdateQty_dwn,#saveupdateQty_up').unbind('click').bind('click',{itemHold:$itemHold,dataObj:dataObj,contHold:$hold},saveUpdateQty);
		}
	};

	var cancelUpdateQty = function(e){
		console.log('cancel cancelUpdateQty qty');
		var dataObj = e.data.dataObj;
		$.fn.warnPopup('warn',cancelMsg,'Order Update',triggerUpdateCancelYes,triggerDeleteNo,'',dataObj);
	};

	var saveUpdateQty= function(e){
		console.log('cancel saveUpdateQty qty');
		//var data = e.data;
		$.fn.warnPopup('warn',saveMsg,'Order Update',triggerUpdateSaveYes,triggerDeleteNo,'',e.data);
	};

	var triggerUpdateCancelYes = function(e){
		var dataObj = e.data.cache;
		var hdrObj = dataObj.hdrObj;
		var param = new receiveParam();
		param.iv_order_no = hdrObj.order_no;
		param.iv_trans_id = dataObj.transId;
		param.iv_action_flag = 'X';
		param.iv_order_recv_method = '';
		receiveUpdateOrder(param,dataObj,orderUpdateCancelFollowup,true);
		e.data.msg.dialog('close');
	};

	var triggerUpdateSaveYes = function(e){
		var cache = e.data.cache;
		var $tbl = cache.itemHold.find('#updateQtyTbl_table');
		var dataObj = cache.dataObj;
		var hdrObj = dataObj.hdrObj;
		var content = $tbl.data('confObj').content;
		var iv_item_info = formReceiveItemObj(content);
		if(iv_item_info!=false){
			var param = new receiveParam();
			var iv_order_type = '';var iv_sap_order_type = '';
			if(isPO(hdrObj.order_type)){
				iv_order_type ='PO';
				iv_sap_order_type = 'DGR';
			}else if(isSTO(hdrObj.order_type)){
				iv_order_type ='STO';
				iv_sap_order_type = 'WGR';
			}else{
				iv_order_type ='IBT';
				iv_sap_order_type = 'IRE';
			}
			param.iv_order_no = hdrObj.order_no;
			param.iv_order_type =  iv_order_type;
			param.iv_sap_order_type = iv_sap_order_type;
			param.iv_trans_id = dataObj.transId;
			param.iv_action_flag = 'P';
			param.iv_multi_receipt = '';
			param.iv_item_info = iv_item_info;
			param.iv_order_recv_method = '';
			receiveUpdateOrder(param,dataObj,orderUpdateSuccessFollowup,false);
		}
		e.data.msg.dialog('close');
	};

	var formReceiveItemObj = function(content){
		var rece_list = [];
		var item = {};
		for(var i=0;i<content.length;i++){
			item = new formRecvItemObj(content[i]);
			if(content[i].error){
				$.fn.showCustomMsg(['Please correct the highlighted fields.'],error,'Update Order');
				return false;
			}
			item.iv_line_no = padzero((item.iv_line_no||'').substr(1,4),4);
			if(item.changed){
				rece_list.push(item);
			}
		}
		return rece_list;
	};

	var orderUpdateCancelFollowup = function(param,data,dataObj){
		if(data[0].typ == 'S')
			navigate(detail);
		else
			$.fn.showCustomMsg([mobiSerErrCode],error,'Update Order');
	};

	var orderUpdateSuccessFollowup = function(param,data,dataObj){
		if(data[0].typ == 'S'){
			startLoading();
			getOrderDetailForNgboStore(dataObj.hdrObj);
			$.fn.showCustomMsg([orderReceUpdate],success,'Update Order');
		}else
			{
			$.fn.showCustomMsg([mobiSerErrCode],error,'Update Order');
			stopLoading();
			}
	};

	function receiveUpdateOrder(param,dataObj,followUp,flag){
		console.log('URL ='+addReceivingTransactionUrl +' '+JSON.stringify(param));
		$.ajax({
		    type: "post",
		    url: addReceivingTransactionUrl,
		    data: JSON.stringify(param),
			beforeSend: function(){
				startLoading();
			}
		  }).done(function(data) {
			 if(checkResult(data,'typ')){
				followUp(param,data,dataObj);
				if(flag)
				stopLoading();
			 }
		  }).fail(function() {
			  $.fn.showCustomMsg([ngboSessErrCode],error,'Update Order');
			  stopLoading();
		  });
	}
	
	var getUpdateQtyWrap = function(){
		var cont = $('#update_order');
		if(cont ==undefined || cont.length == 0){
			$('#orderLookUpWrapper').append('<div id="update_order" class="contentWrapper orderWrappers "></div>');
			cont = $('#update_order');
		}	
		return cont;
	};
	var changeOmExDate = function(){
		var $this = $(this);
		var flag = $this.prop('checked');
		var $tbl = $this.closest('#updateQtyContentWrap').find('table');
		var $tr = $tbl.find('.mainTr');
		$tr.each(function(){
		  $elem = $(this);
		  var obj = $(this).data('obj');
		  obj.error = '';	  
		  var baseuom = obj.base_uom||'';//Added for defect 2583
		  var orderuom = obj.order_uom||'';
		  var multiple = 1;
			//if((baseuom != orderuom))
			//{
			if(Number(obj.recv_om) == Number(obj.newOm)){
				multiple =  Number(obj.recv_om);
			}else
				multiple =  Number(obj.newOm);
			//}
		  
		  obj['newReceOm'] = obj.newOm;
		  obj['newReceTot'] = (Number(multiple) * Number(obj.newReceQty));
		  obj['exp1'] = '';  obj['exp2'] = '';  obj['exp3'] = '';  obj['exp4'] = '';  obj['exp5'] = '';
		  obj['pi_om'] = obj.pi_om;
		  $elem.find('[data_key="showReceTotQty"]').text(obj['newReceTot']+' '+(obj.base_uom||''));
		  $elem.find('[data_key="newReceiveOm"]').find('input').val(obj['newReceOm']||'');
		  $elem.find('[data_key="newExpDate"]').find('input').val('').datepicker({ zIndex : 50 }).removeClass(errorFieldClass).removeClass('tooltip').removeAttr('title');
		  if(flag){
			$elem.find('.editMode').removeClass('hideBlock');
		  }else{
			$elem.find('.editMode').addClass('hideBlock');
		  }
		});
		if(flag){
			$tbl.find('#thead_updateQtyTbl').find('.editMode').removeClass('hideBlock');
		}else{
			$tbl.find('#thead_updateQtyTbl').find('.editMode').addClass('hideBlock');
		}
	};
	
	var triggerDeleteNo = function(e){
		var $elem = e.data.msg;
		$elem.dialog('close');
	};
	
	var receiveParam = function(){
		this.iv_site_no = siteNo;
		this.iv_user_id = userId;
		this.iv_pwd = '';
		this.iv_session_id = '';
		this.iv_order_no  = '';
		this.iv_action_flag  = '';
		this.iv_order_type  = '';
		this.iv_trans_id  = '';
		this.iv_receive_method  = '';
		this.iv_delivery_date  = '';
		this.iv_invoice_no  = '';
		this.iv_delivery_no  = '';
		this.iv_asn_no  = '';
		this.iv_sap_order_type  = '';
		this.iv_multi_receipt = '';
		this.iv_supplier_no  = '';
		this.iv_cons_freight  = '';
		this.iv_carrier  = '';
		this.iv_rego  = '';
		this.iv_trailer = '';
		this.iv_comments  = '';
		this.iv_chilled_temp  = '';
		this.iv_frozen_temp = '';
		this.iv_delivery_doc_id = '';
		this.iv_item_info = [];
		this.iv_uld_info = [];
		this.iv_platform = 'B';
		this.iv_era_partial_recv_flag = '';
	    this.iv_multiple_delivery = '';
	};
	
	function saveAuthNoInNGBO(obj) {

		var vendorClaimOrderNo = '';
		var authNo = $('#vendorAuthNoNgbo')
				.val().trim();
		
		if (obj != '' && obj != null
				&& obj != undefined)
			vendorClaimOrderNo = obj.hdrObj.order_no;
		
		var param ={ 
		"iv_order_no" : vendorClaimOrderNo,
		"iv_pwd" : encSapPwd,
		"iv_session_id" : "111",
		"iv_site_no" : siteNo,
		"iv_user_id" : userId,
		"iv_vendor_auth_no" : authNo
		};
		
		console.log(vendorClaimAuthorisationURL+' '+JSON.stringify(param));
		
		 $.ajax({
		        type: "POST",
		        url: vendorClaimAuthorisationURL,
		        data: JSON.stringify(param),
		        beforeSend : function(){startLoading();}
		      }).done(function(response) {

		    		if(response != undefined && response.typ==undefined){
		    				 $.fn.showCustomMsg([mobiSerErrCode],error);
		    		  }else if(response != undefined && response.typ!=undefined){
				    		  var obj = response;
				    		  if(obj.typ == 'S')
				    			  {
				    			  $.fn.showCustomMsg([obj.msg],success,'Order Details');
				    			  $('#vendorClaimAuthNoNgbo').text($('#vendorAuthNoNgbo').val().trim());
				    			  }
				    		  else if(obj.typ == 'E')
				    			  {
				    			  $.fn.showCustomMsg([obj.msg],error,'Order Details');
				    			  }
		    		  }
		    		stopLoading();	
		    	  $("#dialog-modal-autho-ngbo").dialog("close");
			  }).fail(function() {
				  $.fn.showCustomMsg([mobiSerErrCode],error,'Order Details');
			  }).always(function() {
				  stopLoading();
			  });
		
		
	}
	function isNumberKey(evt)
	{
	   var charCode = (evt.which) ? evt.which : event.keyCode;
	   if (charCode > 31 && (charCode< 48 || charCode >57))
	      return false;

	   return true;
	}	
	
	function validateStockTransfer(area, itemParam,dataObj) {
		var flag = true;
		var site = getSiteNo(area);
		var siteNo = site.split('-')[0];
		var siteName = site.split('-')[1];
		var allErrors = [];
		//var warehouse = $('#wh').is(':checked');
		if (siteNo == '') {
			//showErrorContent('Create','Please select a Target Site');
			//showError('Please select a Target Site');
			flag = false;
			allErrors.push('Please select a Target Site');
			//area.find('.errorDiv label').text('Please select a Target Site');
			//area.find('.errorDiv').removeClass('hideBlock');
			
		}  if (area.find("#isVerified").val() != 'true' && area.find('#pos1').val().trim()!='') {
			//showErrorContent('Create','Please verify the site before creating draft');
			//showError('Please verify the site before creating draft');
			flag = false;
			//area.find('#pos1').error('Please verify the site before creating draft');
			allErrors.push('Please verify the site before creating draft.');
		}  if ((siteNo == $('#posSite').val())) {
			flag = false;
			//showErrorContent('Create','Target Site cannot be same as logged in site');
			//area.find('#pos1').error('Target Site cannot be same as logged in site');
			allErrors.push('Target Site cannot be same as logged in site.');
		} if(isPO(dataObj.hdrObj.order_type) && warehouseMap.hasOwnProperty(siteNo))
			{
			if(area.find('#pos1').val().trim()!='')
				{
			//area.find('#pos1').error('Cannot add vendor supplied articles to a warehouse.');
			allErrors.push('Cannot transfer vendor supplied articles to a warehouse.');
			}
			
			if(area.find("#pwh").is(':checked') && area.find('#warehouseInPopup').val() != 0 && area.find('#warehouseInPopup').val() != 'Select'
				&& $('option[value="' + area.find('#warehouseInPopup').val() + '"]') != undefined)
				{
				//area.find('#warehouseInPopup').error('Cannot add vendor supplied articles to a warehouse.');
				allErrors.push('Cannot transfer vendor supplied articles to a warehouse.');
				}
			flag= false;
			}
		if(flag) {

			itemParam.iv_action = 'D';
			itemParam.iv_user = $('#loginUserId').val();
			itemParam.iv_supplier = siteNo;
			itemParam.iv_order_type = 'OADV';
			itemParam.iv_contact_name = '';
			itemParam.iv_contact_no = '';
			itemParam.iv_pickup_date = formatDateMobi(getDesiredPastDate(0));
			itemParam.iv_pickup_time = '00:00';
			itemParam.iv_comments = '';

			// USED TO CUT THE EXTRA SERVICE CALL TO LOAD THE MAP INFO
			itemParam.user = $('#loginUserId').val();
			itemParam.supplier = siteNo;
			itemParam.supplier_name = siteName;
			itemParam.order_type = 'OADV';
			itemParam.contact_name = '';
			itemParam.contact_no = '';
			itemParam.pickup_date = formatDateMobi(getDesiredPastDate(0));
			itemParam.pickup_time = '00:00';
			itemParam.comments = '';

			flag = true;
		}
		
		if(!flag)
			{
			$.fn.showCustomMsg(allErrors,error,'Stock Transfer');
			}
		return flag;
	}

	// TO GET THE SITE NO FROM THE INPUT FIELD
	function getSiteNo(area) {
		var site = '';
		if ($.trim(area.find('#pos1').val()) != '') {
			site = $.trim(area.find('#pos1').val());
		} else if (area.find('input[id="siteSelect"][type="radio"]:checked').length > 0) {
			site = area.find('input[id="siteSelect"][type="radio"]:checked').val();
		} else if (area.find('#warehouseInPopup').val() != 0 && area.find('#warehouseInPopup').val() != 'Select'
				&& $('option[value="' + area.find('#warehouseInPopup').val() + '"]') != undefined) {
			site = $.trim($('option[value="' + area.find('#warehouseInPopup').val() + '"]').text());
		} else {
			site = '';
		}
		return site;
	}
	
	function stockParam(itemArray, supplier) {
		this.ItemArray = itemArray;
		this.iv_supplier = itemArray[0].iv_supplier;
	}
	
	//CREATE THE IBT HEADER LIST
	function createIBTHdrDraftList(param, segmentFlag,elem,dataObj) {
		console.log(createIBTDraftHdrList+ ' ' + JSON.stringify(param));
		$.ajax({
			data : JSON.stringify(param),
			// data : param,
			url : createIBTDraftHdrList,
			type : 'post',

			beforeSend : function() {
				// console.log("---4");
				startLoading();
			},
			success : function(response) {
				//hideErrorContent();
				triggerStockDraftCreate(param.iv_supplier, segmentFlag,elem,dataObj);
				
			},
			error : function(err) {
				console.log(err);
				stopLoading();
				showAllErrors(['Network issue occured while creating the draft']);
				//showError('Network issue occured while creating the draft');
			}
		});
	}

	//ADDING ARTICLE TO THE DRAFT LIST
	function triggerStockDraftCreate(siteNo, segmentFlag,elem,dataObj) {
		recvSite=siteNo;
		if(segmentFlag == 'D'){
			var deliveryNo= $(elem).attr('id').split('-')[0];
			var contObj = $('#order_detail').data('contObj');
			var seg_index = $('#sections-tab ul:visible li.ui-tabs-active,ui-state-active').attr('data-seg-index');
			var status = contObj.deliveryObj[seg_index].status;
			var rec_flag = (isReceived(status) || isPartiallyReceived(status)) ? 'Y' :'N';
			startLoading();
			getOrderItemInfo(new OrderItemParam(deliveryNo,'D','',rec_flag),dataObj,addArticlesToTransferList);
		} else {
			addArticlesToTransferList();
		}
		
	}
	var addArticlesToTransferList = function ()
	{
		var list;
		var tempParam = {};
		var tempList = [];
		var supplier = $('#posSite').val();
		
			list = itemInfo;
			
			for ( var i = 0; i < list.length; i++) {
			var qty = (list[i].received_qty != null && list[i].received_qty != '' && list[i].received_qty != undefined) ? list[i].received_qty
					: '0';
			var tot_qty = 0;
			list[i].om = (list[i].om != null && list[i].om != '' && list[i].om != undefined) ? list[i].om
					: '0';
			list[i].random_wgt_flg = (list[i].random_wgt_flg != null
					&& list[i].random_wgt_flg != undefined && list[i].random_wgt_flg
					.trim() != '') ? list[i].random_wgt_flg : '';
			tot_qty = Number(list[i].om) * (qty);
			tempParam = new stockItemParam();
			tempParam.iv_site = recvSite;
			tempParam.iv_delivery_date = formatDateMobi(getDesiredPastDate(0));
			tempParam.iv_roster_date = formatDateMobi(getDesiredPastDate(0));
			tempParam.iv_article = list[i].article;
			tempParam.iv_article_uom = (list[i].order_uom || '');
			tempParam.iv_user = $('#loginUserId').val();
			tempParam.iv_action = 'D';
			tempParam.iv_qty = qty;
			tempParam.iv_supplier = supplier;
			tempParam.iv_draft_type = 'OADV';
			tempParam.iv_new_uom = list[i].article_uom;
			tempParam.iv_om = list[i].om;
			tempParam.iv_tot_qty = tot_qty;
			tempParam.iv_random_wgt_flg = list[i].random_wgt_flg;
			tempParam.order_type = 'IBT';
			tempParam.iv_platform = 'B';
	/*		tepmParam.iv_expiry_date1= "";;//defect no 5876
		    tepmParam.iv_expiry_date2= "";
		    tepmParam.iv_expiry_date3= ""; 
		    tepmParam.iv_expiry_date4= ""; 
		    tepmParam.iv_expiry_date5= "";*/
			tempList.push(tempParam);
		}

			param = new stockParam(tempList, supplier);
			param.iv_site = recvSite;
			//param.tempArticleList = list;
			createIBTDraftArticleList(param);
			
	};

	function createIBTDraftArticleList(param) {
		console.log(createOrdersDraftList + ' ' + JSON.stringify(param));
		$
				.ajax({
					data : JSON.stringify(param),
					url : createOrdersDraftList,
					type : 'post',

					beforeSend : function() {
						startLoading();
					},
					success : function(response) {
						/*
						 * if (response.ErrorID == undefined) { showError('Techincal
						 * issue occured while updating draft'); } else {
						 */
						// }
						if(response != undefined && response != null && response.length > 0 && response[0].msg_type == 'S'){
							$('#dialog-editSitePop').dialog('close');
							$.fn.showCustomMsg(['Stock Transfer Draft Created Successfully'],success,'Order Details');
							window.location.replace(stockTransferLink);
						}else if(response != undefined && response != null && response.length > 0 && response[0].msg_type == 'E')
							{
							$.fn.showCustomMsg([response[0].msg],error,'Order Details');
							}
						else
							{
							$.fn.showCustomMsg(['Network issue occured while creating the draft'],error,'Order Details');
							}
						stopLoading();
					},
					error : function(err) {
						console.log(err);
						stopLoading();
						showAllErrors(['Network issue occured while fetching the draft']);
						//showError('Network issue occured while fetching the draft');
					}
				});
	}
	function validateTheSearchform(elem ,tableId) {
	      var errors = []; 
		  var $cache = $(elem);
		  var $article = $cache.find('#add_article_input_'+tableId).removeClass(errorFieldClass);
		  var $qty = $cache.find('#add_qty_'+tableId).removeClass(errorFieldClass);
		  //var $all = $cache.find('#src_all_radio_'+tableId).removeClass(errorFieldClass);
		  var $vendor = $cache.find('#src_vn_radio_'+tableId).removeClass(errorFieldClass);
		  var $warehouse = $cache.find('#src_wh_radio_'+tableId).removeClass(errorFieldClass);
		  var $wareDrop= $cache.find('#src_vn_drop_dwn_'+tableId).removeClass(errorFieldClass);
		  var $vendorinput = $cache.find('#src_vn_cont_'+tableId).find('input').removeClass(errorFieldClass);
		  $article.removeClass(errorFieldClass);
		  $qty.removeClass(errorFieldClass);
		  $wareDrop.removeClass(errorFieldClass);
		  $vendorinput.removeClass(errorFieldClass);
		  
		  var flag = false;
		  if ($article.val().trim() == '') {
			  $article.highlight(articleNoMandMsg);
			  errors.push(articleNoMandMsg);
		  } else if ($vendor.is(':checked') && $vendorinput.val().trim()=='') {
			  $vendorinput.highlight(enter_supp_msg);
			  errors.push(enter_supp_msg);
		  }else if ($warehouse.is(':checked') && $wareDrop.val().trim()=='0') {
			  $wareDrop.highlight(warehouse_msg);
			  errors.push(warehouse_msg);
		  }else {
			  flag =true;	
		  }
		  if (errors.length>0) {
			  showAllErrors(errors);
		  }
		return flag;
	}
	
	function articleSearch(url,param,followUp){
		 var glaExists = $('#open_item_tab_table thead th[data_key="cost_price"]').length;
		console.log(url + ' ' + JSON.stringify(param));
		 $.ajax({
			    type: "POST",
			    url: url,
			    data: JSON.stringify(param),
			    beforeSend: function(){
			    	startLoading();
			    }
		  }).done(function(data) {
			  if(checkResult(data,articleSearchKey)){
				  followUp(data,param);
				}else{
				  stopLoading();
			  };
		  }).fail(function() {
			  $.fn.showCustomMsg([mobiSerErrCode],error,'Order Details');
			  stopLoading();
		  }).always(function() {
			  
		  });
	}
	
	var addOpenObj = function(obj){
		//e.stopPropagation();
		var newData = obj.data;
		var glaExists = $('#open_item_tab_table thead th[data_key="cost_price"]').length;
		
		var $table = obj.cache;
		var $param = obj.param;
		var qty = $param.qty;
		var confObj = $table.data('confObj');
		var updateFlag = confObj.updateFlag;
		var insertObj =  confObj.insertObj;
		var insertObjDraft = confObj.insertObjDraft;
		var data =  confObj.content;
		insertObj = (insertObj!=undefined) ? insertObj :{};
		insertObjDraft = (insertObjDraft!=undefined) ? insertObjDraft :{};
		confObj.insertObj = insertObj;
		confObj.insertObjDraft = insertObjDraft;
		var blockedArticles = [];
		
		  //if(newData.article_no=="285910")/*data.greenlife_flag!=undefined && data.greenlife_flag!=null && data.greenlife_flag=="Y")*/
	          if(data.greenlife_flag!=undefined && data.greenlife_flag!=null && data.greenlife_flag=="Y")
		  {
		  
		  if(glaExists > 0)
			  {
			  openFormReset($('#add_table_'+$param.tableId),$param.tableId);
				filter = (confObj.applyFilter||'');
				filterCont = filter ? confObj.filterCont : [];
				confObj.filterCont = filterCont;
				for(var i =0;i<newData.length;i++){
			if(newData[i].msg_type != 'E')
					isExistCheckAdd($table,data,newData[i],qty,filter,filterCont,$param.tableId,updateFlag);
			else
				blockedArticles.push(newData[i].msg);	
				}
			  }
		  else
			  {
			  $.fn.showCustomMsg(["Cannot add greenlife artilces to the non greenlife articles order"],error,'Order Details');
			  }
		  
		  }
	  else
		  {
		  
		  if(glaExists > 0)
		  {
			  $.fn.showCustomMsg(["Cannot add non greenlife artilces to the greenlife articles order"],error,'Order Details');
		 
		  }
	  else
		  {
		  openFormReset($('#add_table_'+$param.tableId),$param.tableId);
			filter = (confObj.applyFilter||'');
			filterCont = filter ? confObj.filterCont : [];
			confObj.filterCont = filterCont;
			for(var i =0;i<newData.length;i++){
			if(newData[i].msg_type != 'E')
				isExistCheckAdd($table,data,newData[i],qty,filter,filterCont,$param.tableId,updateFlag);
			else
				blockedArticles.push(newData[i].msg);	
	  
		  }
		  }
			 }
		
		if(blockedArticles.length > 0)
			{
			$.fn.showCustomMsg(blockedArticles,error,'Order Details');
			}
		 
	};

	function isExistCheckAdd($tbl,data,obj,qty,filtered,filterCont,tableId,updateFlag){
		console.log(new Date().getTime());
		var tempObj ='';
		var department_name = '';
		/*for(var i=0;i<data.length;i++){
			if(data[i].article+'_'+data[i].base_uom == obj.article+'_'+obj.article_uom){
				data[i].newQty =  qty;
			}else{
				tempObj = new orderItemObj(obj.article,obj.article_desc,obj.base_uom,obj.order_uom,qty,obj.om,obj.piom,obj.random_wgt_flg,'I');
				data.push(tempObj);
				$tbl.data('confObj').insertObj[tempObj.article+'_'+tempObj.base_uom+'_'+tempObj.article_line]= tempObj;
			};
		}
		console.log(new Date().getTime());*/
		
		console.log(new Date().getTime());
		var id = '#'+obj.article+'_'+obj.article_uom;
		if($tbl.find(id)!=undefined && $tbl.find(id).length>0){
			var $elem = $tbl.find(id);
			$elem.find('.textbox').val(qty).focus();$elem.find('.textbox').trigger('change');
		}else{
			department_name =(obj.dept_no_name||'');
			department_name = (department_name.split(',').length >1) ? department_name.split(',')[1] :'';
			var itemArray = $tbl.data('confObj').content;
			var arrayLength = itemArray.length;
			var lastObj = arrayLength>0 ?  itemArray[arrayLength-1] : '0010';
			var lineCount = lastObj.article_line;
			console.log(lineCount);
				if(lineCount.length == 5)
					lineCount =  lineCount.substring(1, 5);
			lineCount = Number(lineCount)+10;	
			if(updateFlag == true){
				tempObj = new orderItemObj(obj.article,obj.article_desc,obj.order_uom,obj.article_uom,'',obj.om,obj.pi_om,obj.random_wgt_flg,'I',obj.department_no,department_name,obj.vendor_ref_no,qty,lineCount,(obj.soh || '0'));
			}else{
				tempObj = new orderItemObj(obj.article,obj.article_desc,obj.order_uom,obj.article_uom,qty,obj.om,obj.pi_om,obj.random_wgt_flg,'I',obj.department_no,department_name,obj.vendor_ref_no,'',lineCount,(obj.soh || '0'));
			}
			data.push(tempObj);
			$tbl.data('confObj').insertObj[tempObj.article+'_'+tempObj.order_uom+'_'+tempObj.article_line]= tempObj;
			$tbl.data('confObj').insertObjDraft[tempObj.article+'_'+tempObj.order_uom+'_'+tempObj.article_line]= obj;
			$tbl.find('#'+tempObj.article+'_'+tempObj.order_uom).find('.editNumCell').focus();
			if(filter == true){
				//filterCont.push(tempObj);
				$tbl.find('#filter_row_'+tableId).find('input:first').trigger('keyup');
			}else{
				triggerTable($tbl);
			}
		}
		if(updateFlag == true){
			$('#updateQtyContentWrap').find('#changeOmExpDate').trigger('change');
		}
		console.log(new Date().getTime());
	}

	function triggerTable($table){
		var confObj = $table.data('confObj');
		var default_groupbyColumn = confObj.cur_gru_col;
		if(confObj.applyGroup ==true && default_groupbyColumn!=undefined){
			$.tablebuild.groupContObj(confObj,[default_groupbyColumn],confObj.content);
		}
		$.tablebuild.tableTrigger($table);
	}
	function orderItemObj(article,article_desc,order_uom,base_uom,order_qty,om,piom,random_flag,action,department_no,dept_no_name,vendor_ref_no,receive_qty,article_line,soh){
		this.article = article;
		this.article_desc = article_desc; 
		this.article_line = padzero(article_line,4);
		this.order_qty =order_qty;
		this.order_uom= order_uom;
		this.base_uom = base_uom;
		this.newOm = '';
		this.newQty ='';
		this.newTot = '';
		this.oldQty = '';
		this.om = om;
		this.pi_om = piom;
		this.random_wt_flag = random_flag;
		this.action_code = action;
		this.soh =soh;
		this.department_no= (department_no||'');
		this.department_name = (dept_no_name||'');
		this.vendor_ref_no = (vendor_ref_no||'');
		this.received_qty = (receive_qty||'');
		this.received_qty_uom = order_uom;
		this.random_wgt_flg = random_flag;
	}

	var triggerDeleteYes = function(e){
		var $elem = e.data.msg;
		var $cache = e.data.cache;
		var $td = $cache.closest('td');
		var $tr = $td.closest('tr');
		var $table= $tr.closest('table');
		var obj = $table.data('confObj');
		var cont = obj.content;
		var filterCont = obj.filterCont;
		var index = $td.attr('data_index');
		var cont_index = $td.attr('cont_index');
		index = Number(index);
		var sdata ={}; 
		if((obj.applyFilter||'')){
			cont_index = Number(cont_index);
			spliceData(cont,cont_index,1);
			cont = filterCont;
		}
		sdata= spliceData(cont,index,1);
		var newObj = sdata[0];
		if((newObj.action_code||'') != 'I'){
			if($.isEmptyObject(obj.deletedObj)){obj.deletedObj ={};}
			obj.deletedObj[newObj.article+'_'+newObj.order_uom+'_'+newObj.article_line] =newObj;
			if(obj.updateObj!=undefined && obj.updateObj[newObj.article+'_'+newObj.order_uom+'_'+newObj.article_line]!=undefined)
			delete obj.updateObj[newObj.article+'_'+newObj.order_uom+'_'+newObj.article_line];
		}else{
			if(obj.insertObj!=undefined && obj.insertObj[newObj.article+'_'+newObj.order_uom+'_'+newObj.article_line]!=undefined)
			delete obj.insertObj[newObj.article+'_'+newObj.order_uom+'_'+newObj.article_line];
	        
	                if(obj.insertObjDraft!=undefined && obj.insertObjDraft[newObj.article+'_'+newObj.order_uom+'_'+newObj.article_line]!=undefined)
	                delete obj.insertObjDraft[newObj.article+'_'+newObj.order_uom+'_'+newObj.article_line];
		}
		$tr.remove();
		triggerTable($table);
	        if($elem != undefined)
		$elem.dialog('close');
	};

	var triggerDeleteNo = function(e){
		var $elem = e.data.msg;
		$elem.dialog('close');
	};

	function spliceData(array,i,size){
		return array.splice(i,size);
	}
	function openFormReset($elem,tableId){
		$elem.find('#add_article_input_'+tableId).val('');
		$elem.find('#add_qty_'+tableId).val('');
		if(!($elem.find('#src_all_radio_'+tableId).is(':disabled'))){
			$elem.find('#src_all_radio_'+tableId).trigger('click');
		}
	}

	function showViewMode(){
		var $tableHold = $('#openOrderItemHolder');
		var $editRows = $tableHold.find('#open_item_tab_table');
		$tableHold.find('#grou_cont_open_item_tab').hide();
		$editRows.find('.viewMode').removeClass('hideBlock');
		$editRows.find('.editMode').addClass('hideBlock');
		$tableHold.find('#add_table_open_item_tab,#add_art_link_btn_open_item_tab').addClass('hideBlock');
		openFormReset($tableHold.find('#add_table_open_item_tab'));
	}

	var openItemSortDone = function($elem){
		if($('#editAction').hasClass('disabled')){showEditMode();}
		callOpenItemExpandTrigger($elem);
	};

	var openItemPageDone = function($elem){
		if($('#editAction').hasClass('disabled')){showEditMode();}
		callOpenItemExpandTrigger($elem);
	};

	var openItemFilterDone = function($elem){
		if($('#editAction').hasClass('disabled')){showEditMode();}
		callOpenItemExpandTrigger($elem);
	};

	function callOpenItemExpandTrigger($elem){
		if($elem.attr(expanded) == 'true')
			triggerOpenOrderExandAll($elem);
	}
	var articlePar= function(article,uom){
		this.iv_article_no = article;
		this.iv_article_uom = uom;
	};

	function openItemexpandCollapseEvent(){ 
		var $elem = $(this);
		var obj =  $elem.data('obj');
		var expObj = obj.expObj;
		if(expObj!=null && expObj!=undefined && expObj.length>0){
			trigOpenExp(obj,expObj,$($elem));
		}else{
			var articleList = [];
			var article = obj.article;
			var uom = obj.base_uom;
			articleList.push(new articlePar(article,uom));
			var param = {Article_dtls:articleList};
			getOrderItemDetailInfo(param,$elem);
		}
	}
	
	function formRecvItemObj(obj,isComponent, dispArt){
		this.iv_article  = (obj.article||'');
		this.iv_uom  = (obj.order_uom||'');
		this.iv_qty  = (Number(obj.newReceQty));
		this.iv_line_no  =  (obj.article_line||'');
		this.iv_new_om  =  (obj.newReceOm||'');
		this.iv_expiry_date1  =  $.tablebuild.dataparse.mobi_date(obj.exp1||'');
		this.iv_expiry_date2  =  $.tablebuild.dataparse.mobi_date(obj.exp2||'');
		this.iv_expiry_date3  =  $.tablebuild.dataparse.mobi_date(obj.exp3||'');
		this.iv_expiry_date4  =  $.tablebuild.dataparse.mobi_date(obj.exp4||'');
		this.iv_expiry_date5  =  $.tablebuild.dataparse.mobi_date(obj.exp5||'');
		this.iv_random_ea_as_uom =  '';
		this.iv_random_wgt_flag =  (obj.random_wt_flag||'');
		if(obj.random_wt_flag  == 'Y'){ 
			this.iv_random_weight_qty =  (obj.newReceTot||'');
			this.iv_random_weight_uom =  (obj.base_uom||'');
			this.iv_random_weight  =  (obj.tot_weight||'');
		}else{
			this.iv_random_weight_qty =  null;
			this.iv_random_weight_uom =  null;
			this.iv_random_weight  =  null;
		}
		this.iv_unknow_ref_flag  =  'N';
		this.iv_tun  = '';
		this.iv_ean  = '';
		this.iv_article_tun_flag = '006';
		this.iv_receive_method = '';


		var adj_qty = '';
		var adj_uom = '';

		var isOMChangedFlag = false;
		var isQTYChangedFlag = false;
		var isWgtChangedFlag = false;
		
		
		if(obj.newReceQty != obj.received_qty){
			isQTYChangedFlag = true;
			this.changed = true;
		}
		
		if(obj.newReceOm != undefined || obj.newReceOm != ''){
			if(obj.recv_om != obj.newReceOm){
				isOMChangedFlag = true;
				this.changed = true;
			}		
		}

		if(obj.tot_weight != undefined || obj.tot_weight != ''){
			if(obj.rnd_wgt != obj.tot_weight){
				isWgtChangedFlag = true;
				this.changed = true;
			}		
		}


		
		if(obj.random_wgt_flg == 'Y'){//if random weight article
			adj_qty = isWgtChangedFlag ? Number(obj.tot_weight - obj.rnd_wgt) : obj.rnd_wgt;
			adj_uom = obj.base_uom;
		}else{//if normal article
			if(isOMChangedFlag && isQTYChangedFlag || isOMChangedFlag){//both qty and om changed or only om changed,qty not changed
				adj_qty = (Number(obj.newReceQty) * Number(obj.newReceOm)) - (Number(obj.received_qty) * Number(obj.recv_om));
				adj_uom = obj.base_uom;
			}/*else if(isOMChangedFlag){
				adj_qty = (Number(obj.newReceQty) * Number(obj.order_qty)) - (Number(obj.received_qty) * Number(obj.recv_om));
				adj_uom = obj.base_uom;
			}*/else if(isQTYChangedFlag){//only qty changed,om not changed
				adj_qty = Number(obj.newReceQty) - Number(obj.received_qty);
				adj_uom = obj.received_qty_uom;
			}else{//if no cahnge
				adj_qty = obj.newReceQty;
				adj_uom = obj.received_qty_uom;
				this.changed = false;
			}
		};
		if(obj.action_code=='I'){
			if(obj.random_wgt_flg == 'Y'){
				this.iv_adj_qty = (obj.tot_weight||'');
				this.iv_adj_qty_uom = (obj.base_uom||'');
				this.iv_adj_pi_qty  = Number(obj.newReceQty||'')*Number(obj.pi_om||'');
			}else{
				this.iv_adj_qty = obj.newReceQty;
				this.iv_adj_qty_uom = obj.received_qty_uom;
				this.iv_adj_pi_qty  = 0;
			}
		}else{
			this.iv_adj_qty = adj_qty;
			this.iv_adj_qty_uom = adj_uom;
			this.iv_adj_pi_qty  = isQTYChangedFlag ? (obj.random_wgt_flg == 'Y' ? ((Number(obj.newReceQty) * Number(obj.pi_om)) - (Number(obj.received_qty) * Number(obj.pi_om))) : (Number(obj.newReceTot) - (Number(obj.received_qty) * Number(obj.recv_om)))) : '0';
		}
		this.iv_pbd_flag = (obj.pbd_flag||'');
		this.iv_article_cat_id = (obj.article_cat_id||'');
		this.iv_pack_size_base = (obj.pack_size_base||'');
		this.iv_base_uom = (obj.base_uom||'');
		this.iv_exidv = '';
		this.iv_display_ind = (isComponent != ''&&isComponent != undefined)?isComponent:'';
	    this.iv_display_article = (dispArt != ''&&dispArt != undefined)?dispArt:'';
	    this.iv_base_order_no = (obj.order_no||(headerObj != ''&& headerObj != undefined && headerObj.hdrObj != '' && headerObj.hdrObj != undefined)?(headerObj.hdrObj.order_no) : '');
	    this.iv_art_delivery_no = isPO(commonOrder.order_type)?(obj.delivery_no || ''):''; // 17.08 Meat Co Vendor Changes
	    this.iv_zero_qty_flag = 'N';
	}
	
	var triggerReceiveOrder = function(e){
		var dataObj = e.data.dataObj;
		showSessionPopUp(dataObj);
			
	};	
	
	function showSessionPopUp(dataObj)
	{
		 var orderNo = dataObj.hdrObj.order_no;
		 var sourceFlag = dataObj.hdrObj.source_flag;
		 var asnNo = (dataObj.hdrDtlObj[0].asn_no||'');
			callServiceForWizard(orderNo, sourceFlag,asnNo,dataObj);
	}
	function callServiceForWizard(orderNo, sourceFlag, asnNo,dataObj) {
		commonOrder = dataObj.hdrObj;
		commonOrder.order_no_new = orderNo;
		 fullObject = dataObj;
		 deliveryList= dataObj.deliveryObj;
		var data = {
				"iv_user_id":userId,
				"iv_delivery_no":orderNo,
				"iv_platform":"B",
				"iv_action":"V",
				"iv_session_id":""
				};
		console.log(getReceivingTransactionUrl + ' '+JSON.stringify(data));
		$.ajax({
		    type: "post",
		    url: getReceivingTransactionUrl,
		    data: JSON.stringify(data),
		    beforeSend: function(){
		    	startLoading();
		    }
		  }).done(function(response) {
			  afterGettingReceiveTransactionId(orderNo,response,sourceFlag, asnNo,dataObj);
		  }).fail(function() {
			  $.fn.showCustomMsg([ngboSessErrCode],error);
		  }).always(function() {
			//  stopLoading();
		  });

	}

	function afterGettingReceiveTransactionId(orderNo,response,sourceFlag, asnNo,dataObj)
	{

		ordSegNo = orderNo;
		var output=response[0];
		if((response!=undefined && response.length==0) || checkResult(response,'MSG'))
		{	
			transInfo = output;
			var msg = output.MSG;
			var usrId = output.USER_ID;
			var usrName = output.USER_NAME;
			$('.orderReceive').find('#deliverySegNo').val(orderNo);
			//console.log("msg--->"+msg);
			
			var partiallyReceivedByOtherUserMsg="There are few articles in this order are <strong>received by <span class='recei'>"+(usrName|| '')+'('+usrId+')'+" </strong> in previous session.";
			var partiallyReceivedBySameUserMsg="There are few articles in this order are <strong>captured as received</strong> in the system.";
			var currentlyReceivedByOtherUserMsg=(usrName|| '')+'('+usrId+')'+'   is currently updating/receiving this order.';
			
			if(msg=='N'){
				callItemInfoForReceiving('N', orderNo, sourceFlag,dataObj,asnNo);
				//Directly redirect to the next page without popup
			}else if(msg=='S'){
			    //show popup
				if(usrId.toLowerCase() != userId.toLowerCase()){
					$("#dialog-sessionRCV .warningName").html(partiallyReceivedByOtherUserMsg);
					$("#dialog-sessionRCV #resumeSessRCV").addClass('hideBlock');
			}else{
				$("#dialog-sessionRCV .warningName").html(partiallyReceivedBySameUserMsg);
			}
				bindRecvConfirmationEvents(orderNo, sourceFlag,dataObj,asnNo);
				$("#dialog-sessionRCV").dialog("open");
				stopLoading();
			}else if(msg=='L'){
				//Show the  information
				$('.commonReceiveOrder').removeClass('hideBlock');
				$.fn.warnPopup('alert',currentlyReceivedByOtherUserMsg,'Order Details','','',triggerOk,'');
				stopLoading();
			}
		}
		
		
	}

	var triggerOk = function(e)
	{
		 $('#dialog-alert-conf').dialog('close');	
	};
	
	function callItemInfoForReceiving(retainSessionFlag, orderNo, sourceFlag,dataObj,asnNo){ 
        receiveInFull_retainSessionFlag=retainSessionFlag
        receiveInFull_dataObj=dataObj;		
		receiveInFull_asnNo=asnNo;
		receiveInFull_sourceFlag=sourceFlag;
		receiveInFull_orderNo=orderNo;  
	var param = {
			"iv_order_no" : getEmptyIfNull(orderNo),
			"iv_site" : siteNo,
			"iv_session_id" : "111",
			"iv_user_id" : "",
			"iv_source_flag" : sourceFlag,
			"iv_retain_session_flag" : retainSessionFlag,
			"iv_sales_org" : salesOrg,
			"iv_receive_flag":"",			
			"iv_display_flag":"N"
			
		};		
		
	console.log(orderItemInfoURL+' '+JSON.stringify(param));
	$.ajax({
	    type: "post",
	    url: orderItemInfoURL,
	    data: JSON.stringify(param),
	    beforeSend: function(){
	    	startLoading();
	    }
	  }).done(function(response) {
		  if(checkResult(response,'article')){
				recvItemInfo = response;
				initializeReceiveOrderPage(dataObj,asnNo,orderNo);
		  }
	  }).fail(function() {
		  $.fn.showCustomMsg([mobiSerErrCode],error);
		  stopLoading();
	  });
	stopLoading();
}
	function initializeReceiveOrderPage(dataObj,asnNo,orderNo){
		getReceiveOrderContent(dataObj,asnNo,orderNo);
		$("#dialog-sessionRCV").dialog("close");
	}
	
	function getReceiveOrderContent(dataObj,asnNo,orderNo)
	{
		var hdrObj = dataObj.hdrObj;
		var deliveryFlag = dataObj.deliveryFlag;
		var $elem = $('#receive_order');
		$.ajax({
		    type: "get",
		    url: 'getReceiveOrderContent.htm',
		    data: {},
		  }).done(function(data) {
			  var content = formOtherOrderHead(hdrObj,deliveryFlag,dataObj);
			  appendReceiveContent($elem,content+data,asnNo,orderNo,dataObj);
		  }).fail(function(data) {
			  if(data.status == 404)
				  window.location.replace(homeLink);
			  $.fn.showCustomMsg([ngboSessErrCode],error);
		  }).always(function() {
			  bindOnPageLoadEventsForReceiveOrder();
		  });

	}
	function appendReceiveContent($elem,data,asnNo,orderNo,dataObj){
		$elem.addClass('hideBlock');
		$elem.html(data);
		$elem.removeClass('hideBlock');
		loadReceiveOrderJs();
		navigate(receive);
		callReceiveMethodConfigService(dataObj);
		validateTemperatureCode(recvItemInfo);
		$('.commonReceiveOrder').addClass('hideBlock');
		$('.orderStatus').addClass('hideBlock');
		$('.receiveOrderStatus').removeClass('hideBlock');
		$('.orderReceive').find('#asnNo').val(asnNo);
		$('.orderReceive').find('#deliverySegNo').val(orderNo);
		var area = $('.orderReceive');
		area.find('#addULDTable').addClass('hideBlock');
		area.find('#addULDTable tbody').html('');
		if(isFutureDate($.tablebuild.dataparse.mobi_date(dataObj.hdrDtlObj[0].on_show_date||'')))
		$('#plRadioDiv').removeClass('hideBlock');
		else
		$('#plRadioDiv').addClass('hideBlock');	
		
	}
	
	function discrepancyReportPrint()
	{
		$('#edgmsDiscrepanciesReportPdf').attr("action", "downloadEDGMSDiscrepancyPDF.pdf");
		$('#edgmsDiscrepanciesReportPdf').attr('target','_blank');
		$('#edgmsDiscrepanciesReportPdf').attr('method','get');
		$('#edgmsDiscrepanciesReportPdf').submit();
	}
	function getOrderComponentesItemInfo(param, dataObj){		
		console.log(orderItemInfoMobileURL+' '+JSON.stringify(param));
		$.ajax({
		    type: "post",
		    url: orderItemInfoMobileURL,
		    data: JSON.stringify(param),
		    beforeSend: function(){
		    	startLoading();
		    }
		  }).done(function(response) {
			  if(response != '' && response.length>0){
				  dataObj['itemCompObjMap'] = '';
	              dataObj['itemCompObjMap'] = formComponentsBasedOnDisplay(response, dataObj);
				  dataObj['itemCompObjFlag'] = true;
			  }else{
				  dataObj['itemCompObjMap'] ='';
				  dataObj['itemCompObjFlag'] = true;
			  }
		  }).fail(function() {
			  $.fn.showCustomMsg([mobiSerErrCode],error);
			  stopLoading();
		  });
		stopLoading();
	}

	function formComponentsBasedOnDisplay(response, dataObj){	
	//componentArtDisplayMap  = {};
	componentArtMap = {};
	for(var a in response){	
		var proceed = false;
		var id = (response[a].sscc_carton_num != "" && response[a].sscc_carton_num != undefined )?
		response[a].display_article+"_"+response[a].sscc_carton_num:response[a].display_article;        
		if(dataObj.itemObj != '' && dataObj.itemObj.length>0){
	               for(var b in dataObj.itemObj ){
	                     if(dataObj.itemObj[b].article == response[a].display_article)
	                     proceed = true;
	                     response[a].selected = false;
	               }
	        }
	         if((response[a].received_qty == null || response[a].received_qty == '') && !(salesOrg==1060 && era_prof=="Y" && auditFlag  == "Y" && receiveInFull_retainSessionFlag != "Y") ){
	                   response[a].received_qty = (headerObj.hdrObj.order_status != "" && headerObj.hdrObj.order_status != undefined
	                   && headerObj.hdrObj.order_status == diapatchStatus && response[a].dispatched_qty != null
	                   && response[a].dispatched_qty != '')?response[a].dispatched_qty:response[a].order_qty;
	        }
	        if(proceed && (componentArtMap[id] == undefined || componentArtMap[id] == '') 
	                && response[a].display_article != "" && response[a].display_article != null){
			var list = [];               
			list.push(response[a]);
			componentArtMap[id]= list;                
	        }else if(proceed && response[a].display_article != "" && response[a].display_article != null){ 
	    	 componentArtMap[id].push(response[a]);
	        }
	        
	}
	return componentArtMap;
	}